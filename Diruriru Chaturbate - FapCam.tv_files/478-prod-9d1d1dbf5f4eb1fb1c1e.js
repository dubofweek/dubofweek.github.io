"use strict";(self.webpackChunk_multimediallc_cb_ts=self.webpackChunk_multimediallc_cb_ts||[]).push([[478],{18529:(e,t,s)=>{s.d(t,{s:()=>g});var i=s(20),n=s(79461),a=s(62331),o=s(32939),r=s(39060),l=s(11284),h=s(27407),d=s(61452),c=s(44947),u=s(62091),p=s(31448),m=s(74);class g extends a.ZZ{constructor(){super(),this.numUnread=0,this.element.style.overflow="";const e={onToggleDebugMode:()=>{this.chatConnection.toggleAppDebugging()},onTipRequest:e=>{m.i5.fire(e)},onChatMessage:e=>{if((0,r.JG)()&&this.chatConnection.inPrivateRoom()){const t={message:e,username:n.B.current.isBroadcast||this.chatConnection.isBroadcasting?this.chatConnection.getPrivateShowUser():this.chatConnection.room(),media:void 0,source:"roomviewPM",roomName:this.chatConnection.room()};(0,i.F_)(t).catch((e=>{this.chatTabContents.appendMessageDiv((0,p.CM)(e.errorMessage))}))}else this.chatConnection.sendRoomMessage(e),this.chatTabContents.blurCurrentChatInput()}};this.chatTabContents=new u.__({onShortcode:e=>{this.chatConnection.sendShortcode(e)},...e},(()=>this.chatConnection.inPrivateRoom())),this.addChild(this.chatTabContents),o.X0.listen((e=>{this.chatConnection=e.chatConnection,this.chatTabContents.appendMessageDiv((0,p.CM)(this.welcomeWarning())),this.chatTabContents.appendMessageDiv((0,p.CM)(this.welcomeMessage())),(0,l.LQ)(e.dossier.room,e.dossier.roomUid,e.dossier.appsRunning,"theater").then((e=>{this.chatTabContents.appendMessageDiv(e)})).catch(d.yZ),this.changeToThisTab()})),o.Gr.listen((()=>{this.chatTabContents.clear()}))}getNumUnread(){return this.numUnread}scrollToBottom(){this.chatTabContents.scrollToBottom()}getTabHandleContent(){const e=c.Ru.chatCAPS;let t;return t=this.numUnread>99?`${e} (99+)`:this.numUnread>0?`${e} (${this.numUnread})`:e,[document.createTextNode(t)]}getTabId(){return"chat-tab-default"}focusCurrentChatInput(){this.chatTabContents.focusCurrentChatInput()}blurCurrentChatInput(){this.chatTabContents.blurCurrentChatInput()}isInputFocused(){return this.chatTabContents.isInputFocused()}possiblyIncrementUnread(){this.isCurrentTab()||(this.numUnread+=1),this.refreshTabs()}showElement(){super.showElement(),this.resetNumUnread(),this.chatTabContents.scrollToBottom()}resetNumUnread(){this.numUnread=0,this.refreshTabs()}handleRemoveMessages(e){const t=[];for(const s of this.chatTabContents.messageList.childNodes){const i=s;i.getAttribute("data-nick")===e&&t.push(i)}for(const e of t)this.chatTabContents.messageList.removeChild(e)}getInputText(){return this.chatTabContents.getInputText()}setInputText(e){this.chatTabContents.setInputText(e)}appendInputText(e){this.chatTabContents.appendInputText(e)}getChatInputField(){return this.chatTabContents.customInputField}welcomeWarning(){return c.Ru.viewerWelcomeWarning}welcomeMessage(){return c.Ru.welcomeMessage}tabHandleClicked(e){super.tabHandleClicked(e),(0,h.bT)("FocusTab",{location:"chat"})}}},76478:(e,t,s)=>{s.d(t,{n:()=>Se});var i=s(18598),n=s(20),a=s(99447),o=s(40478),r=s(23910),l=s(21885),h=s(39419),d=s(79461),c=s(44873),u=s(62331),p=s(28122),m=s(3333),g=s(93502),b=s(32939),y=s(17197),C=s(1243),T=s(63955),f=s(78423),v=s(39060),S=s(89815),x=s(49898),w=s(82434),M=s(18785),R=s(44947),P=s(4110),E=s(43860),A=s(69757),B=s(19505),U=s(6784),D=s(51516),L=s(75424),H=s(97742),N=s(29937),I=s(68868),k=s(50213),_=s(65216),F=s(78451),O=s(11372),$=s(52690);class Z extends $.z{constructor(){super({onShow:()=>{this.element.style.display="block",this.repositionChildrenRecursive()},onHide:()=>{this.element.style.display="none"},easyExit:!0}),this.isLoading=!1,this.loadingDiv=document.createElement("div"),this.contents=document.createElement("div"),this.preventChatFocus=!0,(0,a.fZ)(this.element,"BaseSettingsModal"),this.element.style.display="none",this.element.style.height="auto",this.element.style.width="auto",this.element.style.position="absolute",this.element.style.borderRadius="6px",this.element.style.padding="10px",this.element.style.fontSize="12px",this.overlay.style.backgroundColor="#000000",this.overlay.style.opacity="0.4",this.element.appendChild(this.contents),this.element.appendChild(this.loadingDiv);const e=document.createElement("img");e.src=`${STATIC_URL}loading.gif`,e.style.width="50px",e.style.height="50px",e.style.padding="14px",e.style.position="absolute",e.style.left="50%",e.style.top="50%",e.style.transform="translate(-50%, -50%",this.loadingDiv.appendChild(e);const t=this.createCloseButton();this.element.appendChild(t)}createCloseButton(){const e=document.createElement("div");return(0,a.fZ)(e,"closeButton"),e.style.position="absolute",e.style.width="14px",e.style.height="14px",e.style.top="10px",e.style.right="10px",e.style.cursor="pointer",e.style.opacity=".5",e.onclick=()=>{this.hide()},e.onmouseenter=()=>{e.style.opacity="1"},e.onmouseleave=()=>{e.style.opacity="0.5"},e}setLoading(e){this.isLoading=e,this.isLoading?(this.contents.style.visibility="hidden",this.loadingDiv.style.display="block"):(this.contents.style.visibility="visible",this.loadingDiv.style.display="none"),this.repositionChildrenRecursive()}reload(){this.isLoading||(this.setLoading(!0),this.loadData().then((e=>{void 0!==e?(this.data=e,this.setLoading(!1),this.onDataLoaded(),this.repositionChildrenRecursive()):this.hide()})).catch((e=>{this.setLoading(!1),this.hide(),(0,k.Q$)("An error has occurred"),error(`Error loading settings modal: ${e}`)})))}onDataLoaded(){}repositionChildren(){const e=(document.documentElement.clientWidth-this.element.offsetWidth)/2,t=(document.documentElement.clientHeight-this.element.offsetHeight)/2;this.element.style.left=`${Math.max(e+window.pageXOffset,0)}px`,this.element.style.top=`${Math.max(t+window.pageYOffset,0)}px`}}var z,W=s(92709);!function(e){e[e.More=-100]="More",e[e.Left=-200]="Left",e[e.Right=-300]="Right"}(z||(z={}));class K extends W.u{constructor(e){super(),this.props=e,this.currentPage=1,this.pageCount=1;const t={height:"25px",listStyle:"none",padding:0,display:"inline-block",marginBottom:0,font:"1.166em/1.577em 'UbuntuMedium',Arial,Helvetica,sans-serif",...this.props.overideStyle};this.element=(0,O.tT)("div",{style:{textAlign:"center"},colorClass:"pagination"},(0,O.tT)("ul",{style:t,ref:e=>this.pagiList=e})),this.updatePageDOM()}gotoPage(e){if(e===z.Left){if(1===this.currentPage)return;this.currentPage-=1}else if(e===z.Right){if(this.currentPage===this.pageCount)return;this.currentPage+=1}else this.currentPage=e;this.props.requestNewPage(this.currentPage),this.updatePageDOM()}range(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=e;const n=[];for(;i<=t;)n.push(i),i+=s;return n}updatePageDOM(){const e=this.currentPage-3,t=this.currentPage+3,s=e>2?e:2,i=t<this.pageCount?t:this.pageCount-1,n=this.range(s,i);s>2&&n.unshift(z.More),i<this.pageCount-1&&n.push(z.More);const a=[z.Left,1,...n,this.pageCount,z.Right],o={cssFloat:"left",minWidth:"21px",height:"21px",margin:"0 4px",textAlign:"center",lineHeight:"21px"},r={display:"inline-block",minWidth:"21px",height:"21px",textDecoration:"none",cursor:"pointer",borderRadius:"5px",lineHeight:"20px"};for(;null!==this.pagiList.firstChild;)this.pagiList.removeChild(this.pagiList.firstChild);a.map((e=>{let t;if(e===z.More)t=(0,O.tT)("li",{style:o},"...");else if(e===z.Left||e===z.Right){const s=e===z.Left?"◀":"▶";t=(0,O.tT)("li",{style:o,onClick:()=>{this.gotoPage(e)}},(0,O.tT)("a",{style:r,colorClass:"sidePagiAnchorColor"},s))}else t=e===this.currentPage?(0,O.tT)("li",{style:o,colorClass:"pagiActiveAnchorColor"},e):(0,O.tT)("li",{style:o,onClick:()=>{this.gotoPage(e)}},(0,O.tT)("a",{style:r,colorClass:"pagiAnchorColor",className:"pagiAnchor"},e));this.pagiList.appendChild(t)}))}updatePageInfo(e,t){this.pageCount=e,this.currentPage=t,this.updatePageDOM()}}class G{constructor(e){this.props=e,this.table=this.createTable(),this.pagination=this.createPagination(),this.props.rowHeaders.length===this.props.rowGenerators.length?(this.table.appendChild(this.createTableHeader()),this.element=(0,O.tT)("div",{colorClass:a.aG.textColor},this.createTableTitle(),this.createTableInfo(),this.createTableContainer(),this.pagination.element)):error("Settings table row header count does not match row generator count")}reset(){for(;null!==this.table.firstChild;)this.table.removeChild(this.table.firstChild);this.table.appendChild(this.createTableHeader())}addRow(e){this.table.appendChild(this.createRow(e))}updatePagination(e,t){e<=1?this.pagination.element.style.display="none":isNaN(e)||(this.pagination.element.style.display="",this.pagination.updatePageInfo(e,t))}createTableTitle(){return(0,O.tT)("div",{colorClass:"bluetxt",style:{fontSize:"1.4em",fontFamily:"'UbuntuMedium', Arial, Helvetica, sans-serif",fontWeight:"normal",textAlign:"center",marginTop:"20px"}},this.props.title)}createTableInfo(){return(0,O.tT)("p",{style:{textAlign:"center"}},this.props.info)}createTableContainer(){const e={width:"100%",minHeight:this.props.minHeight,borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",boxSizing:"border-box"};return(0,O.tT)("div",{colorClass:"table",style:e},this.table)}createTable(){return(0,O.tT)("table",{style:{width:"100%",borderCollapse:"collapse"}})}createTableHeader(){return(0,O.tT)("thead",{style:{borderBottomWidth:"2px",borderBottomStyle:"solid"}},(0,O.tT)("tr",null,this.props.rowHeaders.map((e=>this.createTableHeaderCell(e)))))}createTableHeaderCell(e){return(0,O.tT)("th",{style:{textAlign:"center",fontSize:"1.2em",padding:"3px"}},e)}createRow(e){return(0,O.tT)("tr",{colorClass:"row",style:{height:"22px",verticalAlign:"middle",borderBottomWidth:"1px",borderBottomStyle:"solid"}},this.props.rowGenerators.map((t=>t(e))))}createPagination(){return new K({requestNewPage:e=>{this.props.onPageRequest(e)}})}}class Q extends Z{constructor(){super(),this.paginationLimit=12,this.searchTerm="",this.apiUrl="api/ts/chat/banned-terms-list/",(0,a.fZ)(this.element,a.aG.textColor),this.element.style.overflow="visible",this.contents.style.width="720px",this.contents.style.padding="10px",this.table=new G({title:R.Ru.bannedTerms,info:R.Ru.bannedTermsInfo,onPageRequest:e=>{this.page=e,this.reload()},rowHeaders:[this.createHeaderTerm(),this.createHeaderSearchSubstrings(),R.Ru.remove],rowGenerators:[e=>this.createRowTerm(e),e=>this.createRowSearchSubstrings(e),e=>this.createRowRemove(e)],minHeight:"360px"}),this.contents.appendChild(this.table.element),this.contents.appendChild(this.createAddTermForm())}loadData(){let e=this.apiUrl;return""!==this.searchTerm?(e=`${this.apiUrl}?limit=${this.paginationLimit}&search_term=${this.searchTerm}`,this.searchTerm=""):void 0!==this.page&&(e=`${this.apiUrl}?page=${this.page}&limit=${this.paginationLimit}`),(0,_.Aw)(e).then((e=>function(e){const t=new H.N(e),s=t.getList("banned_terms");let i=[];return void 0!==s&&(i=s.map((e=>({term:e.getString("term"),banType:e.getString("ban_type")})))),{bannedTerms:i,pageCount:t.getNumber("page_count",!1),currentPage:t.getNumber("current_page",!1)}}(e.responseText)))}onDataLoaded(){this.page=this.data.currentPage,this.table.updatePagination(this.data.pageCount,this.page),this.generateTable(),""!==this.termInput.value&&this.termInput.focus(),this.termInput.value=""}generateTable(){this.table.reset();for(const e of this.data.bannedTerms)this.table.addRow(e)}createHeaderTerm(){return(0,O.tT)("div",{style:{width:"308px"}},R.Ru.term)}createHeaderSearchSubstrings(){const e={width:"14px",height:"14px",background:`transparent url(${STATIC_URL}broadcastnotification/infoicon.svg) no-repeat right 50%`,backgroundSize:"contain",display:"inline-block",marginLeft:"4px",position:"relative",verticalAlign:"top"},t=(0,I.q)({content:R.Ru.banAsSubstringExplanation,hasHTML:!1,width:(0,T.jl)(R.Ru.banAsSubstringExplanation,"12px UbuntuLight")+8,divotPosition:1,divotLeftOrTop:"28px"});return(0,T.ZM)(t,{bottom:"20px",left:"-32px",textAlign:"left",maxWidth:"280px",fontFamily:"UbuntuLight, Helvetica, Arial, sans-serif"}),(0,O.tT)("div",null,R.Ru.banAsSubstring,(0,O.tT)("span",{style:e,onMouseEnter:()=>t.style.display="",onMouseLeave:()=>t.style.display="none"},t))}createRowTerm(e){const t=(0,O.tT)("td",{style:{textAlign:"center",fontSize:"14px",overflowWrap:"break-word",hyphens:"auto",width:"300px",paddingLeft:"8px",display:"inline-block",lineHeight:"25px"}},e.term);return twemoji.parse(t),t}createRowSearchSubstrings(e){const t=new N.l("substring"===e.banType,(()=>{}),{width:28,height:16});return t.setOnChange((()=>{const s=t.isChecked()?"substring":"exact";(0,_.$e)(this.apiUrl,{term:e.term,ban_type:s}).catch((()=>{t.setCheckedDirectly(!t.isChecked()),(0,k.Q$)(R.Ru.errorUpdatingTerm)}))})),(0,O.tT)("td",{style:{textAlign:"center",padding:"4px 0"}},t.element)}createRowRemove(e){const t=(0,O.tT)("div",{colorClass:"removeButton",style:{margin:"auto",width:"14px",height:"14px",cursor:"pointer",opacity:".5"},onClick:()=>this.removeTerm(e),onMouseEnter:()=>{t.style.opacity="1"},onMouseLeave:()=>{t.style.opacity=".5"}});return(0,O.tT)("td",null,t)}createAddTermForm(){return this.termInput=(0,O.tT)("input",{style:{width:"160px",height:"16px",margin:"0 8px"},type:"text",name:"term",maxLength:30,placeholder:R.Ru.enterTermToBan}),(0,U.wu)("keydown",document,(e=>{document.body.contains(this.element)&&document.activeElement!==this.termInput&&(0,F.T6)(e)&&this.termInput.focus()})),(0,O.tT)("form",{colorClass:"bluetxt",style:{fontSize:"1.12em",fontFamily:"'UbuntuMedium', Arial, Helvetica, sans-serif",fontWeight:"normal",margin:"20px 0 8px",textAlign:"center"},onSubmit:e=>{e.preventDefault();const t=this.termInput.value.trim();""!==t?(0,_.KF)(this.apiUrl,{term:t}).then((()=>{this.searchTerm=t,this.reload()})).catch((e=>{const t=JSON.parse(e.xhr.responseText);if("string"==typeof t.error){const e=JSON.parse(t.error);(0,k.Q$)(e.term[0].message,(()=>this.termInput.focus()))}else(0,k.Q$)(R.Ru.errorBanningTerm,(()=>this.termInput.focus()))})):(0,k.Q$)(R.Ru.pleaseEnterTermToBan,(()=>this.termInput.focus()))}},(0,O.tT)("label",null,R.Ru.addTerm,":"),this.termInput,(0,O.tT)("button",{style:{cursor:"pointer",fontFamily:"'UbuntuMedium', Arial, Helvetica, sans-serif"},type:"submit",colorClass:"submitButton"},R.Ru.inlineBanText))}removeTerm(e){(0,_.ju)(this.apiUrl,{term:e.term}).then((()=>{this.reload()})).catch((()=>{(0,k.Q$)(R.Ru.errorRemovingTerm)}))}}var V=s(44941);function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=[];for(const s of e)t.push({username:s.getString("username"),created_by:s.getString("created_by"),expires_at:s.getString("expires_at"),created_at:s.getString("created_at"),id:s.getNumber("id")});return t}let J,q;b.X0.listen((e=>{J=e.chatConnection.room()}));class X extends Z{constructor(){super(),this.paginationLimit=12,this.clearHiddenSilences=document.createElement("p"),this.clearHiddenBans=document.createElement("p"),this.clearHiddenSilencesMessage=document.createTextNode(""),this.clearHiddenBansMessage=document.createTextNode(""),this.banType=["banned","silenced"],(0,a.fZ)(this.element,a.aG.textColor),this.contents.style.width="720px",this.contents.style.padding="10px",this.silenceTable=new G({title:R.Ru.silencedTableTitle,info:R.Ru.silencedUsersInfo,onPageRequest:e=>{this.banType="silenced",this.page=e,this.reload()},rowHeaders:[R.Ru.usernameText,R.Ru.silenced,R.Ru.expires,R.Ru.actions],rowGenerators:[e=>this.createRowName(e),e=>this.createRowCreationInfo(e),e=>this.createRowExpires(e),e=>this.createRowActions(e,!1)],minHeight:"286px"}),this.banTable=new G({title:R.Ru.bannedTableTitle,info:R.Ru.bannedUsersInfo,onPageRequest:e=>{this.banType="banned",this.page=e,this.reload()},rowHeaders:[R.Ru.usernameText,R.Ru.banned,R.Ru.expires,R.Ru.actions],rowGenerators:[e=>this.createRowName(e),e=>this.createRowCreationInfo(e),e=>this.createRowExpires(e),e=>this.createRowActions(e,!0)],minHeight:"286px"});const e=document.createElement("hr");e.style.marginTop="12px",this.createClearHiddenSilencesAndBans(this.clearHiddenSilences,this.clearHiddenSilencesMessage),this.createClearHiddenSilencesAndBans(this.clearHiddenBans,this.clearHiddenBansMessage),this.contents.appendChild(this.silenceTable.element),this.contents.appendChild(this.clearHiddenSilences),this.contents.appendChild(e),this.contents.appendChild(this.banTable.element),this.contents.appendChild(this.clearHiddenBans),this.contents.appendChild(document.createElement("br")),this.contents.appendChild(this.createAddBansForm())}loadData(){let e="api/ts/chat/ban-list/";return void 0!==this.page&&(e=`api/ts/chat/ban-list/?ban_types=${this.banType}&page=${this.page}&limit=${this.paginationLimit}`),(0,_.Aw)(e).then((e=>function(e){const t=new H.N(e),s=t.getMap("ban_dict",!1),i=t.getMap("silence_dict",!1);return{perm:t.getString("perm"),banDict:{bans:j(s.getList("bans")),pageCount:s.getNumber("page_count",!1),currentPage:s.getNumber("current_page",!1),hiddenBans:s.getNumber("hidden_bans",!1)},silenceDict:{silences:j(i.getList("silences")),pageCount:i.getNumber("page_count",!1),currentPage:i.getNumber("current_page",!1),hiddenSilences:i.getNumber("hidden_silences",!1)}}}(e.responseText)))}onDataLoaded(){this.silenceTable.updatePagination(this.data.silenceDict.pageCount,this.data.silenceDict.currentPage),this.banTable.updatePagination(this.data.banDict.pageCount,this.data.banDict.currentPage),this.generateTables(),this.generateClearSilencesAndBansMessages(),this.resetLoadParams()}generateTables(){if(this.resetTables(),this.banType.includes("silenced"))for(const e of this.data.silenceDict.silences)this.isUserBanned(e.username)||this.silenceTable.addRow(e);if(this.banType.includes("banned"))for(const e of this.data.banDict.bans)this.banTable.addRow(e)}isUserBanned(e){for(const t of this.data.banDict.bans)if(e===t.username)return!0;return!1}resetTables(){this.banType.includes("silenced")&&this.silenceTable.reset(),this.banType.includes("banned")&&this.banTable.reset()}createRowName(e){const t=e.username,s=document.createElement("td"),i=document.createElement("a");return(0,a.fZ)(i,a.aG.hrefColor),i.href=(0,_._Y)(`/${t}`),i.target="_blank",i.innerText=t,i.style.fontSize="15px",s.style.textAlign="center",i.style.textOverflow="ellipsis",i.style.overflow="hidden",i.style.marginTop="4px",s.appendChild(i),s}createRowCreationInfo(e){const t=e.created_at,s=e.created_by,i=document.createElement("td");i.title=R.Ru.createdAt(new Date(t)),i.style.fontSize="12px",i.style.textAlign="center",i.style.textOverflow="ellipsis",i.style.overflow="hidden",i.style.marginTop="4px";const n=document.createElement("span");n.innerText=(0,V.jM)(new Date,new Date(t));const a=this.createByUsername(` ${R.Ru.createdByUsername(s)}`);return i.appendChild(n),i.appendChild(a),i}createRowExpires(e){const t=e.expires_at,s=new Date(e.expires_at)>new Date(this.data.perm),i=document.createElement("td");return i.title=R.Ru.expiresOn(new Date(t)),i.innerText=s?R.Ru.never:(0,V.jM)(new Date,new Date(t)),i.style.textAlign="center",i.style.fontSize="12px",i.style.textOverflow="ellipsis",i.style.overflow="hidden",i}createRowActions(e,t){const s=e.id,i=new Date(e.expires_at)>new Date(this.data.perm),n=document.createElement("td"),o=document.createElement("a"),r=document.createElement("a"),l=document.createTextNode(" | ");return(0,a.fZ)(o,a.aG.hrefColor),(0,a.fZ)(r,a.aG.hrefColor),o.style.cursor="pointer",r.style.cursor="pointer",o.innerText=R.Ru.remove,r.innerText=t?R.Ru.makePermanent:R.Ru.convertToBan,n.style.textAlign="center",n.appendChild(o),i||(n.appendChild(l),n.appendChild(r)),o.onclick=()=>{this.editRoomBan(s,t?"remove_ban":"remove_silence")},r.onclick=()=>{this.editRoomBan(s,t?"ban_perm":"convert_to_ban")},n}createByUsername(e){const t=document.createElement("span");return(0,a.fZ)(t,"byUsername"),t.innerText=e,t.style.fontSize="0.8em",t}editRoomBan(e,t){(0,_.KF)("edit_room_ban/",{banid:String(e),action:t,room_username:J}).then((e=>{const t=e.responseText;if(null===t)return(0,k.Q$)(R.Ru.errorOccurred),void this.reload();let s;try{s=JSON.parse(t)}catch{return(0,k.Q$)(R.Ru.errorOccurred),void this.reload()}void 0!==s.error?((0,k.Q$)(s.error),void 0!==s.reload&&!0===s.reload&&this.reload()):this.reload()})).catch((()=>{(0,k.Q$)(R.Ru.errorOccurred)}))}getNumberOfHiddenSilences(){return this.data.silenceDict.hiddenSilences?this.data.silenceDict.hiddenSilences:0}getNumberOfHiddenBans(){return this.data.banDict.hiddenBans?this.data.banDict.hiddenBans:0}createClearHiddenSilencesAndBans(e,t){e.style.textAlign="center",e.appendChild(t);const s=document.createElement("a");(0,a.fZ)(s,a.aG.hrefColor),s.style.cursor="pointer",s.innerText=R.Ru.clickToClearHiddenBansAndSilences,s.onclick=()=>{(0,_.KF)(`clear_hidden_banned_users/${J}/`,{}).then((()=>{this.reload()})).catch((()=>{(0,k.Q$)("An error occurred removing hidden silences and bans")}))},e.appendChild(document.createElement("br")),e.appendChild(s)}generateClearSilencesAndBansMessages(){const e=this.getNumberOfHiddenSilences(),t=this.getNumberOfHiddenBans();this.clearHiddenSilences.style.display=0===e?"none":"",this.clearHiddenBans.style.display=0===t?"none":"",this.clearHiddenSilencesMessage.textContent=R.Ru.automaticallySilencedUsersMessage(e),this.clearHiddenBansMessage.textContent=R.Ru.automaticallyBannedUsersMessage(t)}createAddBansForm(){const e=document.createElement("form"),t=document.createElement("label"),s=document.createElement("input"),i=document.createElement("button");return(0,a.fZ)(i,"submitButton"),i.style.borderWidth="1px",i.style.borderStyle="solid",i.style.borderRadius="4px",i.style.cursor="pointer",i.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",t.innerText=`${R.Ru.addBan}:`,s.type="text",s.placeholder=R.Ru.enterUsernameToBan,i.type="submit",i.innerText=R.Ru.inlineBanText,e.appendChild(t),e.appendChild(s),e.appendChild(i),(0,a.fZ)(e,"bluetxt"),e.style.fontSize="1.12em",e.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.fontWeight="normal",e.style.marginBottom="20px",e.style.textAlign="center",s.style.width="160px",s.style.height="16px",s.style.margin="0 3px",(0,U.wu)("keydown",document,(e=>{document.body.contains(this.element)&&document.activeElement!==s&&(0,F.T6)(e)&&s.focus()})),e.onsubmit=e=>{e.preventDefault();const t=s.value;""!==t?t!==J?(0,_.KF)(`roomban/${t}/${J}/`,{}).then((()=>{s.value="",(0,k.Q$)(R.Ru.banUserSuccess(t),(()=>s.focus())),this.reload()})).catch((()=>{(0,k.Q$)(R.Ru.banUserError(t),(()=>s.focus()))})):(0,k.Q$)(R.Ru.cannotBanSelf,(()=>s.focus())):(0,k.Q$)(R.Ru.usernameToBan,(()=>s.focus()))},e}resetLoadParams(){this.banType=["banned","silenced"],this.page=void 0}}function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=[];for(const s of e)t.push({username:s.getString("username"),created_at:s.getString("created_at"),total:s.getNumber("total")});return t}function ee(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=[];for(const s of e)t.push({username:s.getString("username"),months:s.getNumber("months")});return t}class te extends Z{constructor(){super(),this.contentContainer=document.createElement("div"),this.fanClubTable=this.createTable(),this.fanClubTitle=this.createStyledTitle(),this.fanClubTableBody=document.createElement("tbody"),this.membersTable=this.createTable(),this.membersTitle=this.createStyledTitle(),this.membersTableBody=document.createElement("tbody"),this.contents.style.width="550px",this.contents.style.padding="10px",this.contents.appendChild(this.contentContainer);const e=this.createTableContainer(),t=this.createTableContainer();e.appendChild(this.fanClubTable),t.appendChild(this.membersTable),this.setupTitles();const s=document.createElement("p");(0,a.fZ)(s,a.aG.textColor),s.innerText=R.Ru.currentFanClubMembersInfo,s.style.textAlign="center";const i=document.createElement("p");(0,a.fZ)(i,a.aG.textColor),i.style.textAlign="center",i.innerHTML=R.Ru.allFanClubMembersInfo,this.contentContainer.appendChild(this.fanClubTitle),this.contentContainer.appendChild(s),this.contentContainer.appendChild(e),this.fanClubTable.appendChild(this.createFanClubTableHeader()),this.fanClubTable.appendChild(this.fanClubTableBody),this.contentContainer.appendChild(document.createElement("br")),this.contentContainer.appendChild(document.createElement("hr")),this.contentContainer.appendChild(this.membersTitle),this.contentContainer.appendChild(i),this.contentContainer.appendChild(t),this.membersTable.appendChild(this.createMembersTableHeader()),this.membersTable.appendChild(this.membersTableBody),this.emptyMessageContainer=document.createElement("div"),this.hideEmptyMessage(),this.emptyMessageContainer.appendChild(this.createEmptyMessage()),this.contents.appendChild(this.emptyMessageContainer)}loadData(){return(0,_.Aw)("api/ts/chat/fan-list/").then((e=>function(e){const t=new H.N(e);return{fans:Y(t.getList("fans")),old_members:ee(t.getList("old_members")),all_members:ee(t.getList("all_members"))}}(e.responseText)))}onDataLoaded(){0===this.data.all_members.length?this.displayEmptyMessage():(this.generateTables(),this.updateTitles())}createTable(){const e=document.createElement("table");return e.style.width="100%",e.style.borderCollapse="collapse",e}createStyledTitle(){const e=document.createElement("div");return(0,a.fZ)(e,"bluetxt"),e.style.fontSize="1.4em",e.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.fontWeight="normal",e.style.textAlign="center",e.style.marginTop="20px",e}createTableContainer(){const e=document.createElement("div");return(0,a.fZ)(e,"select"),e.style.width="100%",e.style.height=document.documentElement.clientHeight/3.5+"px",e.style.borderWidth="1px",e.style.borderStyle="solid",e.style.borderRadius="4px",e.style.overflowY="scroll",e}setupTitles(){this.fanClubTitle.innerText=R.Ru.currentFanClubMembersTitle(this.getNumberOfMembers()),this.membersTitle.innerText="All Members"}updateTitles(){this.fanClubTitle.innerText=R.Ru.currentFanClubMembersTitle(this.getNumberOfMembers())}createEmptyMessage(){const e=document.createElement("span");return(0,a.fZ)(e,"bluetxt"),e.innerText="No Current or Previous Fan Club Members",e.innerText="No Current or Previous Fan Club Members",e.style.fontSize="1.4em",e.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.fontWeight="normal",e.style.textAlign="center",e.style.marginTop="20px",e}displayEmptyMessage(){this.contentContainer.style.display="none",this.emptyMessageContainer.style.display=""}hideEmptyMessage(){this.emptyMessageContainer.style.display="none",this.contentContainer.style.display=""}getNumberOfMembers(){return void 0===this.data?0:this.data.fans.length}generateTables(){this.clearTables();for(const e of this.data.fans)this.fanClubTableBody.appendChild(this.createFanClubRow(e));for(const e of this.data.all_members)this.membersTableBody.appendChild(this.createMembersRow(e,this.isCurrentMember(e.username)))}clearTables(){for(;null!==this.fanClubTableBody.firstChild;)this.fanClubTableBody.removeChild(this.fanClubTableBody.firstChild);for(;null!==this.membersTableBody.firstChild;)this.membersTableBody.removeChild(this.membersTableBody.firstChild)}createFanClubRow(e){const t=document.createElement("tr");return t.style.height="22px",t.style.verticalAlign="middle",t.style.borderBottom="1px solid darkgray",t.appendChild(this.createRowName(e.username)),t.appendChild(this.createRowSince(e.created_at)),t.appendChild(this.createRowMonths(e.total)),t}createMembersRow(e,t){const s=document.createElement("tr");return s.style.height="22px",s.style.verticalAlign="middle",s.style.borderBottom="1px solid darkgray",t&&(s.style.fontWeight="bold"),s.appendChild(this.createRowName(e.username)),s.appendChild(this.createRowMonths(e.months)),s}createRowName(e){const t=document.createElement("td"),s=document.createElement("a");return(0,a.fZ)(s,"bluetxt"),s.href=(0,_._Y)(`/${e}`),s.target="_blank",s.innerText=e,s.style.fontSize="15px",s.style.textAlign="left",s.style.textOverflow="ellipsis",s.style.overflow="hidden",s.style.paddingLeft="12px",s.style.marginTop="4px",t.appendChild(s),t}createRowSince(e){const t=document.createElement("td");return t.title=`Since ${new Date(e)}`,t.style.fontSize="12px",t.style.textAlign="center",t.style.textOverflow="ellipsis",t.style.overflow="hidden",t.style.paddingLeft="6px",t.style.marginTop="4px",t.innerText=(0,V.jM)(new Date,new Date(e)),t}createRowMonths(e){const t=document.createElement("td");return t.style.fontSize="12px",t.style.textAlign="center",t.style.textOverflow="ellipsis",t.style.overflow="hidden",t.style.paddingLeft="6px",t.style.marginTop="4px",t.innerText=`${e} month${1===e?"":"s"}`,t}createFanClubTableHeader(){const e=document.createElement("thead");e.style.borderBottom="2px solid darkgray";const t=document.createElement("tr");return t.appendChild(this.createTableHeaderCell(R.Ru.usernameText)),t.appendChild(this.createTableHeaderCell(R.Ru.lastJoined)),t.appendChild(this.createTableHeaderCell(R.Ru.totalMonthsAMember)),e.appendChild(t),e}createMembersTableHeader(){const e=document.createElement("thead");e.style.borderBottom="2px solid darkgray";const t=document.createElement("tr");return t.appendChild(this.createTableHeaderCell(R.Ru.usernameText)),t.appendChild(this.createTableHeaderCell(R.Ru.totalMonthsAMember)),e.appendChild(t),e}createTableHeaderCell(e){const t=document.createElement("th");return t.innerText=e,t.style.textAlign="center",t.style.fontSize="1.2em",t.style.padding="3px",t}isCurrentMember(e){for(const t of this.data.old_members)if(t.username===e)return!1;return!0}}b.X0.listen((e=>{q=e.chatConnection.room()}));class se extends Z{constructor(){super();const e=document.createElement("div");(0,a.fZ)(e,"bluetxt"),e.innerText=R.Ru.removeModerators,e.style.fontSize="15px",e.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",e.style.textAlign="center",this.contents.appendChild(e);const t=document.createElement("div");(0,a.fZ)(t,a.aG.textColor),t.innerText=R.Ru.clickToUnmodText,t.style.margin="10px 0",t.style.textAlign="center",this.contents.appendChild(t);const s=document.createElement("div");s.style.display="inline-block",s.style.marginRight="10px";const i=document.createElement("div");(0,a.fZ)(i,"bluetxt"),i.innerText=R.Ru.moderators,i.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",i.style.fontWeight="bold",s.appendChild(i),this.modSelect=document.createElement("select"),(0,a.fZ)(this.modSelect,"select"),this.modSelect.multiple=!0,this.modSelect.style.borderWidth="1px",this.modSelect.style.borderStyle="solid",this.modSelect.style.borderRadius="4px",this.modSelect.style.marginTop="4px",this.modSelect.style.width="200px",this.modSelect.style.height="200px",this.modSelect.style.padding="2px",this.modSelect.onchange=()=>{const e=this.modSelect.selectedOptions.length,t=[...this.modSelect.selectedOptions];for(let s=0;s<e;s+=1){const e=t[s];e.selected=!1,this.unmodSelect.appendChild(e)}},s.appendChild(this.modSelect),this.contents.appendChild(s);const n=document.createElement("div");n.style.display="inline-block";const o=document.createElement("div");(0,a.fZ)(o,"bluetxt"),o.innerText=R.Ru.nonModerators,o.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",o.style.fontWeight="bold",n.appendChild(o),this.unmodSelect=document.createElement("select"),(0,a.fZ)(this.unmodSelect,"select"),this.unmodSelect.multiple=!0,this.unmodSelect.style.borderWidth="1px",this.unmodSelect.style.borderStyle="solid",this.unmodSelect.style.borderRadius="4px",this.unmodSelect.style.marginTop="4px",this.unmodSelect.style.width="200px",this.unmodSelect.style.height="200px",this.unmodSelect.style.padding="2px",this.unmodSelect.onchange=()=>{const e=this.unmodSelect.selectedOptions.length,t=[...this.unmodSelect.selectedOptions];for(let s=0;s<e;s+=1){const e=t[s];e.selected=!1,this.modSelect.appendChild(e)}},n.appendChild(this.unmodSelect),this.contents.appendChild(n);const r=document.createElement("div");r.style.textAlign="right";const l=document.createElement("span");(0,a.fZ)(l,"saveButton"),(0,a.fZ)(l,"gradient"),l.innerText=R.Ru.saveCAPS,l.style.display="inline-block",l.style.fontFamily="UbuntuMedium, Helvetica, Arial, sans-serif",l.style.fontSize="14px",l.style.padding="5px 15px 5px 15px",l.style.marginTop="10px",l.style.borderRadius="4px",l.style.cursor="pointer",r.appendChild(l),l.onclick=()=>{for(const e of this.unmodSelect.options)(0,_.KF)(`removemoderator/${e.value}/${q}/`,{}).then().catch((()=>{(0,k.Q$)(`An error occurred removing moderator status from ${e.value}`)}));this.hide()},this.contents.appendChild(r)}loadData(){return(0,_.Aw)("api/ts/chat/mod-list/").then((e=>{return t=e.responseText,{mods:new H.N(t).getStringList("mods")};var t}))}onDataLoaded(){for(;null!==this.modSelect.firstChild;)this.modSelect.removeChild(this.modSelect.firstChild);for(;null!==this.unmodSelect.firstChild;)this.unmodSelect.removeChild(this.unmodSelect.firstChild);for(const e of this.data.mods){const t=document.createElement("option");t.innerText=e,t.value=e,this.modSelect.appendChild(t)}}}class ie extends Z{constructor(){super(),this.page=1,this.paginationLimit=12,this.searchTerm="",this.apiUrl="api/ts/chat/geo-list/",this.inputResponseMsg=document.createElement("div"),this.handleAPIError=e=>{const t=JSON.parse(e.xhr.responseText);"string"==typeof t.error?this.setInputResponseMessage(t.error,!0):this.setInputResponseMessage(R.Ru.anErrorOccurred,!0)},this.table=new G({title:R.Ru.regionBlockExemptions,info:R.Ru.regionBlockExemptionsInfo,onPageRequest:e=>{this.page=e,this.reload()},rowHeaders:[this.createUsernameHeader(),R.Ru.remove],rowGenerators:[e=>this.createUsernameCell(e),e=>this.createRemoveCell(e)],minHeight:"350px"}),this.table.element.style.marginBottom="10px",this.contents.appendChild(this.table.element),this.buildAddUsernameForm(),this.contents.appendChild(this.addUsernameForm)}createUsernameHeader(){const e=document.createElement("span");return e.style.display="inline-block",e.style.width="100%",e.style.textAlign="left",e.style.paddingLeft="29px",e.textContent=R.Ru.usernameText,e}createUsernameCell(e){const t=document.createElement("td");return t.style.height="20px",t.style.width="200px",t.style.fontSize="14px",t.style.textAlign="left",t.style.textOverflow="ellipsis",t.style.overflow="hidden",t.style.display="block",t.style.paddingLeft="32px",t.style.marginTop="4px",t.textContent=e,t}createRemoveCell(e){const t=document.createElement("td");t.style.width="140px";const s=document.createElement("div");return(0,a.fZ)(s,"removeButton"),s.style.margin="auto",s.style.width="14px",s.style.height="14px",s.style.cursor="pointer",s.style.opacity=".5",s.onclick=()=>this.delete(e),s.onmouseenter=()=>{s.style.opacity="1"},s.onmouseleave=()=>{s.style.opacity=".5"},t.appendChild(s),t}buildAddUsernameForm(){const e=document.createElement("form");e.style.fontSize="1.12em",e.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",e.style.fontWeight="normal",e.style.textAlign="center",e.style.paddingLeft="4px";const t="regionBlockInput",s=document.createElement("label");(0,a.fZ)(s,"bluetxt"),s.innerText=`${R.Ru.addUsername}:`,s.htmlFor=t,e.appendChild(s);const i=document.createElement("input");(0,a.fZ)(i,"select"),i.id=t,i.style.width="134px",i.style.height="16px",i.style.margin="0 8px",i.type="text",e.appendChild(i);const n=document.createElement("button");(0,a.fZ)(n,"submitButton"),n.style.cursor="pointer",n.style.fontFamily="'UbuntuMedium', Arial, Helvetica, sans-serif",n.type="submit",n.innerText=R.Ru.add,e.appendChild(n);const o=document.createElement("div");o.style.marginTop="4px",e.appendChild(o),e.onsubmit=e=>{e.preventDefault(),this.submit()},this.usernameInput=i,this.inputResponseMsg=o,this.addUsernameForm=e}setInputResponseMessage(e,t){t?((0,a.SA)(this.inputResponseMsg,"bluetxt"),(0,a.fZ)(this.inputResponseMsg,"inputError"),this.inputResponseMsg.style.fontSize="0.8em"):((0,a.SA)(this.inputResponseMsg,"inputError"),(0,a.fZ)(this.inputResponseMsg,"bluetxt"),this.inputResponseMsg.style.fontSize="0.8em"),this.inputResponseMsg.innerText=e,this.inputResponseMsg.style.transition="opacity 0ms",this.inputResponseMsg.style.opacity="1",clearTimeout(this.responseTimer),this.responseTimer=window.setTimeout((()=>{this.inputResponseMsg.style.transition="opacity 1000ms",this.inputResponseMsg.style.opacity="0"}),2500)}loadData(){let e;return""!==this.searchTerm?(e=`${this.apiUrl}?limit=${this.paginationLimit}&search_term=${this.searchTerm}`,this.searchTerm=""):e=`${this.apiUrl}?page=${this.page}&limit=${this.paginationLimit}`,(0,_.Aw)(e).then((e=>function(e){const t=new H.N(e);return{geos:t.getStringList("geos"),pageCount:t.getNumber("page_count",!1),currentPage:t.getNumber("current_page",!1)}}(e.responseText)))}onDataLoaded(){this.page=this.data.currentPage,this.table.updatePagination(this.data.pageCount,this.page),this.table.reset(),this.usernameInput.focus();for(const e of this.data.geos.sort())this.table.addRow(e)}submit(){const e=this.usernameInput.value;this.usernameInput.value="",(0,_.KF)(this.apiUrl,{username:e}).then((()=>{this.searchTerm=e,this.reload(),this.setInputResponseMessage(R.Ru.userAddedToExemptList,!1)})).catch(this.handleAPIError).finally((()=>this.usernameInput.focus()))}delete(e){(0,_.ju)(this.apiUrl,{username:e}).then((()=>{this.reload()})).catch(this.handleAPIError)}}class ne extends D.m{constructor(){super()}initData(){super.initData(),this.regionBlockModal=new ie,this.bansAndSilencesModal=new X,this.moderatorsModal=new se,this.fanClubModal=new te,this.bannedTermsModal=new Q}createUserSettings(){this.usersSettings.appendChild(this.createSortUsers()),this.usersSettings.appendChild(this.createHighestTokenColorPicker()),this.usersSettings.appendChild(this.createChatAllowedBy()),this.usersSettings.appendChild(this.createModeratorsExpireAfter()),this.usersSettings.appendChild(this.createSilenceOtherBroadcasters())}createNotificationSettings(){super.createNotificationSettings(),this.notificationsSettings.appendChild(this.createC2CNotificationLimit())}createOtherSettings(){this.otherSettings.appendChild(this.createTipVolumePicker()),(0,v.Uo)()&&this.otherSettings.appendChild(this.createCollapseNoticesPicker()),this.otherSettings.appendChild(this.createModalLink(R.Ru.viewEditBansAndSilences,this.bansAndSilencesModal)),this.otherSettings.appendChild(this.createModalLink(R.Ru.viewEditModerators,this.moderatorsModal)),this.otherSettings.appendChild(this.createModalLink(R.Ru.viewFanClubMembers,this.fanClubModal)),this.otherSettings.appendChild(this.createModalLink(R.Ru.viewEditRegionBlockExemptions,this.regionBlockModal)),this.otherSettings.appendChild(this.createManageIgnoredUsersPicker()),this.otherSettings.appendChild(this.createModalLink(R.Ru.viewEditBannedTerms,this.bannedTermsModal))}createSortUsers(){const e=document.createElement("label");return this.sortUsersSelect=document.createElement("select"),this.sortUsersSelect.dataset.testid="sort-users-select",this.createRow(e,R.Ru.sortUsers,this.sortUsersSelect,this.getSortUsersOptions())}createChatAllowedBy(){return this.chatAllowedByLabel=document.createElement("label"),this.chatAllowedBySelect=document.createElement("select"),this.chatAllowedBySelect.dataset.testid="chat-allowed-by-select",this.createRow(this.chatAllowedByLabel,R.Ru.chatAllowedBy,this.chatAllowedBySelect,this.getChatAllowedByOptions())}createModeratorsExpireAfter(){const e=document.createElement("label");return this.moderatorsExpireAfterSelect=document.createElement("select"),this.moderatorsExpireAfterSelect.dataset.testid="moderators-expire-after-select",this.createRow(e,R.Ru.moderatorsExpireAfter,this.moderatorsExpireAfterSelect,this.getModeratorsExpireAfterOptions())}createSilenceOtherBroadcasters(){const e=document.createElement("label");return this.silenceOtherBroadcastersSelect=document.createElement("select"),this.silenceOtherBroadcastersSelect.dataset.testid="silence-other-broadcasters-select",this.createRow(e,R.Ru.silenceOtherBroadcasters,this.silenceOtherBroadcastersSelect,this.getSilenceOtherBroadcastersOptions())}createC2CNotificationLimit(){const e=document.createElement("label");return this.c2cNotificationLimitSelect=document.createElement("select"),this.c2cNotificationLimitSelect.dataset.testid="notify-rate-limit-select",this.createRow(e,R.Ru.preventC2CRedisplay,this.c2cNotificationLimitSelect,this.getC2CNotificationLimitOptions())}getSortUsersOptions(){return[{label:R.Ru.alphabetically,value:"a"},{label:R.Ru.tokensCC,value:"t"}]}getChatAllowedByOptions(){return[{label:R.Ru.allUsers,value:"all"},{label:R.Ru.usersWhoTippedToday,value:"tip_recent"},{label:R.Ru.usersWhoHaveTipped,value:"tip_anytime"},{label:R.Ru.usersWhoHaveTokens,value:"tokens"}]}getModeratorsExpireAfterOptions(){return[{label:R.Ru.oneDay,value:"1"},{label:R.Ru.twoDays,value:"2"},{label:R.Ru.oneWeek,value:"7"},{label:R.Ru.twoWeeks,value:"14"},{label:R.Ru.oneMonth,value:"30"},{label:R.Ru.twoMonths,value:"60"},{label:R.Ru.sixMonths,value:"180"}]}getSilenceOtherBroadcastersOptions(){return[{label:R.Ru.no,value:"false"},{label:R.Ru.yesIfBroadcasting,value:"live"},{label:R.Ru.yesAlways,value:"true"}]}getC2CNotificationLimitOptions(){return[{label:R.Ru.noLimit,value:"0"},{label:R.Ru.fiveMinutes,value:"300"},{label:R.Ru.forever,value:"-1"}]}getSaveEndpoint(){return"api/broadcasterchatsettings/"}getSaveColorEndpoint(){return"choose_broadcaster_chat_color/"}hasModeratorPrivileges(){return!0}isBroadcaster(){return!0}getFormData(){const e=super.getFormData();return e.sort_users=this.sortUsersSelect.value,e.allowed_chat=this.chatAllowedBySelect.value,e.mod_expire=this.moderatorsExpireAfterSelect.value,e.silence_broadcasters=this.silenceOtherBroadcastersSelect.value,e.c2c_notify=this.c2cNotificationLimitSelect.value,e.broadcaster_tip_volume=e.viewer_tip_volume,e}updateChatSettings(e){super.updateChatSettings(e),this.sortUsersSelect.value=e.sortUsersKey,this.chatAllowedBySelect.value=e.allowedChat,this.moderatorsExpireAfterSelect.value=e.modExpiration.toString(10),this.silenceOtherBroadcastersSelect.value=e.silenceBroadcasters,this.c2cNotificationLimitSelect.value=e.c2cNotificationLimit}setUserChatSettings(){super.setUserChatSettings(),this.userChatSettings.sortUsersKey=this.sortUsersSelect.value,this.userChatSettings.allowedChat=this.chatAllowedBySelect.value,this.userChatSettings.modExpiration=parseInt(this.moderatorsExpireAfterSelect.value),this.userChatSettings.silenceBroadcasters=this.silenceOtherBroadcastersSelect.value,this.userChatSettings.c2cNotificationLimit=(0,L.sp)(this.c2cNotificationLimitSelect.value)}handleRoomLoaded(e){super.handleRoomLoaded(e),!1===e.dossier.isAgeVerified&&(this.chatAllowedByLabel.innerText=`${R.Ru.chatAllowedBy} (${R.Ru.ageVerificationRequired})`,this.chatAllowedByLabel.style.color="#888",this.chatAllowedBySelect.title=`${R.Ru.onlyAgeVerifiedCanChangeSetting}.`,this.chatAllowedBySelect.disabled=!0,this.chatAllowedBySelect.onclick=e=>{e.preventDefault(),this.chatAllowedBySelect.blur()})}createModalLink(e,t){const s=document.createElement("label"),i=this.createSettingsLink(s,e);return i.appendChild(s),s.onclick=()=>{t.reload(),t.show()},i}}var ae=s(27407),oe=s(62146),re=s(7176),le=s(62091);class he extends u.YI{constructor(){super(),this.chatSettings=this.createChatSettings(),this.settingInput=!1,this.element.id="SplitModeChatSettingsTab",this.element.dataset.testid="chat-settings-tab",(0,a.fZ)(this.element,a.aG.defaultColor),this.element.style.fontSize="12px",this.element.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",this.element.style.boxSizing="border-box";const e=document.createElement("div");(0,T.ZM)(e,{display:"flex",flexDirection:"column",height:"100%"}),this.element.appendChild(e),(0,T.ZM)(this.chatSettings,{flex:1,height:""}),this.inputDiv=(0,le.gI)();const t=(0,le.zh)();this.inputField=(0,le.Zw)((()=>!1),Math.max(le.hk,le.mU));const s=()=>{this.settingInput||(this.chatSettings.hideModals(),void 0!==this.parent&&this.parent.changeToFirstTab())};(0,U.wu)("click",this.inputField.element,s),(0,U.wu)("focus",this.inputField.element,s);const i=document.createElement("span");new(A.c.get("SendButton"))({onClick:s,isPm:!1,variant:"SplitMode"},i),this.buttonHolder=new B.J,this.buttonHolder.addButton(i,B.z.Text),t.appendChild(this.inputField.element),this.inputDiv.appendChild(t),this.inputDiv.appendChild(this.buttonHolder.element),e.appendChild(this.inputDiv);const n=document.createElement("div");let o;n.dataset.testid="save-notice",n.innerText=R.Ru.chatSettingsSavedText,n.style.position="absolute",n.style.top="30px",n.style.right="10px",n.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",n.style.color="#000000",n.style.backgroundColor="#d8deea",n.style.border="1px solid #acacac",n.style.borderRadius="4px",n.style.padding="8px 12px",n.style.visibility="hidden",this.element.appendChild(n),E.L.changeVideoMode.listen((()=>{"split"===E.L.getVideoMode()&&(e.insertBefore(this.chatSettings.element,this.inputDiv),this.chatSettings.element.style.margin="0")})),this.chatSettings.chatSettingsSavedRequest.listen((()=>{clearTimeout(o),(0,oe.Ve)(n,"250ms"),n.style.visibility="visible",o=window.setTimeout((()=>{(0,oe.Ve)(n,"1000ms"),n.style.visibility="hidden"}),3e3)}))}getHandleStyle(){const e={...super.getHandleStyle(),backgroundRepeat:"no-repeat",backgroundPosition:"center",boxSizing:"border-box",minHeight:"20px",height:"unset"};return e.minWidth="34px",e}createChatSettings(){return d.B.current.isBroadcast?new ne:new D.m}getChatSettings(){return this.chatSettings}getTabHandleContent(){return this.collapsed?[document.createTextNode(R.Ru.chatSettingsTabHandleText)]:[(0,re.Kj)(0)]}getTabId(){return"settings-tab-default"}focusCurrentChatInput(){this.inputField.focus()}blurCurrentChatInput(){this.inputField.blur()}isInputFocused(){return document.activeElement===this.inputField.element}scrollToBottom(){this.chatSettings.element.scrollTop=this.chatSettings.element.scrollHeight-this.chatSettings.element.offsetHeight}getInputText(){return this.inputField.getText()}setInputText(e){this.settingInput=!0,this.inputField.setText(e),this.inputField.blur(),window.setTimeout((()=>{this.settingInput=!1}),100)}getChatInputField(){return this.inputField}tabHandleClicked(e){super.tabHandleClicked(e),(0,ae.bT)("FocusTab",{location:"chatSettings"})}}var de=s(18529),ce=s(31448),ue=s(21728),pe=s(84364),me=s(89510),ge=s(65728),be=s(11224),ye=s(90106),Ce=s(74);class Te extends u.YI{constructor(e,t){super(),this.leavePmTab=e,this.inBroadcast=t,this.numUnread=0,this.otherUserInitiatedPm=new f.c_("otherUserInitiatedPm"),this.pmSessions=new Map,this.orderedPMSessionKeys=new ye.J,this.sendPrivateMessageFailCallback=e=>{const t=this.orderedPMSessionKeys.currentElem,s=this.pmSessions.get(t);(0,n.SU)()&&e.showDmLink?s.chatTabContents.appendMessageDiv((0,ce.dD)(e.errorMessage,e.username)):s.chatTabContents.appendMessageDiv((0,ce.CM)(e.errorMessage))},this.element.classList.add("data-hj-suppress"),this.pmList=new ue.U({isFullVideoMode:!1,clearSearchOnSelect:!0,openConversationEvent:l.BM,inBroadcast:this.inBroadcast}),this.addChild(this.pmList),P.E3.listen((e=>{this.hideCurrentPMSession(),this.hidePMList(),void 0===this.pmSessions.get(e.username)&&this.initializePmSession(e.username,!1,e.showSupporterAlert),this.orderedPMSessionKeys.makeCurrent(e.username),this.refreshTabs(),e.focus&&this.changeToThisTab(),this.showCurrentPMSession()})),b.X0.listen((e=>{this.chatConnection=e.chatConnection,this.room=e.dossier.room})),b.Gr.listen((()=>{this.emptyQueue();for(const e of this.pmSessions.keys())this.closePMSession(e,!0)})),l.wl.listen((e=>{this.closePMSession(e)})),l.BM.listen((e=>{this.hideCurrentPMSession(),this.orderedPMSessionKeys.makeCurrent(e),this.showCurrentPMSession()})),ge.yA.listen((e=>{this.showPMList(e,!0)})),P.ME.listen((()=>{const e=this.pmSessions.get(this.orderedPMSessionKeys.currentElem);!1===e.isAllHistoryLoaded&&this.loadHistoryMessages(e)})),n.lX.listen((e=>{this.orderedPMSessionKeys.addToTop(e),this.initializePmSession(e,!1,!1)})),l.J9.listen((e=>{this.newPrivateMessage(e);const t=this.currentPmSession();this.inActiveVideoMode()&&this.tabHasFocus()&&void 0!==t&&t.isActive()&&(this.addPageActions(t,e),e.otherUsername!==t.username||t.chatTabContents.isScrolledUp()||l.Si.fire(t.username))})),pe.yT.unreadConversationsCountUpdate.listen((e=>{let{pmsCount:t}=e;this.setNumUnread(t)}))}addPageActions(e,t){var s;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=(null===(s=d.B.current.loggedInUser)||void 0===s?void 0:s.username)===t.fromUser.username,a=e.username===t.fromUser.username;e.isActive()&&!i&&!n&&a&&(0,ae.bT)("PMReceivedOpen",{message_id:t.messageID})}showPMList(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e){this.hideCurrentPMSession();const e=this.inBroadcast&&0===this.pmSessions.size,s=(0,M.b5)();t||this.pmSessions.size>1||e||s?(this.pmList.element.style.display="block",this.pmList.repositionChildrenRecursive()):(this.inBroadcast||this.orderedPMSessionKeys.makeCurrent((0,M.P8)()),this.showCurrentPMSession())}}hidePMList(){this.pmList.element.style.display="none"}scrollToBottom(){const e=this.currentPmSession();void 0!==e&&e.chatTabContents.scrollToBottom()}getNumUnread(){return this.numUnread}setNumUnread(e){e!==this.numUnread&&(this.numUnread=e,this.refreshTabs())}getTabHandleContent(){const e=R.Ru.PmCAPS;let t;return t=this.numUnread>99?`${e} (99+)`:this.numUnread>0?`${e} (${this.numUnread})`:e,[document.createTextNode(t)]}getInputText(){const e=this.currentPmSession();return void 0===e?"":e.chatTabContents.getInputText()}setInputText(e){const t=this.currentPmSession();void 0!==t&&t.chatTabContents.setInputText(e)}tabHandleClicked(e){(0,ae.bT)("FocusTab",{location:"PM",unread:this.getNumUnread()}),this.changeToThisTab(),this.showPMList(!1)}getTabId(){return"pm-tab-default"}tabHasFocus(){return"block"===this.element.style.display}focusCurrentChatInput(){const e=this.currentPmSession();void 0!==e&&e.chatTabContents.focusCurrentChatInput()}blurCurrentChatInput(){const e=this.currentPmSession();void 0!==e&&e.chatTabContents.blurCurrentChatInput()}isInputFocused(){const e=this.currentPmSession();return void 0!==e&&e.chatTabContents.isInputFocused()}initializePmSession(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.pmSessions.get(e);if(void 0===a){(0,f.jU)();const i=new le.__({onTipRequest:e=>{Ce.i5.fire(e)},onToggleDebugMode:()=>{this.chatConnection.toggleAppDebugging()},onChatMessage:t=>{this.orderedPMSessionKeys.addToTop(e);const s={message:t,username:e,media:[],source:"roomviewPM",roomName:this.chatConnection.room()},i=a.mediaDock.sibling;i.isEmpty()?(0,n.F_)(s).catch((e=>{this.sendPrivateMessageFailCallback(e)})):i.mediaList().then((e=>{s.media=e,(0,n.F_)(s).catch((e=>{this.sendPrivateMessageFailCallback(e)})),i.clear()}))}},(()=>!1),e);if(a={chatTabContents:i,hasUnread:!1,username:e,loadHistoryMessagesDOM:new ge.b3,isInitialHistoryLoaded:!1,isAllHistoryLoaded:!1,mediaDock:new me.$w(i,e,["split"]),isActive:()=>"none"!==i.element.style.display},i.scrolledToBottom.listen((()=>{void 0!==a&&this.isPmSessionShowing(a)&&l.Si.fire(e)})),this.pmSessions.set(e,a),(0,me.c6)(a.chatTabContents.element,e),a.chatTabContents.initMediaDocks(a.mediaDock),a.chatTabContents.appendNoticeDiv((0,ce.CM)(R.Ru.privateConversationWithText(e))),a.chatTabContents.appendNoticeDiv((0,ce.CM)(R.Ru.conversationCautionMessage(be.m.siteName))),!t&&s){var r,h;const t=null!==(r=null===(h=d.B.current.loggedInUser)||void 0===h?void 0:h.isAgeVerified)&&void 0!==r&&r;a.chatTabContents.appendNoticeDiv((0,ce.YC)(e,t))}else a.chatTabContents.appendNoticeDiv(a.loadHistoryMessagesDOM.getElement());a.chatTabContents.element.style.display="none",this.addChild(a.chatTabContents)}return!i&&t&&this.otherUserInitiatedPm.fire({username:e,PMChatLink:new o.Qc({onClick:()=>{P.E3.fire({username:e,focus:!0,showSupporterAlert:!1})}})}),void 0===this.orderedPMSessionKeys.currentElem&&this.orderedPMSessionKeys.makeCurrent(e),a}loadHistoryMessages(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.loadHistoryMessagesDOM.isShowing())return;e.loadHistoryMessagesDOM.showLoading();const s=e.chatTabContents.messageList.clientHeight,i=t?"0":e.chatTabContents.getEarliestMessageId();(0,n.O2)(e.username,this.chatConnection.room(),i).then((i=>{e.loadHistoryMessagesDOM.hideLoading();const a=i.messages;a.length<n.j&&(e.isAllHistoryLoaded=!0),a.forEach((e=>{this.newPrivateMessage(e,!0)})),a.length>0&&e.chatTabContents.setEarliestMessageId(a[0].messageID),t&&this.maybeUpdateConversationListItem(a);const o=e.chatTabContents.messageList.clientHeight;e.chatTabContents.messageListWrapper.scrollTop=o-s})).catch((()=>{}))}maybeUpdateConversationListItem(e){if(0===e.length)return;const t=e[e.length-1];(0,n.ug)(t.otherUsername,this.room).then((e=>{var s,i;pe.yT.conversationLoaded.fire({message:t.message,numUnread:null!==(s=this.numUnread)&&void 0!==s?s:0,time:null===(i=t.createdAt)||void 0===i?void 0:i.getTime(),fromUsername:t.fromUser.username,otherUser:e.user,hasMedia:t.mediaList.length>0,room:this.room})}))}newPrivateMessage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.appendMessageDiv((0,ce.j7)(e),e.fromUser.username,e.otherUsername,t);const s=(0,ce.bB)(e);void 0!==s&&this.appendMessageDiv(s,e.fromUser.username,e.otherUsername,t)}appendMessageDiv(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,p.at)(e,document.body.classList.contains("darkmode")),this.orderedPMSessionKeys.addToTop(s);const n=this.initializePmSession(s,t!==this.chatConnection.username(),!1,i);i&&!1===n.isInitialHistoryLoaded&&(n.isInitialHistoryLoaded=!0),this.chatConnection.username()===t||this.isCurrentTab()&&this.orderedPMSessionKeys.currentElem===s||(n.hasUnread=!0,this.refreshTabs()),n.isInitialHistoryLoaded&&n.chatTabContents.appendMessageDiv(e,!0)}possiblyAppendMessageDiv(e){if(this.isCurrentTab()){const t=this.currentPmSession();void 0!==t&&t.chatTabContents.appendMessageDiv(e)}}currentPmSession(){if(void 0!==this.orderedPMSessionKeys.currentElem)return this.pmSessions.get(this.orderedPMSessionKeys.currentElem)}showNextPMSession(){return this.showNextOrPrevPMSession("next")}showPrevPMSession(){return this.showNextOrPrevPMSession("prev")}showNextOrPrevPMSession(e){return this.hideCurrentPMSession(),void 0!==("next"===e?this.orderedPMSessionKeys.nextElem():this.orderedPMSessionKeys.prevElem())&&(this.showCurrentPMSession(),!0)}closePMSession(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e===this.room&&!t)return;const s=this.pmSessions.get(e);void 0!==s&&(this.orderedPMSessionKeys.remove(e),s.chatTabContents.dispose(),this.removeChild(s.chatTabContents),this.pmSessions.delete(e),this.isCurrentTab()&&(this.pmSessions.size>0?this.showPMList(!1,!0):this.leavePmTab()),this.refreshTabs(),(0,f.Rj)(),(0,ue.i)(s.username,!1))}closeCurrentPMSession(){const e=this.currentPmSession();void 0!==e&&this.closePMSession(e.username)}resetNextQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys.refillFromDiscard()}resetPrevQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys.emptyDrawIntoDiscard()}emptyQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys=new ye.J}showCurrentPMSession(){let e=this.orderedPMSessionKeys.currentElem;void 0===e&&(e=this.chatConnection.room(),this.orderedPMSessionKeys.makeCurrent(e));let t=this.pmSessions.get(e);void 0===t&&this.initializePmSession(e,!1,!1),t=this.pmSessions.get(e),t.isInitialHistoryLoaded||void 0===d.B.current.loggedInUser||(t.isInitialHistoryLoaded=!0,this.loadHistoryMessages(t,!0)),this.hidePMList(),t.chatTabContents.showElement(),t.chatTabContents.repositionChildrenRecursive(),t.chatTabContents.scrollToBottom(),this.tabHasFocus()&&this.inActiveVideoMode()&&(t.hasUnread&&(t.hasUnread=!1,this.refreshTabs()),l.Si.fire(t.username),b.Zm.fire(t.username)),P.PV.fire()}getSession(e){return this.pmSessions.get(e)}hideCurrentPMSession(){const e=this.currentPmSession();void 0!==e&&(e.chatTabContents.element.style.display="none")}getChatInputField(){const e=this.currentPmSession();if(void 0!==e)return e.chatTabContents.customInputField}inActiveVideoMode(){return"split"===E.L.getVideoMode()}isPmSessionShowing(e){return this.inActiveVideoMode()&&this.tabHasFocus()&&this.currentPmSession()===e&&"none"===this.pmList.element.style.display}}var fe=s(63448),ve=s(43058);class Se extends u.Zz{constructor(){let e,t,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(super(),this.inBroadcast=s,this.chatTab=this.createChatTab(),this.userListTab=new ve.R,this.settingsTab=new he,this.inPrivateRoom=!1,this.privateShowUser="",this.room="",this.tabHeight=22,this.perRoomListeners=new f.gt,this.tabHandlesRow.element.style.boxSizing="border-box",this.tabHandlesRow.element.style.borderBottom="",this.tabHandlesRow.element.style.height=`${this.tabHeight}px`,this.window.style.width="",this.window.style.position="",this.window.style.height=`calc(100% - ${this.tabHeight}px)`,this.element.id="ChatTabContainer",this.element.style.display="inline-block",this.element.style.position="",this.element.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",this.element.style.borderRadius="4px 4px 2px 2px",this.element.style.margin="0",this.element.style.boxSizing="border-box",this.element.style.overflow="hidden",this.element.style.height="0",this.element.style.minHeight="100%",this.tabHandleStyle={...this.tabHandleStyle,position:"static",fontSize:"12px",marginRight:"2px",padding:"3px 8px"},this.chatTab=this.addTab(this.chatTab),(()=>{this.pmTab=this.addTab(new Te((()=>{this.changeToTab(this.chatTab)}),this.inBroadcast)),this.pmTab.showElement()})(),this.userListTab=this.addTab(this.userListTab),this.settingsTab=this.addTab(this.settingsTab),this.tabHandlesRow.element.style.padding="1px 3px 0 3px",this.settingsTab.handle.element.dataset.pactionName="Settings",this.userListTab.handle.element.dataset.pactionName="USERS",this.expandableDropDownMenu=this.constructExpandableDropDownMenu(),this.tabHandlesRow.addChild(this.expandableDropDownMenu),this.tabHandlesRow.element.dataset.paction="Chat",this.changeToTab(this.chatTab),this.initNoticeDeclutterer(),b.X0.listen((e=>{this.room=e.chatConnection.room(),this.changeToTab(this.chatTab),(0,M.b5)()||P.E3.fire({username:e.dossier.room,focus:!1,showSupporterAlert:e.dossier.needsSupporterToPm}),e.chatConnection.event.roomShortcode.listen((e=>{const t=(0,ce.j8)(e);this.chatTab.chatTabContents.appendMessageDiv(t)})),e.chatConnection.event.roomMessage.listen((e=>{this.newChatMessage(e)})),e.chatConnection.event.roomNotice.listen((e=>{this.newRoomNotice(e)})),e.chatConnection.event.removeMessages.listen((e=>{this.chatTab.handleRemoveMessages(e.username),this.chatTab.chatTabContents.removeMessagesForUser(e.username),this.pmTab.closePMSession(e.username)})),e.chatConnection.event.statusChange.listen((t=>{this.inPrivateRoom=e.chatConnection.inPrivateRoom(),this.privateShowUser=e.chatConnection.getPrivateShowUser(),"notconnected"===t.previousStatus&&this.currentTab===this.userListTab&&this.userListTab.refresh()})),e.chatConnection.event.appDebugLog.listen((t=>{e.chatConnection.isAppDebuggingEnabled()&&this.chatTab.chatTabContents.appendMessageDiv((0,ce.CM)(`DEBUG: ${t}`)),d.B.current.isTestbed&&void 0!==window.console&&info(t)})),e.chatConnection.event.onBanSilence.listen((t=>{this.handleBanSilence(t,e)})),(d.B.current.mergePmDm||(0,v.JG)())&&(this.conversationNotifier=new y.e(e.chatConnection),d.B.current.mergePmDm&&l.H4.listen((e=>{var t;if(!0===(null===(t=this.conversationNotifier)||void 0===t?void 0:t.shouldNotify(e.fromUser.username))){const t=this.conversationNotifier.createChatLinkMessage(e.fromUser.username);this.chatTab.chatTabContents.appendMessageDiv(t),this.conversationNotifier.preventNotifications(e.otherUsername)}})).addTo(this.perRoomListeners))})),!d.B.current.mergePmDm){const e=new C.k;(0,n.SU)()&&l.H4.listen((t=>{if(e.shouldNotify(t.fromUser.username)){const s=R.Ru.newDirectMessageNotice(t.otherUsername),i=new o.aZ({onClick:()=>{r.$o.fire(t.otherUsername)}}),n=(0,ce.r_)(s,i.openConversationElement);this.chatTab.chatTabContents.appendMessageDiv(n),e.preventNotifications(t.otherUsername)}}))}if(!d.B.current.mergePmDm)if((0,v.JG)())this.pmTab.otherUserInitiatedPm.listen((e=>{var t;!0===(null===(t=this.conversationNotifier)||void 0===t?void 0:t.shouldNotify(e.username))&&(this.newPmChatLink(e),this.conversationNotifier.preventNotifications(e.username))}));else{const e=new S.q;this.pmTab.otherUserInitiatedPm.listen((t=>{e.shouldNotify(t.username)&&(this.newPmChatLink(t),e.preventNotifications(t.username))}))}b.Gr.listen((()=>{var e,t;this.perRoomListeners.removeAll(),null===(e=this.conversationNotifier)||void 0===e||e.dispose(),null===(t=this.roomNoticeDeclutterer)||void 0===t||t.onRoomCleanup()})),P.q_.listen((e=>{e?this.chatTab.chatTabContents.appendMessageDiv((0,ce.CM)("Debug mode enabled. Type /debug again to disable.")):this.chatTab.chatTabContents.appendMessageDiv((0,ce.CM)("Debug mode disabled."))})),ve.K.listen((()=>{this.refreshTabs()})),P.Ch.listen((e=>{"split"===E.L.getVideoMode()&&(this.changeToTab(this.chatTab),this.chatTab.appendInputText(`@${e} `),this.chatTab.focusCurrentChatInput())}));const i=()=>{void 0===e&&(e=this.chatTab.chatTabContents.isScrolledUp()),window.clearTimeout(t),t=window.setTimeout((()=>{!1===e&&this.chatTab.chatTabContents.scrollToBottom(),e=void 0}),50)};fe.XA.splitModeDragResize.listen((()=>{this.expandableDropDownMenu.dropDown.isShown()&&this.expandableDropDownMenu.dropDown.hideElement(),i()})),P.E3.listen((()=>{window.setTimeout((()=>{this.repositionChildrenRecursive()}),0)})),(0,v.JG)()&&(l.Si.listen((e=>{this.inPrivateRoom&&(e===this.privateShowUser||e===this.room)&&this.isPmSessionActive(e)&&this.chatTab.resetNumUnread()})),l.J9.listen((e=>{!0===e.isPrivateShowMessage&&this.newPrivateShowMessage(e)}))),P.PV.listen((()=>{this.repositionChildren()})),m.eF.listen((()=>{this.changeToTab(this.settingsTab)}))}initNoticeDeclutterer(){w.z.featureEnabled()&&(this.roomNoticeDeclutterer=new w.z({appendNotice:e=>this.chatTab.chatTabContents.appendMessageDiv(e.element),appendSentinelDiv:e=>this.chatTab.chatTabContents.element.appendChild(e)}))}shouldIncrementUnread(e){var t;const s=!0===e.isPrivateShowMessage,i=e.fromUser.username===(null===(t=d.B.current.loggedInUser)||void 0===t?void 0:t.username);return!(0,v.JG)()||!s||!i&&!this.isPmSessionActive(e.fromUser.username)}newChatMessage(e){this.shouldIncrementUnread(e)&&this.chatTab.possiblyIncrementUnread(),h.k.getInstance().addRecentUser(e.fromUser);const t=(0,ce.j7)(e);(0,p.at)(t,document.body.classList.contains("darkmode")),this.chatTab.chatTabContents.appendMessageDiv(t,!0)}newPrivateShowMessage(e){this.newChatMessage(e);const t=(0,ce.bB)(e);void 0!==t&&this.chatTab.chatTabContents.appendMessageDiv(t)}newRoomNotice(e){const t=new x.Q5({roomNoticeData:e,isChatScrolledToBottom:()=>!this.chatTab.chatTabContents.isScrolledUp(),scrollChatToBottom:()=>this.chatTab.chatTabContents.scrollToBottom()});void 0!==this.roomNoticeDeclutterer?this.roomNoticeDeclutterer.addRoomNotice(t):this.chatTab.chatTabContents.appendMessageDiv(t.element),e.showInPrivateMessage&&this.pmTab.possiblyAppendMessageDiv(new x.Q5({roomNoticeData:e,dontCollapse:!0}).element)}newPmChatLink(e){const t=R.Ru.newPrivateMessageNotice(e.username),s=(0,ce.r_)(t,e.PMChatLink.openConversationElement);this.chatTab.chatTabContents.appendMessageDiv(s)}isPmSessionActive(e){var t;return this.currentTab===this.pmTab&&!0===(null===(t=this.pmTab.getSession(e))||void 0===t?void 0:t.isActive())}constructExpandableDropDownMenu(){const e=new c.Dw(void 0,!0);return(0,a.fZ)(e,"tab"),(0,a.fZ)(e.dropDown,"chat-tabs-dropdown-border"),(0,T.ZM)(e.dropDown,{width:"105px",padding:"8px 0",borderWidth:"1px",borderStyle:"solid"}),(0,T.ZM)(e,{...this.tabHandleStyle,position:"absolute",height:"19px",width:"32px"}),e}createChatTab(){return new de.s}attachTabToDOM(e){const t=super.attachTabToDOM(e);return t.element.classList.add("chat-tab-handle"),t}async handleBanSilence(e,t){if((0,M.b5)()||e.silencer===t.dossier.userName){const s=await(0,i.t)({bannedUser:e.silenced,createdBy:e.silencer,isSilence:!e.isBan,roomUser:t.dossier.room}),n=e=>{this.showLogMsg(e)},a=(0,g.d)(this.chatTab.chatTabContents,e,s,t,n);this.chatTab.chatTabContents.appendMessageDiv(a)}}showLogMsg(e){this.chatTab.chatTabContents.appendMessageDiv((0,ce.CM)(e))}repositionChildren(){this.tabHandlesRow.repositionChildrenRecursive()}messageListWrapperHeight(){return this.element.clientHeight-le.$h-this.tabHandlesRow.element.offsetHeight-6}getCurrentTab(){return super.getCurrentTab()}children(){return super.children()}cycleToNextWindow(){this.cycleToWindow("next")}cycleToPrevWindow(){this.cycleToWindow("prev")}cycleToWindow(e){const t="next"===e?()=>this.pmTab.showNextPMSession():()=>this.pmTab.showPrevPMSession(),s="next"===e?()=>this.pmTab.resetNextQueue():()=>this.pmTab.resetPrevQueue();this.settingsTab.getChatSettings().hideModals(),super.getCurrentTab()===this.chatTab?(this.changeToTab(this.pmTab),s(),t()||this.pmTab.showPMList(!1)):t()||this.changeToTab(this.chatTab),this.repositionChildrenRecursive()}closeCurrentPMSession(){super.getCurrentTab()===this.pmTab&&this.pmTab.closeCurrentPMSession()}}}}]);
//# sourceMappingURL=478-prod-9d1d1dbf5f4eb1fb1c1e.js.map