"use strict";(self.webpackChunk_multimediallc_cb_ts=self.webpackChunk_multimediallc_cb_ts||[]).push([[648],{72303:(e,t,i)=>{i.d(t,{G:()=>a});var s=i(45836),n=i(61021),o=i(65389);const l=window.canAutoplay;function a(){const e=new n.GE;return new Promise((t=>{let i=0;const n=e=>{e&&a(!0)},a=a=>{let r=0;!0===a&&o.g$.removeListener(n),(0,s.vM)()&&0!==i&&(r=window.performance.now()-i);const h=(0,s.yb)();if(void 0!==h&&h<10&&(e.send(!1,r),t(!1)),void 0===l){const i="canAutoplay library is undefined. Resolving autoplay to true";return warn(i),e.send(!0,r,new Error(i)),void t(!0)}l.video({inline:!0,muted:!0,timeout:1e3,baseUrl:STATIC_URL_ROOT}).then((i=>{e.send(i.result,r,i.error),t(i.result)})).catch((i=>{e.send(!1,r,i),t(!1)}))};(0,o.gA)()?a():((0,s.vM)()&&(i=window.performance.now()),o.g$.listen(n))}))}},90966:(e,t,i)=>{i.d(t,{C:()=>ot});var s=i(79461),n=i(99447),o=i(6784),l=i(50213),a=i(65216),r=i(97742),h=i(32939),d=i(92709),c=i(63955),u=i(78423),p=i(44947);let m;h.X0.listen((e=>{m=e.chatConnection.room()}));const y={"---":"---",underage:p.Ru.reportAbuseCatUnderage,advertising:p.Ru.reportAbuseCatAdvertising,abusive:p.Ru.reportAbuseCatAbusive,intoxicated:p.Ru.reportAbuseCatIntoxicated,"large toy":p.Ru.reportAbuseCatLarge,"offline payments":p.Ru.reportAbuseCatOffline,"public broadcast":p.Ru.reportAbuseCatPublic,"service uniform":p.Ru.reportAbuseCatUniform,sleeping:p.Ru.reportAbuseCatSleeping,gender:p.Ru.reportAbuseCatGender,other:p.Ru.reportAbuseCatOther};class v extends d.u{constructor(){super(),this.closeReportAbuseRequest=new u.c_("closeReportAbuseRequest"),this.element.id="AbuseReport",this.element.style.fontFamily="UbuntuBold, Arial, Helvetica, sans-serif",this.element.style.fontSize="11px",this.element.style.position="relative",this.element.style.height="";const e=document.createElement("form");(0,c.ZM)(e,{display:"flex",flexDirection:"column",padding:"8px",height:"100%",boxSizing:"border-box"});const t=document.createElement("div");(0,n.fZ)(t,n.aG.defaultColor),this.categoryLabel=document.createElement("label"),(0,c.ZM)(this.categoryLabel,{display:"block",marginBottom:"8px"}),this.categoryLabel.htmlFor="abuse-category",this.categoryLabel.innerText=p.Ru.chooseCategoryText,t.appendChild(this.categoryLabel),this.categoryInput=document.createElement("select"),(0,n.fZ)(this.categoryInput,"abuseInput"),(0,c.ZM)(this.categoryInput,{width:"80%",marginBottom:"8px",boxSizing:"border-box",borderRadius:"4px"}),this.categoryInput.id="abuse-category";for(const e in y){const t=document.createElement("option");t.value=e,t.innerText=y[e],this.categoryInput.appendChild(t)}t.appendChild(this.categoryInput),e.appendChild(t);const i=document.createElement("div");(0,c.ZM)(i,{flex:1,display:"flex",flexDirection:"column",marginBottom:"8px"});const s=document.createElement("label");(0,c.ZM)(s,{display:"block",marginBottom:"8px"}),s.htmlFor="abuse-comments",s.innerText=p.Ru.reportAbuseAdditionalComments,i.appendChild(s),this.commentsInput=document.createElement("textarea"),(0,n.fZ)(this.commentsInput,"abuseInput"),(0,c.ZM)(this.commentsInput,{width:"100%",resize:"none",padding:"4px",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",boxSizing:"border-box",display:"block",flex:"1"}),this.commentsInput.id="abuse-comments",this.commentsInput.maxLength=255,i.appendChild(this.commentsInput),e.appendChild(i),this.abuseTermsDiv=document.createElement("div"),(0,c.ZM)(this.abuseTermsDiv,{marginBottom:"8px",fontFamily:"Ubuntu, Arial, Helvetica, sans-serif",fontSize:"8px"});const r=document.createElement("span");r.textContent=`${p.Ru.reportAbuseTextTerms} `;const h=document.createElement("a");(0,n.fZ)(h,n.aG.hrefColor),h.href=(0,a._Y)("/terms/#room-reports"),h.textContent="Terms",this.abuseTermsDiv.appendChild(r),this.abuseTermsDiv.appendChild(h),e.appendChild(this.abuseTermsDiv),this.buttonDiv=document.createElement("div"),(0,c.ZM)(this.buttonDiv,{fontFamily:"UbuntuMedium, Arial, Helvetica, sans-serif",display:"flex",justifyContent:"flex-end"});const d=document.createElement("span");(0,n.fZ)(d,"submitSpan"),(0,c.ZM)(d,{marginRight:"8px",borderRadius:"4px",boxSizing:"border-box",cursor:"pointer",display:"inline-block"}),d.innerText=p.Ru.reportCAPS;const m=document.createElement("span");(0,n.fZ)(m,"cancelSpan"),(0,c.ZM)(m,{marginRight:"14px",borderRadius:"4px",boxSizing:"border-box",cursor:"pointer",display:"inline-block"}),m.innerText=p.Ru.cancelCAPS,this.buttonDiv.appendChild(m),this.buttonDiv.appendChild(d),e.appendChild(this.buttonDiv),(0,o.wu)("click",d,(e=>{e.preventDefault(),"other"!==this.categoryInput.value||""!==this.commentsInput.value?"---"!==this.categoryInput.value?(this.sendReport().then((e=>{e.success?(0,l.Q$)("Your report has been submitted."):void 0!==e.html&&(0,l.Q$)(e.html)})).catch((e=>{403===e.xhr.status?(0,l.Q$)(e.xhr.responseText):(0,l.Q$)(`Error sending report (${e})`)})),this.closeReportAbuseRequest.fire(void 0)):(0,l.Q$)("Please choose a category."):(0,l.Q$)("Please add a description of the abuse being reported.")})),(0,o.wu)("click",m,(e=>{this.closeReportAbuseRequest.fire(void 0)})),this.element.appendChild(e)}focusCategory(){this.categoryInput.focus()}parseAbuseReportResult(e){const t=new r.N(e),i={success:"success"===t.getString("result"),html:t.getStringOrUndefined("html")};return t.logUnusedDebugging("parseAbuseReportResult"),i}sendReport(){return new Promise(((e,t)=>(0,a.KF)(`abuse/report/${m}/`,{category:this.categoryInput.value,additional_comments:this.commentsInput.value}).then((t=>{e(this.parseAbuseReportResult(t.responseText))})).catch((e=>{t(e)}))))}}var g=i(66844),C=i(27407),f=i(52509),b=i(92945),T=i(4110),w=i(65389);const x="1"===(0,b.JO)(window.location.search).signup_notice;class S extends d.u{constructor(){super(),this.element.style.backgroundColor="#f7f6a8",this.element.style.fontSize="12px",this.element.style.padding="3px 10px",this.element.style.boxSizing="border-box",this.element.style.display="none",this.element.style.width="auto",this.element.style.height="auto";const e=document.createElement("a");e.innerText=p.Ru.signUpToChatText,e.onclick=()=>{(0,C.bT)("Subscribe")},this.element.appendChild(e),this.element.appendChild(document.createTextNode(" -- totally free, no email needed")),x&&h.X0.listen((t=>{(0,w.GZ)()&&(e.onclick=e=>{e.preventDefault(),(0,w.gr)(`/accounts/register/?next=${encodeURIComponent(window.location.pathname)}?b=${t.dossier.room}`)}),e.href=(0,a._Y)(`/accounts/register/?next=${encodeURIComponent(window.location.pathname)}?b=${t.dossier.room}`),t.chatConnection.viewerIsAnonymous()?this.element.style.display="block":this.element.style.display="none"}))}}var M=i(25581),I=i(86716);function L(e){const t=document.createElement("div");t.style.fontSize="14px";const i=function(e){const t=(e,t)=>{const i=document.createElement("div"),s=(e=>{const t=document.createElement("div");t.style.position="relative",t.style.paddingLeft="5px",t.style.display="inline";const i=document.createElement("span");return i.style.color="#0c6a93",i.innerText=e,t.appendChild(i),t})(e),n=(e=>{const t=document.createElement("div");t.style.position="absolute",t.style.paddingRight="5px",t.style.display="inline",t.style.left=`${M.EY}px`,t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.style.whiteSpace="nowrap";const i=document.createElement("span");return i.style.whiteSpace="nowrap",i.innerText=e,t.appendChild(i),t})(t);return i.style.paddingTop="5px",i.appendChild(s),i.appendChild(n),i},i=document.createElement("div"),s=e.username.charAt(0).toUpperCase()+e.username.slice(1);if("public"===e.roomStatus){const t=document.createElement("a");t.href=(0,a._Y)(`./?${e.username}`),t.text=`View ${s}'s Cam`,t.style.position="relative",t.style.padding="5px 5px 5px 0",t.style.textAlign="right",t.style.display="inline-block",t.style.width="100%",t.style.fontSize="14px",t.style.textDecoration="none",t.onmouseenter=()=>{t.style.textDecoration="underline"},t.onmouseleave=()=>{t.style.textDecoration="none"},(0,o.wu)("click",t,(t=>{t.preventDefault(),I.VZ.fire(e.username)})),i.appendChild(t)}if(""!==e.realName&&i.appendChild(t(`${p.Ru.realNameText}:`,e.realName)),isNaN(e.followersCount)||i.appendChild(t(`${p.Ru.followersText}:`,e.followersCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))),""!==e.sex&&("Couple"===e.sex?i.appendChild(t(`${p.Ru.sexTextCouple}:`,`${e.sex.charAt(0).toUpperCase()}${e.sex.substring(1)}`)):i.appendChild(t(`${p.Ru.sexText}:`,`${e.sex.charAt(0).toUpperCase()}${e.sex.substring(1)}`))),""!==e.displayBirthday&&i.appendChild(t(`${p.Ru.birthdayText}:`,e.displayBirthday)),isNaN(e.displayAge)||i.appendChild(t(`${p.Ru.ageText}:`,e.displayAge.toString())),""!==e.bodyType&&i.appendChild(t(`${p.Ru.bodyTypeText}:`,e.bodyType)),""!==e.bodyDecorations&&i.appendChild(t(`${p.Ru.bodyDecorationsText}:`,e.bodyDecorations)),""!==e.interestedIn){const s=JSON.parse(e.interestedIn).join(", ");""!==s&&i.appendChild(t(`${p.Ru.interstedInText}:`,s))}return""!==e.location&&i.appendChild(t(`${p.Ru.locationText}:`,e.location)),void 0!==e.lastBroadcast&&i.appendChild(t(`${p.Ru.lastBroadcastText}:`,e.lastBroadcast)),""!==e.languages&&i.appendChild(t(`${p.Ru.langaugesSpokenText}:`,e.languages)),""!==e.smokeDrink&&i.appendChild(t(`${p.Ru.smokeDrinkText}:`,e.smokeDrink)),i}(e.infoSection);let s,n,l,r;return t.appendChild(i),e.socialMedias.length>0&&(s=function(e,t){const i=e=>{const i=document.createElement("div");i.style.padding="10px",i.style.position="relative",i.style.display="inline-block",i.style.height="100px",i.title=e.titleName,i.onmouseenter=()=>{i.style.cursor="pointer",o.style.textDecoration="underline"},i.onmouseleave=()=>{i.style.cursor="default",o.style.textDecoration="none"},i.onclick=()=>{const i=(screen.width/2-401.5).toString(),s=`resizable,dependent,scrollbars,height=520,width=803,top=${(screen.height/2-260).toString()},left=${i}`,n=`/socials/social_media/${t}/${e.id}`;return(0,w.gr)(n,void 0,s),!1};const s=document.createElement("img");s.src=e.imageUrl,s.width=150,s.height=100,s.className="userUpload",i.appendChild(s);const n=document.createElement("span");n.innerText=e.labelText,n.style.backgroundColor=e.labelColor,n.style.position="absolute",n.style.top="92px",n.style.right="15px",n.style.fontSize="10px",n.style.padding="2px",i.appendChild(n);const o=document.createElement("div");return o.innerText=e.titleName,o.style.fontSize="12px",o.style.position="absolute",o.style.top="111px",o.style.left="0px",o.style.paddingLeft="13px",o.style.color="#0c6a93",o.style.maxWidth="145px",o.style.whiteSpace="nowrap",o.style.textOverflow="ellipsis",o.style.overflow="hidden",i.appendChild(o),i},s=document.createElement("div");s.style.position="relative",s.style.paddingTop="5px",s.style.paddingBottom="25px";const n=document.createElement("span");n.innerText=`${p.Ru.socialMediaText}:`,n.style.color="#0c6a93",n.style.padding="5px",s.appendChild(n);const o=document.createElement("div");o.style.paddingLeft="5px";for(const t of e)o.appendChild(i(t));return s.appendChild(o),s}(e.socialMedias,e.infoSection.username),t.appendChild(s)),e.photoSets.length>0&&(n=function(e,t){const i=e=>{const i=document.createElement("div");i.style.padding="10px",i.style.position="relative",i.style.display="inline-block",i.style.height="100px",i.title=e.name,i.onmouseenter=()=>{i.style.cursor="pointer",n.style.textDecoration="underline"},i.onmouseleave=()=>{i.style.cursor="default",n.style.textDecoration="none"},i.onclick=()=>{const i=(screen.width/2-401.5).toString(),s=`resizable,dependent,scrollbars,height=520,width=803,top=${(screen.height/2-260).toString()},left=${i}`,n=`/photo_videos/photoset/detail/${t}/${e.id}`;return(0,M.WO)(e,"BioTab"),(0,w.gr)(n,void 0,s),!1};const s=document.createElement("img");if(s.src=e.coverUrl,s.width=150,s.height=100,s.className="userUpload",i.appendChild(s),!e.userCanAccess){const e=document.createElement("img");e.src=`${STATIC_URL_ROOT}images/locked_rectangle4.png`,e.width=150,e.height=100,e.style.top="10px",e.style.left="10px",e.style.position="absolute",e.style.border="none",i.appendChild(e)}if(e.isVideo){const e=document.createElement("img");e.src=`${STATIC_URL_ROOT}images/play3.png`,e.height=20,e.style.position="absolute",e.style.top="10px",e.style.left="10px",i.appendChild(e)}if(""!==e.labelText){const t=document.createElement("span");t.innerText=e.labelText,t.style.backgroundColor=e.labelColor,t.style.position="absolute",t.style.top="92px",t.style.right="15px",t.style.fontSize="10px",t.style.padding="2px",i.appendChild(t)}const n=document.createElement("div");return n.innerText=e.name,n.style.fontSize="12px",n.style.position="absolute",n.style.top="111px",n.style.left="0px",n.style.paddingLeft="13px",n.style.color="#0c6a93",n.style.maxWidth="145px",n.style.whiteSpace="nowrap",n.style.textOverflow="ellipsis",n.style.overflow="hidden",i.appendChild(n),i},s=document.createElement("div");s.style.position="relative",s.style.paddingTop="5px",s.style.paddingBottom="25px";const n=document.createElement("span");n.innerText=`${p.Ru.photosAndVideosText}:`,n.style.color="#0c6a93",n.style.padding="5px",s.appendChild(n);const o=document.createElement("div");o.style.paddingLeft="5px";for(const t of e)o.appendChild(i(t));return s.appendChild(o),s}(e.photoSets,e.infoSection.username),t.appendChild(n)),""!==e.aboutMe&&(l=R(e.aboutMe,`${p.Ru.aboutMeText}:`),t.appendChild(l)),""!==e.wishList&&(r=R(e.wishList,`${p.Ru.wishListText}:`),t.appendChild(r)),{main:t,infoSection:i,socialMediaSection:s,photoVideoSection:n,userContentSection:l,wishListSection:r}}function R(e,t){const i=document.createElement("div");i.innerHTML=e;const s=document.createElement("div");s.style.paddingTop="5px";const n=document.createElement("span");n.innerText=t,n.style.color="#0c6a93",n.style.padding="5px",n.style.display="inline",n.style.verticalAlign="top",s.appendChild(n);const o=document.createElement("div");return o.style.padding="0 10px",o.style.display="inline-block",(0,M._W)(i,i,!0),0!==i.children.length&&(i.children[0].style.display="unset"),o.appendChild(i),s.appendChild(o),s}class B extends d.u{constructor(e){super(),this.element.style.color="#000",this.loadContent((0,M.zB)(e)),this.roomLoadedListener=e=>{this.loadContent((0,M.zB)(e.dossier.room))},h.X0.listen(this.roomLoadedListener,!1)}loadContent(e){void 0!==this.content&&this.element.removeChild(this.content.main);const t=document.createElement("span");t.innerText=`${p.Ru.loadingText}...`,this.element.appendChild(t),this.element.style.display="block",e.then((e=>{this.content=L(e),this.content.main.style.position="relative",this.content.main.style.paddingRight="3px",this.content.main.style.cursor="default",this.content.main.style.overflow="scroll",this.content.main.style.height="100%",this.element.removeChild(t),this.element.appendChild(this.content.main),this.repositionChildrenRecursive()})).catch((e=>{error("Bio Content error",e),this.content=function(){const e=document.createElement("div");e.style.position="absolute",e.style.height="100%",e.style.width="100%",e.style.top="0",e.style.left="0",e.style.display="block";const t=document.createElement("span");return t.innerText=p.Ru.bioUnavailableText,t.style.display="block",t.style.padding="10px",e.appendChild(t),{main:e}}(),this.element.removeChild(t),this.element.appendChild(this.content.main)}))}repositionChildren(){if(void 0!==this.content&&void 0!==this.content.infoSection)for(const e of this.content.infoSection.childNodes){const t=e.childNodes[1];void 0!==t&&(t.style.maxWidth=this.element.offsetWidth-M.EY-5+"px")}}afterRemovedFromParent(){h.X0.removeListener(this.roomLoadedListener)}}var k=i(36064),E=i(95091),D=i(74),A=i(43860),P=i(18598),W=i(20),O=i(40478),H=i(23910),F=i(21885),U=i(39419),V=i(62331),N=i(3333),Q=i(93502),$=i(17197),z=i(1243),_=i(39060),j=i(31779),G=i(89815),Z=i(49898),q=i(82434),K=i(18785),J=i(31448),X=i(69757),Y=i(19505),ee=i(51516),te=i(62146),ie=i(7176),se=i(62091),ne=i(45836),oe=i(65728),le=i(71552),ae=i(47964),re=i(20369),he=i(29453),de=i(61413),ce=i(51519),ue=i(60481),pe=i(11284),me=i(87258),ye=i(57569),ve=i(1403),ge=i(63654),Ce=i(54140);function fe(){const e=document.createElement("div");return(0,n.fZ)(e,"chat-input-div"),e.style.minHeight="36px",e.style.height="36px",e.style.boxSizing="border-box",e.style.fontSize="12px",e.style.borderRadius="0 0 2px 2px",e.style.display="grid",e.style.gridTemplateColumns="minmax(14px, 1fr) auto",e.style.columnGap=`${se.Pm}px`,e.style.padding=`0 ${se.Pm/3}px 0 ${se.Pm}px`,e}function be(e){I.f6.fire({}),e.stopPropagation(),e.preventDefault()}function Te(e){const t=document.createElement("span");(0,n.fZ)(t,"tip-button"),t.title=p.Ru.tipCAPS,t.innerText=p.Ru.tipCAPS,t.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",t.style.fontSize="12px",t.style.padding="4px 7px 3px",(0,n.fZ)(t,"tip-button-gradient"),t.style.borderRadius="4px",t.style.boxSizing="border-box",t.style.cursor="pointer",t.style.display="inline-block",t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.style.whiteSpace="nowrap",t.style.lineHeight="14px",(0,o.wu)("mousedown",t,(e=>{e.stopPropagation()})),(0,o.wu)("click",t,be);const i=h.X0.listen((e=>{t.style.display=e.dossier.isAgeVerified?"inline-block":"none"}));return void 0!==e&&i.addTo(e),t}class we extends d.u{constructor(e,t,i){super(),this.outgoingHandlers=e,this.inPrivateRoom=t,this.pmOtherUser=i,this.removeMessagesForUserEvent=new u.c_("removeMessageHtml",{reportIfNoListeners:!1}),this.scrolledToBottom=new u.c_("scrolledToBottom"),this.messageList=function(){const e=document.createElement("div");return e.className="msg-list-fvm",e.style.width="100%",e.style.overflowX="hidden",(0,te.PF)(e,"text"),e.style.cursor="text",e}(),this.noticeList=function(){const e=document.createElement("div");return e.style.width="100%",e.className="notice-list-fvm",(0,te.PF)(e,"text"),e.style.cursor="text",e}(),this.messageListWrapper=function(){const e=document.createElement("div");return e.className="msg-list-wrapper-fvm",e.style.width="100%",e.style.boxSizing="border-box",e.style.overflow="auto",e.style.flex="1",e}(),this.formSubmitted=new u.c_("formSubmitted"),this.messageCounter=0,this.listenerGroup=new u.gt,this.isPmChatContents=void 0!==this.pmOtherUser,this.toBottom=()=>{this.scrollToBottom()},this.element.id="FVChatTabContents",this.element.style.fontSize="12px",this.element.style.overflow="",this.element.style.display="flex",this.element.style.flexDirection="column",this.element.classList.add(this.isPmChatContents?"FullvideoChatDivPm":"FullvideoChatDivChat"),(0,n.fZ)(this.element,"hasDarkBackground"),this.messageListWrapper.appendChild(this.noticeList),this.messageListWrapper.appendChild(this.messageList),this.isPmChatContents&&(this.pmControlBar=new oe.sV(!0,i),this.element.appendChild(this.pmControlBar.element)),this.element.appendChild(this.messageListWrapper),this.buildChatInput(),this.wasScrolledUp=!1;const s=()=>{const e=this.messageListWrapper.scrollTop;this.isPmChatContents&&0===e&&this.isScrolledUp()&&T.ME.fire(),re.x0||(!this.isScrolledUp()&&this.wasScrolledUp&&this.scrolledToBottom.fire(),this.wasScrolledUp=this.isScrolledUp())},l=new ce.a((()=>s()),{bounceLimitMS:50,debounceType:1});(0,o.wu)("scroll",this.messageListWrapper,(()=>l.callFunc())),this.listenerGroup.add(de.V.listen((e=>{this.rulesModal=(0,ae.oG)(this,e),void 0!==this.rulesModal&&this.addChild(this.rulesModal)}))),this.listenerGroup.add(h.X0.listen((e=>{this.currentRoomContext=e,this.element.style.fontSize=e.dossier.userChatSettings.fontSize,this.setLineHeight()}))),this.listenerGroup.add(D.EZ.listen((e=>{this.element.style.fontSize=e.fontSize,this.setLineHeight()}))),this.emoticonAutocompleteModal=new ue.s({inputElement:this.customInputField,leftOffset:8,rightOffset:167}),this.inputDiv.appendChild(this.emoticonAutocompleteModal.element),this.emoticonAutocompleteModal.afterDOMConstructedIncludingChildren(),this.isPmChatContents||(this.userMentionModal=new le.D$({inputElement:this.customInputField,leftOffset:8,rightOffset:167}),this.inputDiv.appendChild(this.userMentionModal.element),this.userMentionModal.afterDOMConstructedIncludingChildren(),le.$u.listen((()=>{(0,ge.Qp)(this.messageList)})).addTo(this.listenerGroup),this.shortcodeAutocompleteModal=new me.V({inputElement:this.customInputField,leftOffset:8,rightOffset:207},this.isPmChatContents),this.inputDiv.appendChild(this.shortcodeAutocompleteModal.element),this.shortcodeAutocompleteModal.afterDOMConstructedIncludingChildren()),this.emoticonAutocompleteModal.element.classList.add(this.isPmChatContents?"fullvideoEmoticonAutocompleteModalPm":"fullvideoEmoticonAutocompleteModalChat"),this.emoticonAutocompleteModal.element.dataset.testid="emoticon-autocomplete-modal"}buildChatInput(){const e=this.isPmChatContents?se.mU:se.hk;this.inputDiv=fe(),this.inputDiv.dataset.paction="TheaterChat",this.inputForm=(0,se.zh)(),this.customInputField=(0,se.Zw)((()=>this.sendMessageFromInput()),e,this.isPmChatContents?"fullvideoInputFieldPm":"fullvideoInputFieldChat"),this.buildButtonHolder(),this.inputForm.appendChild(this.customInputField.element),this.inputDiv.appendChild(this.inputForm),this.inputDiv.appendChild(this.buttonHolder.element),this.element.appendChild(this.inputDiv),this.addInputListeners()}buildButtonHolder(){this.buttonHolder=new Y.J({columnGap:"4px"}),this.isPmChatContents&&(this.mediaDockButton=function(e){const t=document.createElement("span");t.style.cursor="pointer",t.style.display="inline-block",t.style.height="15px",t.style.minWidth="15px",t.dataset.paction="TheaterChat",t.dataset.pactionName="UploadPhoto",t.dataset.testid="send-image-button",t.onclick=e;const i=document.createElement("img");return i.src=`${STATIC_URL_ROOT}tsdefaultassets/mediaDock/uploadBackground-lighter.svg`,i.style.width="100%",i.style.height="100%",t.appendChild(i),t}((()=>{this.onMediaDockButtonClick()})),this.buttonHolder.addButton(this.mediaDockButton,Y.z.Icon)),this.emojiButton=function(e){const t=document.createElement("span");return t.textContent="ðŸ˜",t.style.cursor="pointer",t.style.fontSize="18px",t.style.lineHeight="18px",t.dataset.pactionName="EmojiClick",t.dataset.testid="emoji-button",t.classList.add(e?"fullvideoEmojiButtonPm":"fullvideoEmojiButtonChat"),(0,ne.AD)()||(twemoji.parse(t,{className:"emojiButton"}),t.style.fontSize="15px",t.style.lineHeight="15px"),t}(this.isPmChatContents),this.buttonHolder.addButton(this.emojiButton,Y.z.Icon);const e=document.createElement("span");new(X.c.get("SendButton"))({onClick:()=>{this.customInputField.submit()},isPm:this.isPmChatContents,variant:"DraggableCanvas"},e),this.buttonHolder.addButton(e,Y.z.Text),this.tipButton=Te(this.listenerGroup),this.buttonHolder.addButton(this.tipButton,Y.z.Text)}onMediaDockButtonClick(){if((0,C.bT)("PMPhotoButtonClicked"),!(0,g.rC)()){var e;if(void 0!==this.rulesModal)return void this.rulesModal.show();null===(e=this.libraryMediaDock)||void 0===e||e.toggle(),this.scrollToBottom()}}addInputListeners(){(0,o.wu)("mousedown",this.inputDiv,(e=>{e.target!==this.inputDiv&&e.target!==this.inputForm||(this.customInputField.focus(),e.preventDefault())})),(0,o.wu)("submit",this.inputForm,(e=>{e.preventDefault(),this.customInputField.submit()})),(0,o.wu)("click",this.emojiButton,(e=>{e.stopPropagation(),this.rulesModal?this.rulesModal.show():((0,he.Ye)(),T.n2.fire(this.emojiButton))}))}setLineHeight(){this.messageListWrapper.style.lineHeight=`${Number(this.element.style.fontSize.slice(0,-2))+7}pt`}dispose(){var e,t,i,s,n;this.listenerGroup.removeAll(),this.emoticonAutocompleteModal.dispose(),null===(e=this.userMentionModal)||void 0===e||e.dispose(),null===(t=this.libraryMediaDock)||void 0===t||t.dispose(),null===(i=this.rulesModal)||void 0===i||i.dispose(),this.customInputField.dispose(),null===(s=this.pmControlBar)||void 0===s||s.dispose(),null===(n=this.shortcodeAutocompleteModal)||void 0===n||n.dispose()}shouldSendMessageFromInput(){var e,t;return!(0,g.rC)('You must be logged in to send a message. Click "OK" to login.')&&!this.emoticonAutocompleteModal.isVisible()&&!0!==(null===(e=this.userMentionModal)||void 0===e?void 0:e.isVisible())&&!0!==(null===(t=this.shortcodeAutocompleteModal)||void 0===t?void 0:t.isVisible())}sendMessageFromInput(){if(!this.shouldSendMessageFromInput())return!1;const e=this.customInputField.getText(),t=void 0!==this.selectedMediaDock&&!this.selectedMediaDock.isEmpty();return this.scrollToBottom(),(""!==e.trim()||t)&&this.processMessage(e),this.recordUserAction(e),!0}shortcodeErrorMsg(e,t){const i=(0,_.JG)()&&this.inPrivateRoom();return this.isPmChatContents?p.Ru.shortcodeNotSupportedInPMs:i?p.Ru.shortcodeNotSupportedInPrivates:0===e.shortcodes.length?ye.fM.errorBehindShortcode(t):void 0}processMessage(e){const t=(0,ye.PR)(e);switch(t.messageType){case ye.gW.Shortcode:const i=t,s=this.shortcodeErrorMsg(i,e);void 0!==s?this.appendMessageDiv((0,ge.CM)(s)):this.outgoingHandlers.onShortcode&&this.outgoingHandlers.onShortcode(i);break;case ye.gW.ToggleDebugMode:this.outgoingHandlers.onToggleDebugMode();break;case ye.gW.TipRequest:this.customInputField.clearText();const n=t;this.outgoingHandlers.onTipRequest(n.messageData);break;default:this.outgoingHandlers.onChatMessage(e)}}recordUserAction(e){const t=e.match(/@[a-zA-Z0-9_]+/gm),i=U.k.getInstance();if(null!==t)for(const e of t)void 0!==i.users().find((t=>t.username===e.replace("@","")))&&(0,C.bT)("UserMentionMessage");this.formSubmitted.fire(e)}repositionChildren(){this.emoticonAutocompleteModal.element.style.bottom=`${this.inputDiv.offsetHeight}px`,void 0!==this.userMentionModal&&(this.userMentionModal.element.style.bottom=`${this.inputDiv.offsetHeight}px`),void 0!==this.shortcodeAutocompleteModal&&(this.shortcodeAutocompleteModal.element.style.bottom=`${this.inputDiv.offsetHeight}px`),this.wasScrolledUp||this.scrollToBottom()}initMediaDocks(e){this.libraryMediaDock=e,this.selectedMediaDock=e.sibling,this.addMediaDocksToDOM()}addMediaDocksToDOM(){void 0!==this.libraryMediaDock&&this.addChild(this.libraryMediaDock),void 0!==this.selectedMediaDock&&this.element.insertBefore(this.selectedMediaDock.element,this.inputDiv)}isScrolledUp(){return this.messageListWrapper.scrollTop<=this.messageListWrapper.scrollHeight-(this.messageListWrapper.offsetHeight+20)}scrollToBottom(){this.isScrolledUp()&&this.scrolledToBottom.fire(),this.messageListWrapper.scrollTop=this.messageListWrapper.scrollHeight,this.messageListWrapper.scrollLeft=0}appendNoticeDiv(e){return this.noticeList.appendChild(e),e}appendMessageDiv(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.messageListWrapper.scrollTop,s=this.isScrolledUp();if(s||e.querySelectorAll("img").forEach((e=>{const t=e.src;e.src="",e.onload=this.toBottom,e.src=t})),(0,pe.NZ)(e,this.messageList),s)this.messageListWrapper.scrollTop=i;else{let e=this.messageList.childElementCount-se.wR;for(;e>0;e-=1){const e=this.messageList.firstElementChild;null!==e&&this.messageList.removeChild(e)}this.scrollToBottom()}return t&&(this.messageCounter+=1),(0,Ce.sW)(e),e}showElement(){super.showElement("flex")}removeMessageDiv(e){this.messageList.removeChild(e)}getLastMessageId(){return this.messageCounter}messagesSinceId(e){return this.messageCounter-e}getEarliestMessageId(){return this.earliestMessageId}setEarliestMessageId(e){this.earliestMessageId=e}hide(){this.messageList.style.opacity="0"}show(){this.messageList.style.opacity="1"}clear(){for(this.messageCounter=0;null!==this.messageList.firstChild;)this.messageList.removeChild(this.messageList.firstChild)}focusCurrentChatInput(){(0,c.YG)(this.customInputField.element)||ve.O.fire(),this.customInputField.focus(!1,!1)}blurCurrentChatInput(){this.customInputField.blur()}removeMessagesForUser(e){this.removeMessagesForUserEvent.fire(e)}isInputFocused(){return document.activeElement===this.customInputField.element}getInputText(){return this.customInputField.getText()}setInputText(e){this.customInputField.setText(e)}appendInputText(e){this.customInputField.appendText(e)}}class xe extends V.ZZ{constructor(){super(),this.chatSettings=new ee.m,this.settingInput=!1,this.element.id="FVChatSettingsTab",this.element.style.fontSize="12px",this.element.style.fontFamily="Tahoma, Arial, Helvetica, sans-serif",this.element.style.display="flex",this.element.style.flexDirection="column",(0,c.ZM)(this.chatSettings,{flex:1,height:""}),this.prependChild(this.chatSettings),(0,n.SA)(this.chatSettings.manageIgnoredUsersLink,"link"),(0,n.fZ)(this.chatSettings.manageIgnoredUsersLink,"manage-ignored-link"),this.inputDiv=fe();const e=(0,se.zh)();this.inputField=(0,se.Zw)((()=>!1),Math.max(se.hk,se.mU));const t=()=>{this.settingInput||(this.chatSettings.hideModals(),void 0!==this.parent&&this.parent.changeToFirstTab())};(0,o.wu)("click",this.inputField.element,t),(0,o.wu)("focus",this.inputField.element,t);const i=document.createElement("span");new(X.c.get("SendButton"))({onClick:t,isPm:!1,variant:"DraggableCanvas"},i),this.buttonHolder=new Y.J({columnGap:"4px"}),this.buttonHolder.addButton(i,Y.z.Text),this.tipButton=Te(),this.buttonHolder.addButton(this.tipButton,Y.z.Text),e.appendChild(this.inputField.element),this.inputDiv.appendChild(e),this.inputDiv.appendChild(this.buttonHolder.element),this.element.appendChild(this.inputDiv);const s=document.createElement("div");let l;s.innerText=p.Ru.chatSettingsSavedText,s.style.position="absolute",s.style.top="10px",s.style.right="10px",s.style.fontFamily="UbuntuRegular, Helvetica, Arial, sans-serif",s.style.color="#000000",s.style.backgroundColor="#d8deea",s.style.border="1px solid #acacac",s.style.borderRadius="4px",s.style.padding="8px 12px",s.style.visibility="hidden",this.element.appendChild(s),A.L.changeVideoMode.listen((e=>{"split"!==A.L.getVideoMode()&&this.prependChild(this.chatSettings)})),this.chatSettings.chatSettingsSavedRequest.listen((()=>{clearTimeout(l),(0,te.Ve)(s,"250ms"),s.style.visibility="visible",l=window.setTimeout((()=>{(0,te.Ve)(s,"1000ms"),s.style.visibility="hidden"}),3e3)}))}showElement(){super.showElement("flex")}getHandleStyle(){return{...super.getHandleStyle(),minWidth:"16px",backgroundRepeat:"no-repeat",backgroundPosition:"center",height:"12px"}}getChatSettings(){return this.chatSettings}getTabHandleContent(){return[(0,ie.Kj)(0)]}getTabId(){return"settings-tab-fvm"}focusCurrentChatInput(){}blurCurrentChatInput(){this.inputField.blur()}isInputFocused(){return document.activeElement===this.inputField.element}scrollToBottom(){}getInputText(){return this.inputField.getText()}setInputText(e){this.settingInput=!0,this.inputField.setText(e),this.inputField.blur(),window.setTimeout((()=>{this.settingInput=!1}),100)}getChatInputField(){return this.inputField}tabHandleClicked(e){super.tabHandleClicked(e),(0,C.bT)("FocusTab",{location:"chatSettings"})}}var Se=i(23971),Me=i(61452);class Ie extends V.ZZ{constructor(){super(),this.numUnread=0,this.element.id="chat-box",this.element.style.overflow="";const e={onTipRequest:e=>{I.f6.fire(e)},onToggleDebugMode:()=>{this.chatConnection.toggleAppDebugging()},onChatMessage:e=>{if((0,_.JG)()&&this.chatConnection.inPrivateRoom()){const t={message:e,username:s.B.current.isBroadcast||this.chatConnection.isBroadcasting?this.chatConnection.getPrivateShowUser():this.chatConnection.room(),media:void 0,source:"roomviewPM",roomName:this.chatConnection.room()};(0,W.F_)(t).catch((e=>{this.chatTabContents.appendMessageDiv((0,ge.CM)(e.errorMessage))}))}else this.chatConnection.sendRoomMessage(e),this.chatTabContents.blurCurrentChatInput()}};this.chatTabContents=new we({onShortcode:e=>{this.chatConnection.sendShortcode(e)},...e},(()=>this.chatConnection.inPrivateRoom())),this.addChild(this.chatTabContents),this.appPanelChat=new Se._({appendMessageDiv:e=>this.chatTabContents.appendMessageDiv(e),removeMessageDiv:e=>{this.chatTabContents.removeMessageDiv(e)},getLastMessageId:()=>this.chatTabContents.getLastMessageId(),messagesSinceId:e=>this.chatTabContents.messagesSinceId(e),getMessagesScrollTop:()=>this.chatTabContents.messageListWrapper.scrollTop,getMessagesOffsetHeight:()=>this.chatTabContents.element.offsetHeight}),h.X0.listen((e=>{this.chatConnection=e.chatConnection,this.chatTabContents.appendMessageDiv((0,ge.CM)(p.Ru.viewerWelcomeWarning)),this.chatTabContents.appendMessageDiv((0,ge.CM)(p.Ru.welcomeMessage)),(0,pe.LQ)(e.dossier.room,e.dossier.roomUid,e.dossier.appsRunning,"fullvideo").then((e=>{this.chatTabContents.appendMessageDiv(e)})).catch(Me.yZ)})),h.Gr.listen((()=>{this.chatTabContents.clear()}))}getNumUnread(){return this.numUnread}scrollToBottom(){this.chatTabContents.scrollToBottom()}getTabHandleContent(){const e=p.Ru.chatCAPS;let t;return t=this.numUnread>99?`${e} (99+)`:this.numUnread>0?`${e} (${this.numUnread})`:e,[document.createTextNode(t)]}getTabId(){return"chat-tab-fvm"}focusCurrentChatInput(){this.chatTabContents.focusCurrentChatInput()}blurCurrentChatInput(){}isInputFocused(){return this.chatTabContents.isInputFocused()}possiblyIncrementUnread(){this.isCurrentTab()||(this.numUnread+=1),this.refreshTabs()}showElement(){super.showElement(),this.resetNumUnread(),this.chatTabContents.scrollToBottom()}resetNumUnread(){this.numUnread=0,this.refreshTabs()}handleRemoveMessages(e){const t=[];for(const i of this.chatTabContents.messageList.childNodes){const s=i;s.getAttribute("data-nick")===e&&t.push(s)}for(const e of t)this.chatTabContents.messageList.removeChild(e)}getInputText(){return this.chatTabContents.getInputText()}setInputText(e){this.chatTabContents.setInputText(e)}appendInputText(e){this.chatTabContents.appendInputText(e)}getChatInputField(){return this.chatTabContents.customInputField}tabHandleClicked(e){super.tabHandleClicked(e),(0,C.bT)("FocusTab",{location:"chat"})}}var Le=i(21728),Re=i(84364),Be=i(89510),ke=i(11224),Ee=i(90106);class De extends V.ZZ{constructor(e){super(),this.leavePmTab=e,this.numUnread=0,this.otherUserInitiatedPm=new u.c_("otherUserInitiatedPm"),this.pmSessions=new Map,this.orderedPMSessionKeys=new Ee.J,this.sendPrivateMessageFailCallback=e=>{const t=this.orderedPMSessionKeys.currentElem,i=this.pmSessions.get(t);(0,W.SU)()&&e.showDmLink?i.chatTabContents.appendMessageDiv((0,J.dD)(e.errorMessage,e.username)):i.chatTabContents.appendMessageDiv((0,ge.CM)(e.errorMessage))},this.element.classList.add("data-hj-suppress"),this.element.style.overflow="",this.pmList=new Le.U({isFullVideoMode:!0,clearSearchOnSelect:!0,openConversationEvent:F.BM}),this.addChild(this.pmList),T.E3.listen((e=>{this.hideCurrentPMSession(),this.hidePMList(),void 0===this.pmSessions.get(e.username)&&this.initializePmSession(e.username,!1,e.showSupporterAlert),this.orderedPMSessionKeys.makeCurrent(e.username),this.refreshTabs(),e.focus&&this.changeToThisTab(),this.showCurrentPMSession()})),h.X0.listen((e=>{this.chatConnection=e.chatConnection,this.room=e.dossier.room})),h.Gr.listen((()=>{this.emptyQueue();for(const e of this.pmSessions.keys())this.closePMSession(e,!0)})),F.wl.listen((e=>{this.closePMSession(e)})),F.BM.listen((e=>{this.hideCurrentPMSession(),this.orderedPMSessionKeys.makeCurrent(e),this.showCurrentPMSession()})),oe.yA.listen((e=>{this.showPMList(e,!0)})),oe.od.listen((()=>{this.chatConnection.ignore(this.orderedPMSessionKeys.currentElem)})),T.ME.listen((()=>{const e=this.pmSessions.get(this.orderedPMSessionKeys.currentElem);!1===e.isAllHistoryLoaded&&this.loadHistoryMessages(e)})),W.lX.listen((e=>{this.orderedPMSessionKeys.addToTop(e),this.initializePmSession(e,!1,!1)})),F.J9.listen((e=>{this.newPrivateMessage(e);const t=this.currentPmSession();this.inActiveVideoMode()&&this.tabHasFocus()&&void 0!==t&&t.isActive()&&(this.addPageActions(t,e),e.otherUsername!==t.username||t.chatTabContents.isScrolledUp()||F.Si.fire(t.username))})),Re.yT.unreadConversationsCountUpdate.listen((e=>{let{pmsCount:t}=e;this.setNumUnread(t)}))}addPageActions(e,t){var i;let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=(null===(i=s.B.current.loggedInUser)||void 0===i?void 0:i.username)===t.fromUser.username,l=e.username===t.fromUser.username;e.isActive()&&!n&&!o&&l&&(0,C.bT)("PMReceivedOpen",{message_id:t.messageID})}showPMList(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){this.hideCurrentPMSession();const e=(0,K.b5)();t||this.pmSessions.size>1||e?(this.pmList.element.style.display="block",this.pmList.repositionChildrenRecursive()):(this.orderedPMSessionKeys.makeCurrent((0,K.P8)()),this.showCurrentPMSession())}}hidePMList(){this.pmList.element.style.display="none"}scrollToBottom(){const e=this.currentPmSession();void 0!==e&&e.chatTabContents.scrollToBottom()}getNumUnread(){return this.numUnread}setNumUnread(e){e!==this.numUnread&&(this.numUnread=e,this.refreshTabs())}getTabHandleContent(){const e=p.Ru.PmCAPS;let t;return t=this.numUnread>99?`${e} (99+)`:this.numUnread>0?`${e} (${this.numUnread})`:e,[document.createTextNode(t)]}tabHandleClicked(e){(0,C.bT)("FocusTab",{location:"PM",unread:this.getNumUnread()}),this.changeToThisTab(),this.showPMList(!0)}getTabId(){return"pm-tab-fvm"}tabHasFocus(){return"block"===this.element.style.display}focusCurrentChatInput(){const e=this.currentPmSession();void 0!==e&&e.chatTabContents.focusCurrentChatInput()}blurCurrentChatInput(){}isInputFocused(){const e=this.currentPmSession();return void 0!==e&&e.chatTabContents.isInputFocused()}initializePmSession(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.pmSessions.get(e);if(void 0===o){(0,u.jU)();const n=new we({onTipRequest:e=>{I.f6.fire(e)},onToggleDebugMode:()=>{this.chatConnection.toggleAppDebugging()},onChatMessage:t=>{this.orderedPMSessionKeys.addToTop(e);const i={message:t,username:e,media:[],source:"roomviewPM",roomName:this.chatConnection.room()},s=o.mediaDock.sibling;s.isEmpty()?(0,W.F_)(i).catch((e=>{this.sendPrivateMessageFailCallback(e)})):s.mediaList().then((e=>{i.media=e,(0,W.F_)(i).catch((e=>{this.sendPrivateMessageFailCallback(e)})),s.clear()}))}},(()=>!1),e);if(o={chatTabContents:n,hasUnread:!1,username:e,loadHistoryMessagesDOM:new oe.b3,isInitialHistoryLoaded:!1,isAllHistoryLoaded:!1,mediaDock:new Be.$w(n,e,["theater","fullvideo","noninteractive-fullscreen"]),isActive:()=>"none"!==n.element.style.display},n.scrolledToBottom.listen((()=>{void 0!==o&&this.isPmSessionShowing(o)&&F.Si.fire(e)})),this.pmSessions.set(e,o),(0,Be.c6)(o.chatTabContents.element,e),o.chatTabContents.initMediaDocks(o.mediaDock),o.chatTabContents.appendNoticeDiv((0,ge.CM)(p.Ru.privateConversationWithText(e))),o.chatTabContents.appendNoticeDiv((0,ge.CM)(p.Ru.conversationCautionMessage(ke.m.siteName))),!t&&i){var l,a;const t=null!==(l=null===(a=s.B.current.loggedInUser)||void 0===a?void 0:a.isAgeVerified)&&void 0!==l&&l;o.chatTabContents.appendNoticeDiv((0,ge.YC)(e,t))}else o.chatTabContents.appendNoticeDiv(o.loadHistoryMessagesDOM.getElement());o.chatTabContents.element.style.display="none",this.addChild(o.chatTabContents)}return!n&&t&&this.otherUserInitiatedPm.fire({username:e,PMChatLink:new O.Qc({onClick:()=>{T.E3.fire({username:e,focus:!0,showSupporterAlert:!1})}})}),void 0===this.orderedPMSessionKeys.currentElem&&this.orderedPMSessionKeys.makeCurrent(e),o}loadHistoryMessages(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.loadHistoryMessagesDOM.isShowing())return;e.loadHistoryMessagesDOM.showLoading();const i=e.chatTabContents.messageList.clientHeight,s=t?"0":e.chatTabContents.getEarliestMessageId();(0,W.O2)(e.username,this.chatConnection.room(),s).then((s=>{e.loadHistoryMessagesDOM.hideLoading();const n=s.messages;n.length<W.j&&(e.isAllHistoryLoaded=!0),n.forEach((e=>{this.newPrivateMessage(e,!0)})),n.length>0&&e.chatTabContents.setEarliestMessageId(n[0].messageID),t&&this.maybeUpdateConversationListItem(n);const o=e.chatTabContents.messageList.clientHeight;e.chatTabContents.messageListWrapper.scrollTop=o-i})).catch(Me.yZ)}maybeUpdateConversationListItem(e){if(0===e.length)return;const t=e[e.length-1];(0,W.ug)(t.otherUsername,this.room).then((e=>{var i,s;Re.yT.conversationLoaded.fire({message:t.message,numUnread:null!==(i=this.numUnread)&&void 0!==i?i:0,time:null===(s=t.createdAt)||void 0===s?void 0:s.getTime(),fromUsername:t.fromUser.username,otherUser:e.user,hasMedia:t.mediaList.length>0,room:this.room})})).catch(Me.yZ)}newPrivateMessage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.appendMessageDiv((0,ge.j7)(e),e.fromUser.username,e.otherUsername,t);const i=(0,J.bB)(e);void 0!==i&&this.appendMessageDiv(i,e.fromUser.username,e.otherUsername,t)}appendMessageDiv(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.orderedPMSessionKeys.addToTop(i);const n=this.initializePmSession(i,t!==this.chatConnection.username(),!1,s);s&&!1===n.isInitialHistoryLoaded&&(n.isInitialHistoryLoaded=!0),this.chatConnection.username()===t||this.isCurrentTab()&&this.orderedPMSessionKeys.currentElem===i||(n.hasUnread=!0,this.refreshTabs()),n.isInitialHistoryLoaded&&n.chatTabContents.appendMessageDiv(e,!0)}possiblyAppendMessageDiv(e){if(this.isCurrentTab()){const t=this.currentPmSession();void 0!==t&&t.chatTabContents.appendMessageDiv(e)}}currentPmSession(){if(void 0!==this.orderedPMSessionKeys.currentElem)return this.pmSessions.get(this.orderedPMSessionKeys.currentElem)}showNextPMSession(){return this.showNextOrPrevPMSession("next")}showPrevPMSession(){return this.showNextOrPrevPMSession("prev")}showNextOrPrevPMSession(e){return this.hideCurrentPMSession(),void 0!==("next"===e?this.orderedPMSessionKeys.nextElem():this.orderedPMSessionKeys.prevElem())&&(this.showCurrentPMSession(),!0)}closePMSession(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e===this.room&&!t)return;const i=this.pmSessions.get(e);void 0!==i&&(this.orderedPMSessionKeys.remove(e),i.chatTabContents.dispose(),this.removeChild(i.chatTabContents),this.pmSessions.delete(e),this.isCurrentTab()&&(this.pmSessions.size>0?this.showPMList(!0,!0):this.leavePmTab()),this.refreshTabs(),(0,u.Rj)(),(0,Le.i)(i.username,!1))}closeCurrentPMSession(){const e=this.currentPmSession();void 0!==e&&this.closePMSession(e.username)}resetNextQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys.refillFromDiscard()}resetPrevQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys.emptyDrawIntoDiscard()}emptyQueue(){this.hideCurrentPMSession(),this.orderedPMSessionKeys=new Ee.J}showCurrentPMSession(){let e=this.orderedPMSessionKeys.currentElem;void 0===e&&(e=this.chatConnection.room(),this.orderedPMSessionKeys.makeCurrent(e));let t=this.pmSessions.get(e);void 0===t&&this.initializePmSession(e,!1,!1),t=this.pmSessions.get(e),t.isInitialHistoryLoaded||this.chatConnection.viewerIsAnonymous()||(t.isInitialHistoryLoaded=!0,this.loadHistoryMessages(t,!0)),this.hidePMList(),t.chatTabContents.showElement(),t.chatTabContents.repositionChildrenRecursive(),t.chatTabContents.scrollToBottom(),this.tabHasFocus()&&this.inActiveVideoMode()&&(t.hasUnread&&(t.hasUnread=!1,this.refreshTabs()),F.Si.fire(t.username),h.Zm.fire(t.username))}getSession(e){return this.pmSessions.get(e)}hideCurrentPMSession(){const e=this.currentPmSession();void 0!==e&&(e.chatTabContents.element.style.display="none")}getInputText(){const e=this.currentPmSession();return void 0===e?"":e.chatTabContents.getInputText()}setInputText(e){const t=this.currentPmSession();void 0!==t&&t.chatTabContents.setInputText(e)}getChatInputField(){const e=this.currentPmSession();if(void 0!==e)return e.chatTabContents.customInputField}inActiveVideoMode(){const e=A.L.getVideoMode();return"theater"===e||"fullvideo"===e||"fullscreen"===e}isPmSessionShowing(e){return this.inActiveVideoMode()&&this.tabHasFocus()&&this.currentPmSession()===e&&"none"===this.pmList.element.style.display}}class Ae extends V.Zz{constructor(){if(super(),this.inPrivateRoom=!1,this.privateShowUser="",this.room="",this.perRoomListeners=new u.gt,this.element.style.overflow="",this.chatTab=this.addTab(new Ie),this.pmTab=this.addTab(new De((()=>{this.changeToTab(this.chatTab)}))),this.settingsTab=this.addTab(new xe),this.tabHandlesRow.element.dataset.paction="TheaterChat",this.settingsTab.handle.element.dataset.pactionName="Settings",this.changeToTab(this.chatTab),this.tabHandlesRow.element.style.padding="1px 2px 0 0",this.initNoticeDeclutterer(),h.X0.listen((e=>{this.room=e.chatConnection.room(),this.changeToTab(this.chatTab),e.chatConnection.event.roomShortcode.listen((e=>{const t=(0,ge.j8)(e);this.chatTab.chatTabContents.appendMessageDiv(t)})),e.chatConnection.event.roomMessage.listen((e=>{this.newChatMessage(e)})),e.chatConnection.event.roomNotice.listen((e=>{this.newRoomNotice(e)})),e.chatConnection.event.removeMessages.listen((e=>{this.chatTab.handleRemoveMessages(e.username),this.chatTab.chatTabContents.removeMessagesForUser(e.username),this.pmTab.closePMSession(e.username)})),e.chatConnection.event.appDebugLog.listen((t=>{e.chatConnection.isAppDebuggingEnabled()&&this.chatTab.chatTabContents.appendMessageDiv((0,ge.CM)(`DEBUG: ${t}`))})),e.chatConnection.event.onBanSilence.listen((t=>{this.handleBanSilence(t,e)})),e.chatConnection.event.statusChange.listen((()=>{this.inPrivateRoom=e.chatConnection.inPrivateRoom(),this.privateShowUser=e.chatConnection.getPrivateShowUser()})),(s.B.current.mergePmDm||(0,_.JG)())&&(this.conversationNotifier=new $.e(e.chatConnection),s.B.current.mergePmDm&&F.H4.listen((e=>{var t;if(!0===(null===(t=this.conversationNotifier)||void 0===t?void 0:t.shouldNotify(e.fromUser.username))){const t=this.conversationNotifier.createChatLinkMessage(e.fromUser.username);this.chatTab.chatTabContents.appendMessageDiv(t),this.conversationNotifier.preventNotifications(e.otherUsername)}})).addTo(this.perRoomListeners))})),!s.B.current.mergePmDm){const e=new z.k;(0,W.SU)()&&F.H4.listen((t=>{if(e.shouldNotify(t.fromUser.username)){const i=p.Ru.newDirectMessageNotice(t.otherUsername),s=new O.aZ({onClick:()=>{(0,j.Eh)(),H.$o.fire(t.otherUsername)}}),n=(0,ge.r_)(i,s.openConversationElement);this.chatTab.chatTabContents.appendMessageDiv(n),e.preventNotifications(t.otherUsername)}}))}if(!s.B.current.mergePmDm)if((0,_.JG)())this.pmTab.otherUserInitiatedPm.listen((e=>{var t;!0===(null===(t=this.conversationNotifier)||void 0===t?void 0:t.shouldNotify(e.username))&&(this.newPmChatLink(e),this.conversationNotifier.preventNotifications(e.username))}));else{const e=new G.q;this.pmTab.otherUserInitiatedPm.listen((t=>{e.shouldNotify(t.username)&&(this.newPmChatLink(t),e.preventNotifications(t.username))}))}h.Gr.listen((()=>{var e,t;this.perRoomListeners.removeAll(),null===(e=this.conversationNotifier)||void 0===e||e.dispose(),null===(t=this.roomNoticeDeclutterer)||void 0===t||t.onRoomCleanup()})),T.q_.listen((e=>{e?this.chatTab.chatTabContents.appendMessageDiv((0,ge.CM)("Debug mode enabled. Type /debug again to disable.")):this.chatTab.chatTabContents.appendMessageDiv((0,ge.CM)("Debug mode disabled."))})),T.Ch.listen((e=>{"split"!==A.L.getVideoMode()&&(this.changeToTab(this.chatTab),this.chatTab.appendInputText(`@${e} `))})),(0,_.JG)()&&(F.Si.listen((e=>{this.inPrivateRoom&&(e===this.privateShowUser||e===this.room)&&this.isPmSessionActive(e)&&this.chatTab.resetNumUnread()})),F.J9.listen((e=>{!0===e.isPrivateShowMessage&&this.newPrivateShowMessage(e)}))),N.eF.listen((()=>{this.changeToTab(this.settingsTab)}))}initNoticeDeclutterer(){q.z.featureEnabled()&&(this.roomNoticeDeclutterer=new q.z({appendNotice:e=>this.chatTab.chatTabContents.appendMessageDiv(e.element),appendSentinelDiv:e=>this.chatTab.chatTabContents.element.appendChild(e)}))}async handleBanSilence(e,t){if((0,K.b5)()||e.silencer===t.dossier.userName){const i=await(0,P.t)({bannedUser:e.silenced,createdBy:e.silencer,isSilence:!e.isBan,roomUser:t.dossier.room}),s=e=>{this.showLogMsg(e)},n=(0,Q.d)(this.chatTab.chatTabContents,e,i,t,s);this.chatTab.chatTabContents.appendMessageDiv(n)}}showLogMsg(e){this.chatTab.chatTabContents.appendMessageDiv((0,ge.CM)(e))}shouldIncrementUnread(e){var t;const i=!0===e.isPrivateShowMessage,n=e.fromUser.username===(null===(t=s.B.current.loggedInUser)||void 0===t?void 0:t.username);return!(0,_.JG)()||!i||!n&&!this.isPmSessionActive(e.fromUser.username)}newChatMessage(e){this.shouldIncrementUnread(e)&&this.chatTab.possiblyIncrementUnread(),U.k.getInstance().addRecentUser(e.fromUser);const t=(0,ge.j7)(e);this.chatTab.chatTabContents.appendMessageDiv(t,!0)}newPrivateShowMessage(e){this.newChatMessage(e);const t=(0,J.bB)(e);void 0!==t&&this.chatTab.chatTabContents.appendMessageDiv(t)}newRoomNotice(e){const t=new Z.CU({roomNoticeData:e,isChatScrolledToBottom:()=>!this.chatTab.chatTabContents.isScrolledUp(),scrollChatToBottom:()=>this.chatTab.chatTabContents.scrollToBottom()});void 0!==this.roomNoticeDeclutterer?this.roomNoticeDeclutterer.addRoomNotice(t):this.chatTab.chatTabContents.appendMessageDiv(t.element),e.showInPrivateMessage&&this.pmTab.possiblyAppendMessageDiv(new Z.CU({roomNoticeData:e,dontCollapse:!0}).element)}newPmChatLink(e){const t=p.Ru.newPrivateMessageNotice(e.username),i=(0,ge.r_)(t,e.PMChatLink.openConversationElement);this.chatTab.chatTabContents.appendMessageDiv(i)}isPmSessionActive(e){var t;return this.currentTab===this.pmTab&&!0===(null===(t=this.pmTab.getSession(e))||void 0===t?void 0:t.isActive())}repositionChildren(){this.window.style.height=this.element.clientHeight-this.tabHandlesRow.element.offsetHeight+"px"}getCurrentTab(){return super.getCurrentTab()}children(){return super.children()}cycleToNextWindow(){this.cycleToWindow("next")}cycleToPrevWindow(){this.cycleToWindow("prev")}cycleToWindow(e){const t="next"===e?()=>this.pmTab.showNextPMSession():()=>this.pmTab.showPrevPMSession(),i="next"===e?()=>this.pmTab.resetNextQueue():()=>this.pmTab.resetPrevQueue();this.settingsTab.getChatSettings().hideModals(),super.getCurrentTab()===this.chatTab?(this.changeToTab(this.pmTab),i(),t()):t()||this.changeToTab(this.chatTab),this.repositionChildrenRecursive()}closeCurrentPMSession(){super.getCurrentTab()===this.pmTab&&this.pmTab.closeCurrentPMSession()}getHandleStyle(e){return{...super.getHandleStyle(e),lineHeight:"12px"}}}var Pe=i(11675),We=i(34961);class Oe extends Pe.Qx{constructor(e){const t=new Ae;super(e,t,{windowKey:We.K.Chat,minWidth:150,minHeight:100,defaultWidth:400,defaultHeight:250,defaultAnchors:[1,3],resizeable:!0,onLostFocus:()=>{this.chatTabContainer.getCurrentTab().scrollToBottom()},handles:[t.getTabRow().element]}),(0,n.fZ)(this.element,"draggableCanvasChatWindow"),(0,n.fZ)(this.element,"hasDarkBackground"),(0,n.SA)(this.innerDiv,"innerDiv"),(0,n.fZ)(this.innerDiv,"chatInnerDiv"),t.chatTab.chatTabContents.formSubmitted.listen((()=>{this.blur()})),(0,o.wu)("blur",t.chatTab.chatTabContents.customInputField.element,(()=>{(e.hoveredWindow!==this||(0,k.QZ)())&&(e.focusedWindow=void 0,e.focusChanged.fire(void 0))})),(0,o.wu)("mouseleave",this.element,(()=>{e.hoveredWindow=void 0,e.windowHover.fire(void 0)}));let i,s=!0;h.X0.listen((e=>{s=e.chatConnection.viewerIsAnonymous()})),A.L.changeVideoMode.listen((e=>{i=e.currentMode,void 0!==this.emojiSelectionModal&&"split"===i&&this.emojiSelectionModal.hide()})),T.n2.listen((e=>{s?D.pL.fire(!0):"split"!==i&&(void 0===this.emojiSelectionModal&&(this.emojiSelectionModal=new E.I((()=>this.chatTabContainer.getCurrentTab().getChatInputField()))),this.emojiSelectionModal.show(e))})),this.chatTabContainer=t}setDraggingOrResizing(e){super.setDraggingOrResizing(e),e?this.scrollDownOnResizeStop=e&&!this.chatTabContainer.chatTab.chatTabContents.isScrolledUp():(!0===this.scrollDownOnResizeStop&&this.chatTabContainer.chatTab.chatTabContents.scrollToBottom(),this.scrollDownOnResizeStop=void 0)}setPureMode(){var e;!0===(null===(e=this.emojiSelectionModal)||void 0===e?void 0:e.isShown())||(this.chatTabContainer.chatTab.chatTabContents.messageListWrapper.clientWidth&&(this.chatTabContainer.chatTab.chatTabContents.messageListWrapper.style.width=`${this.chatTabContainer.chatTab.chatTabContents.messageListWrapper.clientWidth}px`),this.chatTabContainer.chatTab.chatTabContents.messageListWrapper.classList.add("noScrollbar"),(0,Ce.VN)([...this.chatTabContainer.chatTab.chatTabContents.messageList.children]),this.chatTabContainer.chatTab.scrollToBottom(),this.element.classList.add("pureChat"),this.chatTabContainer.getTabRow().element.style.opacity="0",this.innerDiv.style.backgroundColor="initial",this.innerDiv.style.borderColor="transparent",this.closeButton.style.opacity="0")}setInputMode(){this.chatTabContainer.chatTab.chatTabContents.messageListWrapper.style.width="100%",this.chatTabContainer.chatTab.chatTabContents.messageListWrapper.classList.remove("noScrollbar"),this.chatTabContainer.chatTab.scrollToBottom(),this.element.classList.remove("pureChat"),this.chatTabContainer.getTabRow().element.style.opacity="1",this.innerDiv.style.backgroundColor="",this.innerDiv.style.borderColor="",this.closeButton.style.opacity="1"}}var He=i(71474),Fe=i(40034);class Ue extends d.u{constructor(e){super(),this.onComponentsUpdate=e,this.element.style.position="static",this.element.style.overflow="auto",this.element.style.padding="4px 7px",this.element.style.boxSizing="border-box",this.element.style.fontSize="12px",this.element.style.minWidth="230px",this.element.style.maxWidth="230px",this.element.style.height="auto";for(const e of this.children())e.element.style.margin="2px 0";h.X0.listen((e=>{let t=e.dossier.allowPrivateShow;this.showComponentsForStatus(t,e.chatConnection.status),e.chatConnection.event.statusChange.listen((e=>{this.showComponentsForStatus(t,e.currentStatus)})),e.chatConnection.event.settingsUpdate.listen((i=>{t=i.allowPrivateShow,this.showComponentsForStatus(t,e.chatConnection.status)}))}))}showComponentsForStatus(e,t){this.removeAllChildren(),this.inPrivate(t)?(void 0===this.cancelShowComponent&&(this.cancelShowComponent=new Qe),this.addChild(this.cancelShowComponent)):this.shouldShowPrivateShowComponent(e,t)&&(void 0===this.privateShowComponent&&(this.privateShowComponent=new Ne(this.onComponentsUpdate)),this.addChild(this.privateShowComponent)),this.onComponentsUpdate()}shouldShowPrivateShowComponent(e,t){switch(t){case"privaterequesting":return!0;case"privatespying":case"privatewatching":case"privatenotwatching":case"away":return!1;default:return e}}inPrivate(e){switch(e){case"privatewatching":case"privatespying":return!0;default:return!1}}}class Ve extends d.u{constructor(){super(),this.element.style.display="inline-block",this.element.style.height="auto",this.element.style.position="relative",this.element.style.padding="5px 5px",this.element.style.borderWidth="1px",this.element.style.borderStyle="solid",this.element.style.boxSizing="border-box",this.element.style.borderRadius="3px",this.element.style.font="UbuntuRegular, Arial, Helvetica, sans-serif",this.element.style.fontSize="12px",this.element.style.lineHeight="14px",this.element.style.textAlign="center"}}class Ne extends Ve{constructor(e){super(),this.onComponentsUpdate=e,this.header=function(e){const t=document.createElement("div");return(0,n.fZ)(t,"showsHeader"),t.innerText=e,t.style.width="100%",t.style.margin="5px 0",t.style.fontSize="14px",t.style.fontFamily="UbuntuMedium, Arial, Helvetica, sans-serif",t.style.fontWeight="500",t.style.letterSpacing="-0.05em",t}(p.Ru.privateShowText),this.button=function(e){const t=document.createElement("div");return(0,n.fZ)(t,"showsButton"),t.style.display="inline-block",t.innerText=e,t.style.borderWidth="1px",t.style.borderStyle="solid",t.style.boxSizing="border-box",t.style.borderRadius="4px",t.style.fontWeight="bold",t.style.padding="6px 10px",t.style.margin="5px 0",t.style.cursor="pointer",t.style.textDecoration="none",t}(p.Ru.privateShowStartLabelCAPS),this.privatePrice=0,this.privateMinMinutes=0,this.allowShowRecordings=!1,(0,n.fZ)(this.element,"startShowComponent"),this.element.appendChild(this.header),this.privateShowRequirements=document.createElement("div"),this.privateShowRequirements.style.margin="5px 0",this.privateShowRequirements.style.lineHeight="16px",this.privateShowRequirements.style.letterSpacing="-0.05em",this.tokensRequirement=document.createElement("div"),(0,n.fZ)(this.tokensRequirement,"tokensRequirement"),this.tokensRequirement.style.fontFamily="UbuntuMedium, Arial, Helvetica, sans-serif",this.privateShowRequirements.appendChild(this.tokensRequirement),this.minimumMinutesRequirement=document.createElement("div"),(0,n.fZ)(this.minimumMinutesRequirement,"minutesRequirement"),this.privateShowRequirements.appendChild(this.minimumMinutesRequirement),this.element.appendChild(this.privateShowRequirements),this.element.appendChild(this.button),this.privateFooter=document.createElement("div"),(0,n.fZ)(this.privateFooter,"showsFooter"),this.privateFooter.innerText=p.Ru.broadcasterAllowsRecordingsText,this.privateFooter.style.fontSize="9px",this.privateFooter.style.lineHeight="125%",this.privateFooter.style.margin="5px 0",this.element.appendChild(this.privateFooter),h.X0.listen((e=>{e.chatConnection.event.statusChange.listen((t=>{"privaterequesting"===t.currentStatus?(this.button.innerText=p.Ru.privateShowRequestCancelMessageCAPS,this.button.onclick=()=>{(0,Fe.yx)(e.chatConnection)}):(this.button.innerText=p.Ru.privateShowStartLabelCAPS,this.button.onclick=()=>{(0,Fe.UK)(e.chatConnection)},this.update())})),e.chatConnection.event.settingsUpdate.listen((t=>{this.updatePrivateShowInfo(t.allowShowRecordings,t.privatePrice,t.privateMinMinutes),"privaterequesting"!==e.chatConnection.status&&this.update()})),this.updatePrivateShowInfo(e.dossier.allowShowRecordings,e.dossier.privatePrice,e.dossier.privateMinMinutes),this.update()}))}updatePrivateShowInfo(e,t,i){this.allowShowRecordings=e,this.privatePrice=t,this.privateMinMinutes=i}update(){this.tokensRequirement.innerText=p.Ru.priceTokensPerMinuteMessage(this.privatePrice),this.minimumMinutesRequirement.innerText=`(${p.Ru.privateShowMinimumMinuteMessage(this.privateMinMinutes)})`,0===this.privateMinMinutes?this.minimumMinutesRequirement.style.display="none":this.minimumMinutesRequirement.style.display="block",this.allowShowRecordings?this.privateFooter.style.display="block":this.privateFooter.style.display="none",this.onComponentsUpdate()}}class Qe extends Ve{constructor(){super(),this.tokenTextArea=document.createElement("div"),(0,n.fZ)(this.element,"cancelShowComponent"),this.element.style.minWidth="200px",this.element.style.padding="",this.element.style.borderStyle="none",this.tokenTextArea.style.display="block",this.tokenTextArea.style.fontSize="16px",this.tokenTextArea.style.lineHeight="18px",this.tokenTextArea.style.margin="5px 0",(0,n.fZ)(this.tokenTextArea,"tokenTextArea"),this.element.appendChild(this.tokenTextArea);const e=document.createElement("div");(0,n.fZ)(e,"cancelShowButton"),(0,n.fZ)(e,"cancelShowButtonGradient"),e.style.display="inline-block",e.style.boxSizing="border-box",e.style.borderRadius="4px",e.style.padding="6px 10px",e.style.margin="5px 0",e.style.cursor="pointer",e.style.textDecoration="none",this.element.appendChild(e),h.X0.listen((t=>{this.updateTokenCount(t.dossier.tokenBalance),t.chatConnection.event.tipAlert.listen((e=>{e.fromUser.username===t.chatConnection.username()&&this.updateTokenCount(this.balance-e.amount)})),t.chatConnection.event.statusChange.listen((i=>{const s=()=>{(0,Fe.yx)(t.chatConnection)};switch(i.currentStatus){case"privatewatching":e.innerText=p.Ru.privateShowLeaveLabelCAPS,e.onclick=s;break;case"privatespying":e.innerText=p.Ru.privateShowSpyLeaveLabelCaps,e.onclick=s;break;default:e.onclick=()=>{}}}))})),He.D.listen((e=>{this.updateTokenCount(e.tokens)}))}updateTokenCount(e){this.balance=e,this.tokenTextArea.innerText=`${e} ${p.Ru.tokenOrTokensText(e,!1)}`}}var $e=i(29937),ze=i(87882),_e=i(6009),je=i(50836),Ge=i(97321),Ze=i(55088);class qe extends d.u{constructor(e,t,i){super(),this.roomName=e,this.element.style.position="relative",this.element.style.padding="4px",this.roomLink=document.createElement("a"),this.roomLink.href=(0,a._Y)(`/${e}/`),this.element.appendChild(this.roomLink),(0,o.wu)("click",this.roomLink,(e=>{e.metaKey||e.ctrlKey||e.shiftKey||(I.VZ.fire(this.roomName),e.preventDefault())})),(0,o.Xq)(["click","mousedown","touchstart"],this.roomLink,(e=>{(0,Ge.sl)(this.roomName,"mr",t,{sourceInfo:i})})),this.roomImage=document.createElement("img"),this.roomImage.style.height="100%",this.roomImage.style.width="100%",this.roomImage.style.cursor="pointer",this.roomImage.className="moreRooms",this.roomImage.id=`roomImage${t}`,this.roomLink.appendChild(this.roomImage),this.roomTitle=document.createElement("div"),this.roomTitle.innerText=e,(0,c.ZM)(this.roomTitle,{position:"absolute",bottom:"7px",color:"#ffffff",fontSize:"19px",textShadow:"1px 1px 1px #000, -1px -1px 1px #000, 1px -1px 1px #000, -1px 1px 1px #000"}),this.roomTitle.classList.add(`roomTitle${t}`),this.roomLink.appendChild(this.roomTitle);const s=(0,je.$F)(i);if("unknown"!==s){const e={position:"absolute",top:"12px",color:"#ffffff",fontSize:"11px",right:"12px"},t=document.createElement("div");t.className="thumbnail_label_recommender",t.innerText=(0,je.Iq)(s),(0,c.ZM)(t,e),this.roomLink.appendChild(t)}this.streamer=new Ze.QR(this.roomName,this.roomImage),this.element.onmouseenter=()=>{this.streamer.startStreaming()},this.element.onmouseleave=()=>{this.streamer.stopStreaming()}}repositionChildren(){void 0!==this.parent?this.roomTitle.style.left=this.parent.element.offsetWidth/2-this.roomTitle.offsetWidth/2+"px":error("Room does not have a parent")}reloadImage(){this.streamer.loadImage(0).catch((e=>{warn("Error loading image",{imageSrc:e})}))}getRoomName(){return this.roomName}afterRemovedFromParent(){this.streamer.stopStreaming(),super.afterRemovedFromParent()}safariReloadImage(){this.streamer.safariReloadImage()}}class Ke extends d.u{constructor(){if(super(),this.genderCheckboxes=[],this.genderLabels=[],this.areGenderLabelsDisplayed=!0,this.loadingDivIsShowing=!1,this.localStorageGenderKey="genders",this.selectedGenders=[],this.roomIterator=new _e.t(10),this.isLoadingRooms=!1,this.element.style.fontSize="12px",this.element.style.overflowY="scroll",(0,o.wu)("scroll",this.element,(()=>{this.loadMoreRoomsIfNearBottom()})),(0,ne.Pf)()){const e=window.localStorage.getItem(this.localStorageGenderKey);if(null!==e&&(this.selectedGenders=JSON.parse(e),void 0===s.B.current.loggedInUser)){const e=this.selectedGenders.indexOf((0,ze.jM)("followed"));e>=0&&this.selectedGenders.splice(e,1)}}this.buildGenderCheckboxesDiv(),this.loadingDiv=document.createElement("div"),(0,n.fZ)(this.loadingDiv,n.aG.defaultTooltipColor),this.loadingDiv.innerText=`${p.Ru.loadingText}...`,this.loadingDiv.style.margin="4px",this.resetAndLoad();const e=document.createElement("p");(0,n.fZ)(e,n.aG.defaultTooltipColor),e.style.cursor="pointer",e.style.padding="0",e.style.margin="4px 0",e.onclick=()=>{this.resetAndLoad()},(0,o.wu)("mouseenter",e,(()=>{e.style.textDecoration="underline"})),(0,o.wu)("mouseleave",e,(()=>{e.style.textDecoration=""})),e.innerText=p.Ru.refreshRoomsText,e.style.textAlign="left",this.genderCheckboxesDiv.appendChild(e),this.intervalUpdate=window.setInterval((()=>{for(const e of this.children())e.reloadImage()}),3e4)}close(){clearInterval(this.intervalUpdate),this.roomIterator.dispose()}appendRoomsToDiv(e){this.loadingDivIsShowing&&(this.element.removeChild(this.loadingDiv),this.loadingDivIsShowing=!1);for(const t of e)this.addChild(new qe(t.room,this.children().length+1,t.sourceInfo))}children(){return super.children()}buildGenderCheckbox(e,t){const i=this.selectedGenders.indexOf((0,ze.jM)(e.toLowerCase()))>-1,s=new $e.m(12,i);s.setOnChange((()=>{this.handleGenderChange()})),s.setName(e.toLowerCase()),s.setTitle(e),this.genderLabels.length>0&&(s.element.style.marginLeft="12px"),s.element.style.top="2px",this.genderCheckboxesDiv.appendChild(s.element),this.genderCheckboxes.push(s);const o=document.createElement("img");o.src=`${STATIC_URL}icon${e}.png`,o.style.position="relative",o.style.top="2px",o.style.cursor="pointer",o.style.width="16px",o.style.height="16px",o.style.marginLeft="3px",o.title=t,o.onclick=()=>{s.setChecked(!s.isChecked()),this.handleGenderChange()},this.genderCheckboxesDiv.appendChild(o);const l=document.createElement("span");(0,n.fZ)(l,n.aG.defaultTooltipColor),l.innerText=t,l.style.position="relative",l.style.top="1px",l.style.marginLeft="4px",l.style.cursor="pointer",l.onclick=()=>{s.setChecked(!s.isChecked()),this.handleGenderChange()},this.genderCheckboxesDiv.appendChild(l),this.genderLabels.push(l)}buildGenderCheckboxesDiv(){this.genderCheckboxesDiv=document.createElement("div"),this.genderCheckboxesDiv.style.margin="2px 2px 0 2px",this.genderCheckboxesDiv.style.whiteSpace="nowrap",this.genderCheckboxesDiv.style.textAlign="center",this.element.appendChild(this.genderCheckboxesDiv),this.buildGenderCheckbox("Female",p.Ru.womenText),this.buildGenderCheckbox("Male",p.Ru.menText),this.buildGenderCheckbox("Couple",p.Ru.couplesText),this.buildGenderCheckbox("Trans",p.Ru.transText)}handleGenderChange(){this.selectedGenders=[];for(const e of this.genderCheckboxes)e.isChecked()&&this.selectedGenders.push((0,ze.jM)(e.getName()));(0,C.bT)("ChangeRoomListGender",{selectedGenders:this.selectedGenders}),(0,ne.Pf)()&&(0===this.selectedGenders.length?window.localStorage.removeItem(this.localStorageGenderKey):window.localStorage.setItem(this.localStorageGenderKey,JSON.stringify(this.selectedGenders))),this.resetAndLoad()}roomWidth(){return this.element.clientWidth-8}roomHeight(){return.5625*this.roomWidth()}repositionChildren(){super.repositionChildren();const e=this.roomWidth();for(const t of this.children())t.element.style.width=`${e}px`,t.element.style.height=`${this.roomHeight()}px`;if(this.genderCheckboxesDiv.style.width=`${e}px`,!this.areGenderLabelsDisplayed&&this.genderCheckboxesDiv.scrollWidth<=e){for(const e of this.genderLabels)e.style.display="inline-block";this.areGenderLabelsDisplayed=!0}if(this.areGenderLabelsDisplayed&&this.genderCheckboxesDiv.scrollWidth>e){for(const e of this.genderLabels)e.style.display="none";this.areGenderLabelsDisplayed=!1}this.loadMoreRoomsIfNearBottom()}resetAndLoad(){this.removeAllChildren(),this.loadingDivIsShowing=!0,this.element.appendChild(this.loadingDiv),this.loadFromNewIterator(),this.repositionChildrenRecursive()}loadFromNewIterator(){this.roomIterator.setGenders(this.selectedGenders),this.roomIterator.next().then((e=>{this.insertLoadedRooms(e)})).catch((e=>{this.isLoadingRooms=!1,error("getNewIterator",e)}))}loadFromCurrentIterator(){this.isLoadingRooms||(this.isLoadingRooms=!0,this.roomIterator.next().then((e=>{this.insertLoadedRooms(e)})).catch((e=>{this.isLoadingRooms=!1,error("loadMoreRooms",e)})))}insertLoadedRooms(e){e.length>0?(this.finishInsertLoadedRooms(e),this.repositionChildrenRecursive(),this.isLoadingRooms=!1,this.loadMoreRoomsIfNearBottom()):this.isLoadingRooms=!1}finishInsertLoadedRooms(e){this.removeRoomsScrolledPastTop(),this.appendRoomsToDiv(e)}removeRoomsScrolledPastTop(){const e=this.roomHeight();let t=this.element.scrollTop;const i=[];for(const s of this.children()){if(!(s.element.offsetTop-t<-15*e))break;i.push(s)}for(const e of i)t-=e.element.offsetHeight,this.removeChild(e);this.element.scrollTop=t}loadMoreRoomsIfNearBottom(){this.element.scrollTop+5*this.roomHeight()>=this.element.scrollHeight-this.element.offsetHeight&&this.loadFromCurrentIterator()}}var Je=i(64480),Xe=i(78936),Ye=i(19311);class et extends d.u{constructor(e){super(),this.tipSource=e,this.roomType="public",this.tokenBalance=0,this.isTokenAmountAlreadyTooHigh=!1,this.isHighTipAmountWarningActive=!1,this.tipSent=new u.c_("tipSent"),this.notifyAttemptSendTip=new u.c_("notifyAttemptSendTip"),this.shouldReposition=new u.c_("tipCalloutShouldReposition"),this.stayOpen=!1,this.element.id="FVTipCallout",(0,n.fZ)(this.element,n.aG.defaultTooltipColor),this.element.style.minWidth="368px",this.element.style.overflow="visible",this.element.style.position="static";const t=document.createElement("div");t.style.display="inline-block";const i=document.createElement("span");i.innerText=p.Ru.currentBalanceText,i.style.display="inline-block",i.style.fontSize="13px",i.style.fontWeight="bold",i.style.padding="6px",t.appendChild(i),this.tokenBalanceSpan=document.createElement("span"),this.tokenBalanceSpan.dataset.testid="token-balance",(0,n.fZ)(this.tokenBalanceSpan,"tokenBalance"),this.tokenBalanceSpan.innerText=`${p.Ru.loadingTextLower}...`,this.tokenBalanceSpan.style.display="inline-block",this.tokenBalanceSpan.style.fontSize="13px",this.tokenBalanceSpan.style.fontWeight="bold",this.tokenBalanceSpan.style.padding="6px 6px 6px 0",t.appendChild(this.tokenBalanceSpan),h.X0.listen((e=>{this.roomName=e.chatConnection.room(),e.chatConnection.event.statusChange.listen((e=>{"privatewatching"===e.currentStatus?this.roomType="private":this.roomType="public"}))})),He.D.listen((e=>{this.updateTokenBalance(e.tokens)}));const l=document.createElement("a");l.dataset.testid="purchase-tokens",(0,n.fZ)(l,"purchaseTokens"),l.innerText=p.Ru.getMoreTokensLabel,l.href=(0,a._Y)(`${Je.bv}?source=${s.B.current.PurchaseEventSources.TOKEN_SOURCE_TIP_CALLOUT}`),l.style.display="inline-block",l.style.position="absolute",l.style.right="0",l.style.fontSize="13px",l.style.padding="6px",l.onclick=()=>((0,Je.di)({source:s.B.current.PurchaseEventSources.TOKEN_SOURCE_TIP_CALLOUT,target:l}),!1),l.onmouseenter=()=>{l.style.textDecoration="underline"},l.onmouseleave=()=>{l.style.textDecoration="none"},t.appendChild(l),this.element.appendChild(t),this.tokenBalanceDiv=t,this.lowScoreWarning=document.createElement("div"),(0,n.fZ)(this.lowScoreWarning,"warning"),this.lowScoreWarning.style.display="none",this.lowScoreWarning.style.fontSize="13px",this.lowScoreWarning.style.fontWeight="bold",this.lowScoreWarning.style.padding="6px",this.lowScoreWarning.style.textAlign="center",this.lowScoreWarning.style.position="absolute",this.lowScoreWarning.style.left="50%";const r=document.createElement("div");r.innerText=p.Ru.satisfactionWarningText,this.lowScoreWarning.appendChild(r);const d=document.createElement("div");d.innerText=p.Ru.tipWarningText,this.lowScoreWarning.appendChild(d),this.element.appendChild(this.lowScoreWarning),this.sendTipForm=document.createElement("form");const c=document.createElement("label"),m=document.createElement("span");m.innerText=p.Ru.tipAmountText,m.style.display="inline-block",m.style.fontSize="13px",m.style.padding="6px",c.appendChild(m),this.tipAmountInput=(0,Je.Gz)(),this.tipAmountInput.dataset.testid="tip-amount-input",this.tipAmountInput.value="25",this.tipAmountInput.min="1",this.tipAmountInput.style.width="5em",this.tipAmountInput.style.display="inline-block",this.tipAmountInput.style.fontSize="13px",this.tipAmountInput.style.padding="4px",this.tipAmountInput.style.borderWidth="1px",this.tipAmountInput.style.borderStyle="solid",this.tipAmountInput.style.borderRadius="4px",this.tipAmountInput.onclick=()=>{this.focusTipAmount()},this.invalidTipAmountDiv=document.createElement("div"),this.invalidTipAmountDiv.dataset.testid="invalid-tip",(0,n.fZ)(this.invalidTipAmountDiv,"warning"),this.invalidTipAmountDiv.innerText=p.Ru.tipAmountInvalid,this.invalidTipAmountDiv.style.display="none",this.invalidTipAmountDiv.style.paddingLeft="5px";const y=document.createElement("div");this.tipAmountInput.oninput=()=>{this.tipAmountChange()},c.appendChild(this.tipAmountInput),c.appendChild(this.invalidTipAmountDiv),this.sendTipForm.appendChild(c);const v=document.createElement("label");this.tipMessageLabel=document.createElement("div"),this.tipMessageLabel.innerText=p.Ru.defaultTipMessageLabel,this.tipMessageLabel.style.fontSize="13px",this.tipMessageLabel.style.padding="6px 6px 0 6px",v.appendChild(this.tipMessageLabel),this.tipMessageDiv=document.createElement("div"),this.tipMessageTextarea=document.createElement("textarea"),this.tipMessageTextarea.dataset.testid="tip-message-textarea",(0,n.fZ)(this.tipMessageTextarea,"tipMessageInput"),this.tipMessageTextarea.maxLength=255,this.tipMessageTextarea.style.width="100%",this.tipMessageTextarea.style.resize="none",this.tipMessageTextarea.style.fontSize="13px",this.tipMessageTextarea.style.margin=`${He.xj}px`,this.tipMessageTextarea.style.padding="4px",this.tipMessageTextarea.style.borderWidth="1px",this.tipMessageTextarea.style.borderStyle="solid",this.tipMessageTextarea.style.borderRadius="4px",this.tipMessageTextarea.style.boxSizing="border-box",this.tipMessageDiv.appendChild(this.tipMessageTextarea),this.tipMessageLabel.onclick=()=>{this.tipMessageTextarea.select()},v.appendChild(this.tipMessageDiv),this.sendTipForm.appendChild(v),y.style.position="relative",y.style.display="flex",y.style.flexWrap="wrap-reverse",this.bottomLeft=document.createElement("div"),this.ctrlSNotice=document.createElement("div"),this.ctrlSNotice.innerText=p.Ru.toggleWindowMessage,this.ctrlSNotice.style.display="none",this.bottomLeft.style.fontSize="10px",this.bottomLeft.style.lineHeight="1.3em",this.bottomLeft.style.padding="6px",this.bottomLeft.style.textAlign="left",this.bottomLeft.style.display="inline-block",y.appendChild(this.bottomLeft),this.bottomLeft.appendChild(this.ctrlSNotice),this.sendTipButton=new Ye.i,this.addChild(this.sendTipButton,y),this.stayOpenContainer=document.createElement("div"),this.stayOpenContainer.style.fontSize="10px";const g=document.createElement("label"),f=document.createElement("span");f.innerText=p.Ru.leaveOpenCheckBoxLabel,f.style.cursor="pointer";const b=new $e.m(12);b.element.dataset.testid="stay-open-toggle",b.element.style.top="2px",b.element.style.marginRight="3px",b.setOnChange((()=>{this.stayOpen=!this.stayOpen})),g.appendChild(b.element),g.appendChild(f),this.stayOpenContainer.appendChild(g),this.bottomLeft.appendChild(this.stayOpenContainer),this.sendTipForm.appendChild(y);const T=()=>{this.sendTipButton.hasFocus()&&!this.sendTipButton.focusPrev()?b.focus():b.isActiveElement()?this.tipMessageTextarea.focus():document.activeElement===this.tipMessageTextarea?void 0!==this.tipOptionsSelect?this.tipOptionsSelect.focus():this.tipAmountInput.focus():document.activeElement===this.tipOptionsSelect?this.tipAmountInput.focus():this.sendTipButton.hasFocus()||this.sendTipButton.focusPrev()},w=()=>{this.sendTipButton.hasFocus()&&!this.sendTipButton.focusNext()?this.tipAmountInput.focus():document.activeElement===this.tipAmountInput?void 0!==this.tipOptionsSelect?this.tipOptionsSelect.focus():this.tipMessageTextarea.focus():document.activeElement===this.tipOptionsSelect?this.tipMessageTextarea.focus():document.activeElement===this.tipMessageTextarea?b.focus():this.sendTipButton.hasFocus()||this.sendTipButton.focusNext()},x=e=>{this.sendTipButton.hasFocus()&&(e?this.sendTipButton.focusNextMenuItem():this.sendTipButton.focusPrevMenuItem())};let S;(0,o.wu)("keydown",this.element,(e=>{9===e.keyCode?(e.preventDefault(),e.shiftKey?T():w()):40===e.keyCode?(e.preventDefault(),x(!0)):38===e.keyCode&&(e.preventDefault(),x(!1))})),this.element.appendChild(this.sendTipForm),this.repositionChildren(),(0,o.wu)("submit",this.sendTipForm,(e=>{e.preventDefault();const t=parseInt(this.tipAmountInput.value);if(!isNaN(t)&&this.sendTipButton.isEnabled())if(this.tokenBalance>0&&t>this.tokenBalance)(0,Je.qr)(p.Ru.notEnoughTokensMessage,!1,s.B.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE,this.roomType);else{if((0,C.bT)("SendTipClicked",{amount:t,location:"PMTab"}),t>100&&!this.isHighTipAmountWarningActive)return this.sendTipButton.promptUser(p.Ru.tipConfirmationMessage(t)),this.isHighTipAmountWarningActive=!0,void this.repositionChildren();if(void 0===S){debug(`Sending ${t} in a tip..`),this.tipAmountInput.blur();const e=A.L.getVideoMode();let i=this.tipMessageTextarea.value;void 0!==this.tipOptionsSelect&&(i=""===this.tipMessageTextarea.value?this.tipOptionsSelect.value:`${this.tipOptionsSelect.value} | ${this.tipMessageTextarea.value}`),(0,He.ae)({roomName:this.roomName,tipAmount:this.tipAmountInput.value,message:i,source:this.tipSource,tipRoomType:this.roomType,tipType:this.sendTipButton.getTipType(),videoMode:e}).then((e=>{e.success?(0,C.bT)("SendTipSuccess",{amount:t,location:"PMTab"}):void 0!==e.error?(0,Je.qr)(`${e.error}`,!1,s.B.current.PurchaseEventSources.TOKEN_SOURCE_LOW_TOKEN_BALANCE,this.roomType):error("unknown send tip error"),this.removeHighTipAmountWarning(),this.tipMessageTextarea.value="",void 0!==e.tipsInPast24Hours&&He.ew.fire({tokens:e.tipsInPast24Hours,roomName:this.roomName}),this.tipSent.fire({amount:t,success:e.success})})).catch((e=>{error(`Error sending tip (${e})`),this.tipSent.fire({amount:t,success:!1})})),this.notifyAttemptSendTip.fire({amount:t}),S=window.setTimeout((()=>S=void 0),250)}}}))}repositionChildren(){this.tipMessageDiv.style.width=`${Math.max(0,this.element.clientWidth-2*He.xj)}px`}removeHighTipAmountWarning(){this.sendTipButton.cancelPrompt(),this.isHighTipAmountWarningActive=!1}tipAmountChange(){/^[1-9]\d*$/.test(this.tipAmountInput.value)?(this.sendTipButton.enable(),this.invalidTipAmountDiv.style.display="none",this.tokenBalance>0&&parseInt(this.tipAmountInput.value)>this.tokenBalance?this.isTokenAmountAlreadyTooHigh||((0,C.bT)("TokenAmountTooHigh"),this.isTokenAmountAlreadyTooHigh=!0):this.isTokenAmountAlreadyTooHigh=!1):(this.sendTipButton.disable(),this.invalidTipAmountDiv.style.display="inline-block",this.tipAmountInput.setSelectionRange(0,this.tipAmountInput.value.length)),this.isHighTipAmountWarningActive&&this.removeHighTipAmountWarning()}show(e){this.sendTipButton.hideMenu(),(0,Xe.DK)()<450?this.element.style.minWidth="340px":this.element.style.minWidth="368px",void 0!==e.amount&&(this.tipAmountInput.value=e.amount.toString(),this.tipAmountChange()),void 0!==e.message?this.tipMessageTextarea.value=e.message:this.tipMessageTextarea.value="",void 0!==e.usedCtrlS&&e.usedCtrlS?(this.ctrlSNotice.style.display="none",this.stayOpenContainer.style.lineHeight="3em"):(this.ctrlSNotice.style.display="block",this.stayOpenContainer.style.lineHeight=""),(0,Je.lc)(this.tipSource,this.sendTipButton),this.repositionChildren(),this.shouldReposition.fire(void 0),this.focusTipAmount(),(0,He.kb)(this.roomName).then((e=>{if(this.tipAmountInput.max=e.tokenBalance.toString(),void 0!==e.tipOptions){this.tipMessageLabel.innerText=e.tipOptions.label,void 0!==this.tipOptionsSelect&&this.tipMessageDiv.removeChild(this.tipOptionsSelect),this.tipOptionsSelect=document.createElement("select"),this.tipOptionsSelect.dataset.testid="tip-type-dropdown-button",(0,n.fZ)(this.tipOptionsSelect,"tipOptionsSelect"),this.tipOptionsSelect.style.width="100%",this.tipOptionsSelect.style.fontSize=".8125em",this.tipOptionsSelect.style.margin=`${He.xj}px`,this.tipOptionsSelect.style.borderWidth="1px",this.tipOptionsSelect.style.borderStyle="solid",this.tipOptionsSelect.style.boxSizing="border-box",this.tipMessageDiv.insertBefore(this.tipOptionsSelect,this.tipMessageTextarea);let t=document.createElement("option");t.innerText=`-- ${p.Ru.selectOneLabel} --`,t.value="",this.tipOptionsSelect.appendChild(t);for(const i of e.tipOptions.options)t=document.createElement("option"),t.innerText=i.label,t.value=i.label,this.tipOptionsSelect.appendChild(t)}else void 0!==this.tipOptionsSelect&&(this.tipMessageLabel.innerText=p.Ru.defaultTipMessageLabel,this.tipMessageTextarea.value="",this.tipMessageDiv.removeChild(this.tipOptionsSelect),this.tipOptionsSelect=void 0)})).catch((e=>{error(`Error getting token balance (${e})`)}))}focusTipAmount(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(document.activeElement!==this.tipAmountInput||e)&&(this.tipAmountInput.focus(),this.tipAmountInput.setSelectionRange(0,9999))}updateTokenBalance(e){this.tokenBalance=e,this.tokenBalanceSpan.innerText=`${e} ${p.Ru.tokenOrTokensText(e,!1)}`}getContentSize(){const e=this.element.parentElement;this.element.style.visibility="hidden",document.body.appendChild(this.element),this.element.style.width=`${this.tokenBalanceDiv.offsetWidth}px`,this.element.style.height="auto";const t=[this.element.offsetWidth,this.element.offsetHeight];return document.body.removeChild(this.element),null==e||e.appendChild(this.element),this.element.style.visibility="",t}}var tt=i(68039),it=i(79681);function st(e){return new it.L(e,void 0,!0)}class nt extends d.u{constructor(){super(),this.userCountUpdate=new u.c_("UserListWindow:userCountUpdate"),this.userList=[],this.element.id="users-list",this.element.style.padding="0 6px",this.element.style.boxSizing="border-box",this.element.style.position="",this.createLoadingDiv(),this.refresh(!1)}createLoadingDiv(){const e=document.createElement("div");(0,n.fZ)(e,n.aG.defaultTooltipColor),e.innerText=`${p.Ru.loadingUserListText}...`,e.style.margin="6px 0",this.element.style.fontSize="12px",this.element.appendChild(e)}createRefreshUsersLink(){const e=document.createElement("div");(0,n.fZ)(e,n.aG.defaultTooltipColor),e.style.margin="6px 0";const t=document.createElement("span");t.innerText=p.Ru.refreshUserListText,t.id="refresh-userlist",t.style.cursor="pointer",(0,o.wu)("click",t,(e=>{this.removeAllDOMChildren(),this.createLoadingDiv(),this.refresh(!1),e.preventDefault()})),(0,o.wu)("mouseenter",t,(e=>{t.style.textDecoration="underline"})),(0,o.wu)("mouseleave",t,(e=>{t.style.textDecoration=""})),e.appendChild(t),this.element.appendChild(e)}clear(e){this.userCountUpdate.fire(e),this.removeAllDOMChildren(),this.createLoadingDiv(),this.repositionChildren()}refresh(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];tt.SJ.getInstance().fetchRoomUsers().then((t=>{if(this.userCountUpdate.fire(t.totalCount),!e){this.removeAllDOMChildren(),this.createRefreshUsersLink(),this.userList=t.roomUsers;for(const e of this.userList){const t=document.createElement("div");t.style.width="auto",t.style.margin="2px 0",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.maxWidth="100%",t.style.textOverflow="ellipsis",t.appendChild(st(e).element),this.element.appendChild(t)}const e=document.createElement("div");(0,n.fZ)(e,n.aG.defaultTooltipColor),e.innerText=`+${t.anonCount} anonymous user${1===t.anonCount?"":"s"}`,e.style.width="100%",e.style.margin="6px 0",e.style.whiteSpace="nowrap",this.element.appendChild(e),this.repositionChildren()}})).catch((e=>{error("Error retrieving user list",e)}))}repositionChildren(){super.repositionChildren()}}class ot extends d.u{constructor(){let e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fullvideo",n=arguments.length>1?arguments[1]:void 0;super(),this.source=i,this.sessionMetrics=n,this.components=[],this.windowsStack=new f.C,this.focusChanging=new u.c_("focusChanging",{reportIfNoListeners:!1}),this.focusChanged=new u.c_("focusChanged",{reportIfNoListeners:!1}),this.windowOpened=new u.c_("windowOpened",{reportIfNoListeners:!1}),this.windowClosed=new u.c_("windowClosed",{reportIfNoListeners:!1}),this.windowHover=new u.c_("windowHover",{reportIfNoListeners:!1}),this.chatVisibilityChanged=new u.c_("chatVisibilityChanged",{reportIfNoListeners:!1}),this.element.style.overflow="",this.element.style.pointerEvents="none",this.chatWindow=this.addWindow(new Oe(this)),T.E3.listen((e=>{this.chatWindow.isOpen||(this.chatWindow.element.style.display="",this.chatWindow.isOpen=!0,this.chatVisibilityChanged.fire(!0)),e.focus&&this.setFocusedWindow(this.chatWindow),this.chatWindow.repositionChildrenRecursive()})),I.p3.listen((()=>{if(void 0!==this.userWindow&&this.userWindow.isOpen)return void this.removeChild(this.userWindow);const e=We.K.Users;this.removeChildByName(e);const t=p.Ru.usersText,i=new nt,s=e=>{("privatewatching"===e.previousStatus||"privatewatching"===e.currentStatus)&&window.setTimeout((()=>{i.refresh(!1)}),2e3),"notconnected"===e.previousStatus&&(i.refresh(!1),i.element.scrollTop=0)};let n=!0;const o=e=>{e.chatConnection.event.statusChange.listen(s,!1),n||i.clear(e.dossier.numViewers),n=!1};h.X0.listen(o);const l=this.addWindow(new Pe.Qx(this,i,{title:t,resizeable:!0,windowKey:e,minWidth:100,minHeight:100,defaultWidth:190,defaultHeight:230,defaultAnchors:[0,2]}));i.element.style.overflowY="auto",this.repositionChildrenRecursive(),i.userCountUpdate.listen((e=>{l.setTitle(`${t} (${e})`)})),l.onClose=()=>{h.X0.removeListener(o)},this.userWindow=l})),I.y6.listen((()=>{this.chatWindow.isOpen?(this.chatWindow.element.style.display="none",this.chatWindow.isOpen=!1,this.chatVisibilityChanged.fire(!1)):(this.chatWindow.element.style.display="",this.chatWindow.isOpen=!0,this.setFocusedWindow(this.chatWindow),this.chatVisibilityChanged.fire(!0)),this.repositionChildrenRecursive()})),T.Ch.listen((()=>{this.chatWindow.isOpen||I.y6.fire(void 0),this.setFocusedWindow(this.chatWindow),this.hoveredWindow=this.chatWindow,this.chatWindow.chatTabContainer.chatTab.focusCurrentChatInput()})),T.nw.listen((()=>{void 0!==this.moreRoomsWindow&&this.moreRoomsWindow.isOpen?this.removeChild(this.moreRoomsWindow):(this.openRoomList(),this.repositionChildrenRecursive())})),I.Iw.listen((e=>{const t=e=>{n.setTitle(e.dossier.room)},i=We.K.Bio;this.removeChildByName(i);const s=new B(e),n=this.addWindow(new Pe.Qx(this,s,{title:e,resizeable:!0,windowKey:i,defaultHeight:400,defaultWidth:360,minWidth:360,minHeight:100,defaultAnchors:[0,2],onClose:()=>{h.X0.removeListener(t)}}));h.X0.listen(t,!1),this.repositionChildrenRecursive()})),h.X0.listen((t=>{e=t.dossier.isAgeVerified})),I.f6.listen((i=>{if(void 0===i.amount&&this.removeTipWindowIfOpen(i))return;(0,C.bT)("OpenTipCallout"),void 0===this.tipCallout&&(this.tipCallout=new et(this.source),this.tipCallout.notifyAttemptSendTip.listen((e=>{t=e.amount,void 0!==this.tipWindow&&I.f6.fire({})})),this.tipCallout.shouldReposition.listen((()=>{if(void 0!==this.tipWindow&&void 0!==this.tipCallout){const[e,t]=this.tipCallout.getContentSize();this.tipWindow.resize(t,e),this.repositionChildrenRecursive()}}))),void 0===i.amount&&(i.amount=t);const n=()=>{void 0!==this.tipWindow&&this.removeChild(this.tipWindow)};if(!(e?s.B.current.isNoninteractiveUser?((0,l.Q$)(p.Ru.internalStaffTip),0):!(0,g.rC)('You must be logged in to tip. Click "OK" to login.'):((0,l.Q$)("This broadcaster doesn't accept tips."),0)))return;if(void 0!==this.sessionMetrics&&this.sessionMetrics.bindTipCallout(this.tipCallout),this.tipCallout.show(i),void 0!==this.tipWindow)return void this.setFocusedWindow(this.tipWindow);const[o,a]=this.tipCallout.getContentSize();this.tipWindow=this.addWindow(new Pe.Qx(this,this.tipCallout,{title:p.Ru.sendTipText,resizeable:!1,windowKey:We.K.Tip,minWidth:o+2*Pe.$m,minHeight:a+2*Pe.$m,defaultWidth:o,autoSize:!0,defaultHeight:a,defaultAnchors:[4],onClose:()=>{h.X0.removeListener(n),this.tipWindow=void 0},onGainedFocus:()=>{void 0!==this.tipCallout&&this.tipCallout.focusTipAmount()},onKey:e=>void 0===this.tipWindow?(error("undefined tipwindow"),!0):("Escape"===e.key?this.removeChild(this.tipWindow):"s"===e.key&&(e.ctrlKey||e.metaKey)&&(this.removeChild(this.tipWindow),e.preventDefault()),!0)})),this.tipWindow.innerDiv.style.boxSizing="",this.tipWindow.element.dataset.testid="floating-tip-window",h.X0.listen(n,!1),this.repositionChildrenRecursive(),this.tipCallout.focusTipAmount(!0)})),h.X0.listen((e=>{void 0!==this.privateWindow&&this.privateWindow.isOpen&&this.removeChild(this.privateWindow);let t=e.chatConnection.status;const i=!e.dossier.isAgeVerified||!e.dossier.allowPrivateShow;e.chatConnection.event.statusChange.listen((e=>{switch(t=e.currentStatus,e.currentStatus){case"unknown":case"offline":case"notconnected":case"away":case"hidden":case"privatenotwatching":case"passwordprotected":if(void 0!==this.privateWindow&&this.privateWindow.isOpen)return void this.removeChild(this.privateWindow);break;case"privaterequesting":case"privatewatching":case"privatespying":break;default:if(i&&void 0!==this.privateWindow&&this.privateWindow.isOpen)return void this.removeChild(this.privateWindow)}}));const s=["privaterequesting","privatespying","privatewatching"];e.chatConnection.event.settingsUpdate.listen((e=>{e.allowPrivateShow||-1!==s.indexOf(t)||void 0===this.privateWindow||!this.privateWindow.isOpen||this.removeChild(this.privateWindow)}))})),I.eY.listen((()=>{void 0!==this.abuseReportWindow&&this.abuseReportWindow.isOpen?this.removeChild(this.abuseReportWindow):(void 0!==this.abuseReportWindow&&this.removeChild(this.abuseReportWindow),this.abuseReport=new v,this.abuseReportWindow=this.addWindow(new Pe.Qx(this,this.abuseReport,{title:p.Ru.reportAbuseText,resizeable:!0,windowKey:We.K.Abuse,minWidth:270,minHeight:200,defaultWidth:270,defaultHeight:200,defaultAnchors:[3,1],onGainedFocus:()=>{void 0!==this.abuseReport&&this.abuseReport.focusCategory()},onKey:e=>!0,onClose:()=>{this.abuseReportWindow=void 0}})),this.repositionChildrenRecursive(),this.abuseReport.closeReportAbuseRequest.listen((()=>{void 0!==this.abuseReportWindow&&this.removeChild(this.abuseReportWindow)})))})),I.F_.listen((()=>{void 0!==this.privateWindow&&this.privateWindow.isOpen?this.removeChild(this.privateWindow):(void 0===this.privateShowComponent&&(this.privateShowComponent=new Ue((()=>{void 0!==this.privateWindow&&this.privateWindow.isOpen&&this.privateWindow.positioner.apply()}))),this.privateWindow=this.addWindow(new Pe.Qx(this,this.privateShowComponent,{title:p.Ru.privateShows,resizeable:!1,windowKey:We.K.Private,autoSize:!0,minWidth:248,minHeight:270,defaultWidth:248,defaultHeight:270,defaultAnchors:[2,1]})),this.repositionChildrenRecursive())})),this.anonymousWelcome=new S,this._addChild(this.anonymousWelcome),"1"===(0,b.JO)(window.location.search).room_list&&this.openRoomList(),this.setFocusedWindow(void 0)}openRoomList(){const e=We.K.Rooms;this.removeChildByName(e);const t=new Ke,i=225+(0,c.XJ)();this.moreRoomsWindow=this.addWindow(new Pe.Qx(this,t,{title:p.Ru.moreRoomsText,resizeable:!0,windowKey:e,minWidth:i,minHeight:100,defaultWidth:i,defaultHeight:385,defaultAnchors:[1,2],onClose:()=>{t.close()}})),(0,C.bT)("MoreRoomsOpened")}repositionChildren(){super.repositionChildren();for(const e of this.windowsStack.toArray())e.positioner.apply();void 0!==this.anonymousWelcome&&(this.anonymousWelcome.element.style.left=(this.element.clientWidth-this.anonymousWelcome.element.offsetWidth)/2+"px")}setFocusedWindow(e){if(!this.resizing&&this.focusedWindow!==e){if(void 0!==this.focusedWindow&&(this.focusedWindow.lostFocus(),document.activeElement!==document.body&&void 0!==document.activeElement&&null!==document.activeElement))try{document.activeElement.blur()}catch(e){debug(e)}this.focusChanging.fire(e),void 0!==e&&((0,C.bT)("FocusWindow",{windowName:e.getWindowKey()}),debug(`Setting focus to ${e.getWindowKey()}`),this.moveToFront(e),e.gainedFocus()),this.focusedWindow=e,this.focusChanged.fire(e)}}addChild(e,t){throw new Error("addChild not supported")}_addChild(e,t){return e.element.style.pointerEvents="auto",super.addChild(e,t)}addWindow(e,t){return e.draggingOrResizingChanged.listen((e=>{this.resizing=e})),(0,o.wu)("mousedown",e.element,(t=>{debug(`onclick ${e.getWindowKey()}`),this.focusedWindow!==e&&(this.setFocusedWindow(e),t.target instanceof HTMLElement&&(["input","textarea"].includes(t.target.tagName.toLowerCase())||"true"===t.target.contentEditable)||t.preventDefault())})),(0,o.wu)("mouseover",e.element,(t=>{this.hoveredWindow=e,this.windowHover.fire(e)})),this.windowsStack.addToTop(e),this._addChild(e,t),this.setFocusedWindow(e),this.windowOpened.fire(e),e.isOpen=!0,e}addComponent(e){return this.components.push(e),this._addChild(e),e}removeChild(e){e.isOpen=!1,void 0!==e.onClose&&e.onClose(),this.setFocusedWindow(void 0),this.windowsStack.remove(e),super.removeChild(e),this.windowClosed.fire(e)}moveToFront(e){this.windowsStack.addToTop(e),this.setChildZindexes()}setChildZindexes(){let e=this.children().length+10;for(const t of this.windowsStack.toArray())t.element.style.zIndex=`${e}`,e-=1;for(const t of this.components)t.element.style.zIndex=`${e}`,e-=1}removeChildByName(e){for(const t of this.windowsStack.toArray())if(t.getWindowKey()===e){this.removeChild(t),t===this.focusedWindow&&this.setFocusedWindow(void 0);break}}removeTipWindowIfOpen(e){let t=!1;return void 0!==this.tipWindow&&this.tipWindow.isOpen&&(void 0===this.tipCallout||this.tipCallout.stayOpen||(this.removeChild(this.tipWindow),t=!0)),t}}},34961:(e,t,i)=>{i.d(t,{K:()=>s});const s={Bio:"Bio",Abuse:"Abuse",Rooms:"Rooms",Users:"Users",Tip:"Tip",Chat:"Chat",Private:"Private"}},95091:(e,t,i)=>{i.d(t,{I:()=>w,P:()=>C});var s=i(45836),n=i(99447),o=i(11372),l=i(6784),a=i(51519),r=i(5020),h=i(63955),d=i(29605),c=i(78423),u=i(31779),p=i(25412),m=i(27407),y=i(25173),v=i(44947),g=i(65389);const C=new c.c_("emojiAdded"),f=["ðŸ»","ðŸ¼","ðŸ½","ðŸ¾","ðŸ¿",""],b=new c.c_("toneChange",{listenersWarningThreshold:500}),T="emojiTone";class w extends y.Q{constructor(e){super(),this.getCurrentChatInput=e,this.currentTone="",this.recentEmojisToneListeners=new c.gt,this.searchResultsToneListeners=new c.gt,this.isVisible=!1,this.addAllSections(),this.overlayClick.listen((()=>{this.hide()})),(0,l.wu)("keydown",document,(e=>{((0,p.x)(e.which)||27===e.keyCode||13===e.keyCode)&&this.hide()})),(0,l.wu)("keydown",this.searchBar,(e=>{e.stopPropagation()})),(0,l.wu)("click",this.element,(e=>{e.stopPropagation(),window.setTimeout((()=>{""!==this.searchBar.value&&this.searchBar.focus()}),0)})),(0,l.wu)("resize",window,(()=>{this.hide()}))}initUI(){super.initUI(),this.overlay.className="emojiSelectionModalOverlay";const e={position:"relative",padding:"8px 0px",height:"219px",boxSizing:"border-box",overflowY:"scroll"},t=new a.a((()=>{this.handleSearchChange()}),{bounceLimitMS:200,debounceType:1});let i;this.bottomDivot=(0,r.Uv)("","","",1),(0,n.fZ)(this.bottomDivot,"divot"),this.bottomDivot.style.bottom="-37px",this.element=(0,o.tT)("div",{style:{position:"absolute",visibility:"hidden",width:"284px",height:"261px",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px",boxSizing:"border-box",fontFamily:"UbuntuMedium, Helvetica, Arial, sans-serif",fontSize:"12px",zIndex:1001},colorClass:"emojiSelectionModal","data-testid":"emoji-picker-modal"},(0,o.tT)("div",{style:{position:"static",width:"calc(100% - 8px)",height:"28px",boxSizing:"border-box",margin:"4px",borderWidth:"1px",borderStyle:"solid",borderRadius:"4px"},colorClass:"searchBar"},(0,o.tT)("div",{style:{position:"relative",width:"15px",height:"15px",top:"50%",transform:"translateY(-50%)",cssFloat:"left",left:"7px"},colorClass:"searchIcon"}),(0,o.tT)("div",{style:{marginLeft:"22px",height:"100%"}},(0,o.tT)("input",{style:{position:"static",width:"calc(100% - 10px)",height:"calc(100% - 2px)",padding:"0px",borderWidth:"0px",marginLeft:"4px",outline:"none"},ref:e=>{this.searchBar=e},onInput:()=>{t.callFunc()},"data-testid":"emoji-search-bar"}))),(0,o.tT)("div",{style:e,ref:e=>{this.emojiSections=e},"data-testid":"all-emojis"},(0,o.tT)("a",{style:{position:"absolute",lineHeight:"14px",right:"22px",top:"9px",cursor:"pointer"},ref:e=>{i=e},onMouseEnter:()=>{(0,h.ZM)(i,{textDecoration:"underline"})},onMouseLeave:()=>{(0,h.ZM)(i,{textDecoration:""})},colorClass:"uploadLink",onClick:()=>this.onClickUploadLink(),"data-testid":"upload-emoticon-button"},v.Ru.uploadEmoticonsText)),(0,o.tT)("div",{"data-testid":"search-result-emojis",style:Object.assign({display:"none"},e),ref:e=>{this.searchResults=e}}),!(0,s.AD)()&&this.createToneSelect(),!(0,s.AD)()&&this.bottomDivot)}addAllSections(){(0,d.FH)(),this.addSection(v.Ru.recentlyUsedEmojis,"recent",(e=>{this.recentEmojisContent=e})),this.addSection(v.Ru.smileysPeopleEmojis,"smileys-people"),this.addSection(v.Ru.animalsNatureEmojis,"animals-nature"),this.addSection(v.Ru.foodDrinkEmojis,"food-drink"),this.addSection(v.Ru.activitiesEmojis,"activities"),this.addSection(v.Ru.travelPlacesEmojis,"travel-places"),this.addSection(v.Ru.objectsEmojis,"objects"),this.addSection(v.Ru.symbolsEmojis,"symbols"),this.addSection(v.Ru.flagsEmojis,"flags")}addSection(e,t){let i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>{};const n=(0,o.tT)("div",{"data-testid":`${t}-emojis`},(0,o.tT)("div",{style:{lineHeight:"16px"},colorClass:"sectionTitle"},e),(0,o.tT)("div",{ref:e=>{i=e,s(e)}}));this.emojiSections.appendChild(n),(0,d.I_)(t).then((e=>{this.populateSectionContent(i,e)})).catch((()=>{}))}populateSectionContent(e,t,i){for(const n of t){const t={position:"relative",display:"inline-block",width:"29px",height:"32px",cursor:"pointer",borderRadius:"2px",fontSize:"22px"},l={position:"relative",display:"inline-block",width:"28px",height:"28px",cursor:"pointer",borderRadius:"2px",fontSize:"22px",textAlign:"center",lineHeight:"28px",paddingLeft:"1px"},a=(0,o.tT)("div",{"data-testid":"emoji-item",style:(0,s.AD)()?l:t,colorClass:"emojiDiv",onClick:()=>{this.addEmojiToInput(n,e===this.recentEmojisContent)}});if(this.setElementContentToEmoji(a,n.value),this.getTonedEmoji(n,"ðŸ½")!==n.value){const e=b.listen((e=>{this.setElementContentToEmoji(a,this.getTonedEmoji(n,e))}));null==i||i.add(e)}e.appendChild(a)}}repopulateRecentEmojisContent(e){if(null!==this.recentEmojisContent.parentNode){const t=this.recentEmojisContent.cloneNode(!1);this.recentEmojisToneListeners.removeAll(),this.populateSectionContent(t,e,this.recentEmojisToneListeners),this.recentEmojisContent.parentNode.replaceChild(t,this.recentEmojisContent),this.recentEmojisContent=t}}createToneSelect(){const e={height:"24px",width:"24px",fontSize:"24px",position:"relative",top:"50%",transform:"translateY(-50%)",cssFloat:"left",marginRight:"8px",cursor:"pointer"};window.setTimeout((()=>{b.listen((e=>{this.currentTone=e,this.currentToneSpan.textContent=`ðŸ‘‹${e}`,twemoji.parse(this.currentToneSpan,{className:"emojiToneChoice"})})),b.fire(this.getSavedTone())}),0);const t=(0,o.tT)("div",{style:{position:"relative",left:"-1px",borderWidth:"1px",borderStyle:"solid",borderRadius:"0px 0px 3px 3px",width:"100%",height:"40px"},colorClass:"toneSelect"},(0,o.tT)("div",{style:{position:"relative",cssFloat:"right",height:"100%",right:"17px"}},(0,o.tT)("div",{style:{position:"relative",top:"50%",transform:"translateY(-50%)",cssFloat:"left",marginRight:"8px"},colorClass:"sectionTitle"},`${v.Ru.tone}: `),(0,o.tT)("div",{style:{position:"relative",width:"32px",height:"32px",top:"50%",transform:"translateY(-50%)",borderRadius:"2px",cssFloat:"left",cursor:"pointer"},colorClass:"currentToneContainer",ref:e=>{this.currentToneContainer=e},onClick:()=>{this.showToneOptions()}},(0,o.tT)("div",{style:{height:"24px",width:"24px",fontSize:"24px",position:"relative",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},ref:e=>{this.currentToneSpan=e}})),(0,o.tT)("div",{style:{fontSize:"24px",display:"none",height:"100%"},ref:e=>{this.toneOptions=e}})));for(const[t,i]of f.entries()){const s=t===f.length-1?Object.assign(e,{marginRight:"4px"}):e,n=`ðŸ‘‹${i}`,l=(0,o.tT)("div",{style:s,onClick:()=>{this.saveTone(i),this.hideToneOptions()}},n);twemoji.parse(l,{className:"emojiToneChoice"}),this.toneOptions.appendChild(l)}return t}showToneOptions(){this.currentToneContainer.style.display="none",this.toneOptions.style.display="inline-block"}hideToneOptions(){(0,s.AD)()||(this.currentToneContainer.style.display="inline-block",this.toneOptions.style.display="none")}saveTone(e){window.localStorage.setItem(T,e),b.fire(e)}getSavedTone(){var e;const t=null!==(e=window.localStorage.getItem(T))&&void 0!==e?e:"";return-1===f.indexOf(t)?(error(`Bad ${T} value`,t),""):t}getTonedEmoji(e,t){const i=(0,d.GH)(e.value)[0],s=e.value.split(i);s.length>1&&s[1][0]===twemoji.convert.fromCodePoint("fe0f")&&(s[1]=s[1].slice(1,s[1].length));const n=s.join(i+t);return(0,d.IC)(twemoji.parse(n))?n:e.value}handleSearchChange(){const e=this.searchBar.value;e.length<=1?((0,h.ZM)(this.emojiSections,{display:"block"}),(0,h.ZM)(this.searchResults,{display:"none"})):((0,h.ZM)(this.emojiSections,{display:"none"}),(0,h.ZM)(this.searchResults,{display:"block"}),(0,d.mj)(e).then((e=>{if(null!==this.searchResults.parentNode){const e=this.searchResults.cloneNode(!1);this.searchResults.parentNode.replaceChild(e,this.searchResults),this.searchResults=e}this.searchResultsToneListeners.removeAll(),this.populateSectionContent(this.searchResults,e,this.searchResultsToneListeners)})).catch((()=>{})))}setElementContentToEmoji(e,t){if((0,s.AD)())e.innerText=t;else{let i=twemoji.parse(t),s=i.match(/<img/g);if(null!==s&&s.length>1){const e=new RegExp(twemoji.convert.fromCodePoint("fe0f"),"g");if(t=t.replace(e,""),i=twemoji.parse(t),s=i.match(/<img/g),null!==s&&s.length>1)return}const n=new RegExp(`src="${twemoji.base}72x72/(.*?).png"`),l=i.match(n);if(null!==l){const t={position:"relative",display:"block",top:"50%",left:"50%"},i=l[1],s=(0,o.tT)("span",{style:t});for(s.classList.add(`sprite-twemoji-${i}`),s.classList.add("sprite-twemoji");null!==e.firstChild;)e.removeChild(e.firstChild);e.appendChild(s)}}}addEmojiToInput(e,t){const i=this.getTonedEmoji(e,this.currentTone),n=this.getCurrentChatInput();if(void 0!==n){(0,s.AD)()?n.insertText(e.value):n.insertText(i),C.fire(void 0),(0,m.bT)("emojiAdded",{name:e.name,value:e.value});const o=(0,d.jS)(e);t?this.recentEmojisRebuildData=o:this.repopulateRecentEmojisContent(o)}}onClickUploadLink(){return window.use_uploaded_emoticon=e=>{const t=this.getCurrentChatInput();if(void 0!==t){const i=t.getText();""===i||/\s/.test(i[i.length-1])?t.insertText(e,!0):t.insertText(` ${e}`,!0)}},(0,g.gr)("/emoticons/","_blank","height=615, width=850"),this.hide(),!1}show(e){const t=(0,u.Gy)();(0,u.aS)()&&void 0!==t?(t.appendChild(this.overlay),t.appendChild(this.element)):(document.body.appendChild(this.overlay),document.body.appendChild(this.element)),this.reposition(e),this.showOverlay(),this.element.style.visibility="",this.isVisible=!0,(0,m.bT)("emojiSelectorOpened")}hide(){if("hidden"===this.element.style.visibility)return;null!==this.element.parentElement&&this.element.parentElement.removeChild(this.element),null!==this.overlay.parentElement&&this.overlay.parentElement.removeChild(this.overlay),this.hideOverlay(),this.hideToneOptions(),this.element.style.visibility="hidden",this.isVisible=!1,this.searchBar.value="",this.handleSearchChange();const e=this.getCurrentChatInput();void 0!==e&&e.focus(!0),void 0!==this.recentEmojisRebuildData&&(this.repopulateRecentEmojisContent(this.recentEmojisRebuildData),this.recentEmojisRebuildData=void 0)}reposition(e){const t=e.getBoundingClientRect();let i=window.pageXOffset,n=window.pageYOffset;(0,u.aS)()&&(i=0,n=0);let o=t.left+i-this.element.offsetWidth+35,l=this.element.offsetWidth-37;o<0&&(o=t.left+i-25,l=23),this.element.style.top=t.top+n-this.element.offsetHeight-45+"px",(0,s.AD)()&&(this.element.style.top=t.top+n-this.element.offsetHeight-8+"px"),this.element.style.left=`${o}px`,this.bottomDivot.style.left=`${l}px`}isShown(){return this.isVisible}}},1403:(e,t,i)=>{i.d(t,{u:()=>$,O:()=>Q});var s=i(45836),n=i(11224),o=i(63955),l=i(78423),a=i(31779),r=i(80338),h=i(99321),d=i(1282),c=i(12609),u=i(43860),p=i(99447),m=i(3956),y=i(20369),v=i(91848),g=i(6784),C=i(50213),f=i(32939),b=i(92709),T=i(39060),w=i(86716),x=i(78936),S=i(27407),M=i(40034),I=i(88255),L=i(62146),R=i(83320),B=i(44947),k=i(92945),E=i(4110),D=i(43306),A=i(74),P=i(43058);const W="videoControls";class O extends b.u{updatePlayerData(e){var t,i;this.playerElement=e.element,this.playerSupportsAutoplayWithAudio=e.playerComponent.supportsAutoplayWithAudio,e.playerComponent instanceof h.O?(this.playerIsJPEG=!0,this.playerIsHlsPlaceholder=e.playerComponent.getIsHlsPlaceholder()):(this.playerIsJPEG=!1,this.playerIsHlsPlaceholder=!1),this.isEmbed=e.isEmbed(),(0,T.c5)()&&this.isEmbed&&(null===(t=(i=e.playerComponent).removeFullscreenDropdown)||void 0===t||t.call(i))}constructor(e,t){super(),this.player=e,this.forceHlsPlayerEvent=new l.c_("forceHlsPlayerEvent"),this.setPlayerComponentMutedEvents=new l.c_("setPlayerComponentMutedEvents"),this.setPlayerComponentVolumeMutedEvents=new l.c_("setPlayerComponentVolumeMutedEvents"),this.playerComponentEnterFullScreenModeEvent=new l.c_("playerComponentEnterFullScreenModeEvent"),this.playerComponentReadjustForceHlsOverlayOrderEvent=new l.c_("playerComponentReadjustForceHlsOverlayOrderEvent"),this.playerComponentReadjustPlayButtonContainerEvent=new l.c_("playerComponentReadjustPlayButtonContainerEvent"),this.showJpegPlayerComponentImage=new l.c_("showJpegPlayerComponentImage"),this.requestQualityModalVisibilityChange=new l.c_("requestVideoQualityButtonVisibilityChange"),this.videoOfflineChange=new l.c_("videoOfflineChange"),this.state={volume:60,isMuted:!0},this.isOffline=!1,this.isAgeVerified=!1,this.isFullscreenAvailable=!1,this.hideControlsCalled=!1,this.visible=!1,this.locked=!1,this.forceHlsTriggered=!1,this.forceHlsPlayButtonCreated=!1,this.hlsWaitingForInteraction=!1,this.privateAllowed=!1,this.updatePlayerData(e);const i=(0,k.JO)(window.location.search).disable_sound;if(void 0!==i&&"true"===i.toLowerCase()||"1"===i)this.state.volume=0,this.state.isMuted=!0;else if((0,s.Pf)()){const e=window.localStorage.getItem(W);if(null!==e){const t=JSON.parse(e);this.state={volume:t.volume,isMuted:!this.playerSupportsAutoplayWithAudio||t.isMuted}}else this.state.isMuted=!this.playerSupportsAutoplayWithAudio}(0,S.yC)(this.state.volume,this.state.isMuted),this.browserUserAgent=window.navigator.userAgent,this.element.classList.add("theater-video-controls"),this.element.style.overflow="",this.element.style.bottom="0",this.element.style.left="0",(0,T.c5)()?(this.element.style.height="30px",(0,p.fZ)(this.element,"solid-bg"),this.element.style.zIndex="14px"):(this.element.style.height="26px",(0,p.fZ)(this.element,"gradient-bg")),this.createVolumeImage(),this.element.appendChild(this.volumeImg),this.createVolumeSlider(),this.element.appendChild(this.volumeSlider.element),this.createVideoQualityButton(t),this.element.appendChild(this.videoQualityButton),(0,T.c5)()&&(this.createVideoQualityIcon(t),this.element.appendChild(this.videoQualityIcon)),this.controlButtons=new v.m,this.controlButtons.element.dataset.paction="TheaterOverlayTabs",this.controlButtons.element.style.position="absolute",this.controlButtons.element.style.bottom="0",this.controlButtons.element.style.right="0",this.controlButtons.element.style.textAlign="right",(0,T.c5)()&&(this.controlButtons.element.classList.add("theater-overlay"),this.controlButtons.element.style.overflow="visible",this.controlButtons.element.style.display="flex",this.controlButtons.element.style.alignItems="center",this.controlButtons.element.style.justifyContent="flex-end",this.controlButtons.element.style.minHeight="100%",this.controlButtons.element.style.marginRight="14px"),this.addChild(this.controlButtons),this.controlButtons.element.onclick=e=>{e.stopPropagation()},this.createPrivateButton(),this.controlButtons.element.appendChild(this.privateButton),this.showMyCamButton=H(B.Ru.showMyCamShow),this.showMyCamButton.dataset.testid="cam-to-cam-button",(0,m.Md)(this.showMyCamButton,this.videoOfflineChange)&&this.controlButtons.element.appendChild(this.showMyCamButton),this.createSendTipButton(),this.controlButtons.element.appendChild(this.sendTipButton),this.createChatButton(),this.controlButtons.element.appendChild(this.chatButton),this.createUserListButton(),this.controlButtons.element.appendChild(this.userListButton),this.createMoreRoomButton(),this.controlButtons.element.appendChild(this.moreRoomsButton),this.createTheaterModeButton(),this.createFullScreenButton(),(0,T.c5)()&&(this.createTheaterModeIcon(),this.controlButtons.element.appendChild(this.theaterModeIcon),this.createFullscreenIcon(),this.controlButtons.element.appendChild(this.fullscreenIcon)),this.controlButtons.element.appendChild(this.theaterModeButton),this.controlButtons.element.appendChild(this.fullscreenButton),(0,T.c5)()&&(this.createFullscreenEllipsis(),this.controlButtons.element.appendChild(this.fullscreenEllipsis),this.controlButtons.element.appendChild(this.fullscreenDropdown.element)),f.X0.listen((e=>{e.dossier.isAgeVerified?(this.privateAllowed=e.dossier.allowPrivateShow,this.showHidePrivateButton(e.chatConnection.status),e.chatConnection.event.statusChange.listen((e=>{this.showHidePrivateButton(e.currentStatus),"privatespying"===e.currentStatus&&w.F_.fire(void 0),this.showHideHlsPlayButton(e.currentStatus),(0,T.c5)()&&"noninteractive-fullscreen"===u.L.getVideoMode()&&!(0,I.x_)(e.currentStatus)&&(this.updateFullScreenButton(),(0,a.Eh)())})),e.chatConnection.event.settingsUpdate.listen((t=>{this.privateAllowed=t.allowPrivateShow&&!0===e.dossier.isAgeVerified,this.showHidePrivateButton(e.chatConnection.status)}))):(this.privateAllowed=!1,this.showHidePrivateButton(e.chatConnection.status)),this.currentRoomContext=e,this.playerIsHlsPlaceholder&&!this.forceHlsPlayButtonCreated&&(this.forceHlsPlayButtonCreated=!0,this.createForceHlsPlayButton(),this.showHideHlsPlayButton(e.dossier.roomStatus)),this.isAgeVerified=e.dossier.isAgeVerified,this.isOffline="offline"===e.dossier.roomStatus,this.updateVolumeImage(),this.playerIsJPEG||this.updateVolumeInternal(),this.updateIcons(),this.showControls()})),this.player.videoOfflineChange.listen((e=>{this.isOffline=e})),this.player.roomStatusNotifier.displayChanged.listen((()=>{this.updateFullScreenButton()})),u.L.changeVideoMode.listen((()=>{(0,T.c5)()&&"noninteractive-fullscreen"===u.L.getVideoMode()?this.hide():(this.show(),this.updateIcons())})),y.oO.listen((e=>{this.visible&&e||this.showControls()})),E.kw.listen((()=>{this.mute()})),A.pL.listen((()=>{(0,a.aS)()&&this.toggleInteractiveFullScreen()})),M.Lz.listen((()=>{this.forceHlsOverlayFunc()}),!1),a._c.listen((()=>{(0,a.aS)()&&(0,a.Gy)()===this.fullscreenDiv&&u.L.setFireVideoMode("fullscreen")})),this.element.onmousemove=()=>{this.showControls()},this.playerElement.ontouchstart=e=>{(0,T.c5)()?"split"===u.L.getVideoMode()&&this.showControls():this.showControls()},(0,g.wu)("click",this.element,(e=>{e.stopPropagation()})),(0,T.c5)()&&(0,g.wu)("touchstart",this.element,(e=>{this.showControls()})),this.hide()}createVideoQualityButton(e){if(this.videoQualityButton=H(""),this.videoQualityButton.title=B.Ru.videoQualityLabel,this.videoQualityButton.style.position="absolute",(0,T.c5)()?(this.videoQualityButton.style.left="131px",this.videoQualityButton.style.padding="8px 5px"):this.videoQualityButton.style.left="103px",this.videoQualityButton.style.bottom="0",!(0,T.c5)()){const t=t=>{const i=t.target;this.videoQualityButton.contains(i)||e.element.contains(i)||this.requestQualityModalVisibilityChange.fire(!1)};(0,g.wu)("touchend",document,t)}this.videoQualityButton.ontouchstart=()=>{this.requestQualityModalVisibilityChange.fire(!0)},this.videoQualityButton.onmouseover=()=>{this.requestQualityModalVisibilityChange.fire(!0)},this.videoQualityButton.onmouseout=t=>{if(null===t.relatedTarget)return;const i=t.relatedTarget.parentNode;null===i||i.isEqualNode(e.element)||this.requestQualityModalVisibilityChange.fire(!1)}}createVideoQualityIcon(e){this.videoQualityIcon=document.createElement("img"),this.videoQualityIcon.src=`${STATIC_URL}quality-gear-auto.svg`,this.videoQualityIcon.title=B.Ru.videoQualityLabel,(0,o.ZM)(this.videoQualityIcon,{position:"absolute",left:"131px",padding:"6px 0px",width:"32px",height:"18px",cursor:"pointer"}),this.isAutoQuality=!0,(0,g.wu)("touchend",document,(t=>{const i=t.target;this.videoQualityIcon.contains(i)||this.videoQualityButton.contains(i)||e.element.contains(i)||this.requestQualityModalVisibilityChange.fire(!1)})),this.videoQualityIcon.ontouchstart=()=>{this.requestQualityModalVisibilityChange.fire(!0)},this.videoQualityIcon.onmouseover=()=>{this.requestQualityModalVisibilityChange.fire(!0)},this.videoQualityIcon.onmouseout=t=>{if(null===t.relatedTarget)return;const i=t.relatedTarget.parentNode;null===i||i.isEqualNode(e.element)||this.requestQualityModalVisibilityChange.fire(!1)}}createVolumeSlider(){this.volumeSlider=new R.A({handleDiameter:12,barWidth:50}),this.volumeSlider.element.title=B.Ru.volumeSliderLabel,this.volumeSlider.element.style.margin="6px 5px 0 0",this.volumeSlider.element.style.position="absolute",(0,T.c5)()?(this.volumeSlider.element.style.bottom="9px",this.volumeSlider.element.style.left="56px"):(this.volumeSlider.element.style.bottom="7px",this.volumeSlider.element.style.left="36px"),this.volumeSlider.element.dataset.testid="volume-slider";const e=e=>{e!==this.state.volume&&(this.state.volume=e,this.state.isMuted=0===this.state.volume,this.updatePlayerVolume(),this.updateVolumeImage(),this.saveSettings())};this.volumeSlider.valueChangeStart.listen((t=>{this.playerIsJPEG&&void 0!==this.currentRoomContext&&this.requestHLS(this.currentRoomContext),this.setPlayerComponentMutedEvents.fire(!1),e(t)})),this.volumeSlider.valueChanged.listen(e),this.volumeSlider.valueChangeEnd.listen((t=>{e(t),0===this.state.volume&&this.setPlayerComponentMutedEvents.fire(!0),(0,S.bT)("ChangeVolume",{volume:t}),this.saveSettings()})),(0,s.J0)()&&this.volumeSlider.hideElement()}createVolumeImage(){this.volumeImg=document.createElement("img"),this.volumeImg.title=B.Ru.volumeLabel,this.volumeImg.style.height="24px",this.volumeImg.style.width="24px",this.volumeImg.style.margin=(0,T.c5)()?"0px 6px":"0 6px 2px",this.volumeImg.style.cursor="pointer",this.volumeImg.style.position="absolute",this.volumeImg.style.bottom="0",(0,T.c5)()&&(this.volumeImg.style.height="22px",this.volumeImg.style.width="22px",this.volumeImg.style.left="10px",this.volumeImg.style.padding="4px 7px",this.volumeImg.style.margin="0"),this.volumeImg.dataset.testid="volume-button",this.volumeImg.onclick=()=>{if(!this.playerIsJPEG||this.browserUserAgent.indexOf("MSIE 10.0")>-1||this.browserUserAgent.indexOf("MSIE 9.0")>-1)(0,S.bT)("ToggleMute",{newState:!this.state.isMuted}),(0,S.bT)("ChangeVolume",{volume:this.state.volume}),this.state.isMuted?this.unmute():this.mute(),this.showControls();else{if(void 0===this.currentRoomContext)return void error("unexpected switch to hls",{},"VIDEO_");this.requestHLS(this.currentRoomContext)}}}createPrivateButton(){this.privateButton=H(B.Ru.privateText),this.privateButton.onclick=()=>{w.F_.fire(void 0)}}createSendTipButton(){this.sendTipButton=H(B.Ru.sendTipButtonText),this.sendTipButton.id="send-tip",this.sendTipButton.onclick=()=>{w.f6.fire({})}}createChatButton(){this.chatButton=H(B.Ru.chatCapitalized),this.chatButton.id="chat-btn",this.chatButton.style.display="none",this.chatButton.onclick=()=>{w.y6.fire(void 0)}}createUserListButton(){this.userListButton=H(`${B.Ru.usersText} (0)`),this.userListButton.id="user-list",this.userListButton.dataset.pactionName="Users",this.userListButton.onclick=()=>{w.p3.fire(void 0)},P.K.listen((e=>{this.userListButton.innerText=`${B.Ru.usersText} (${e})`}))}createMoreRoomButton(){this.moreRoomsButton=H(B.Ru.moreRoomsText),this.moreRoomsButton.id="more-rooms",this.moreRoomsButton.onclick=()=>{E.nw.fire(void 0)}}createTheaterModeIcon(){this.theaterModeIcon=document.createElement("img"),this.theaterModeIcon.src=`${STATIC_URL}theater-mode.svg`,this.theaterModeIcon.classList.add("video-mode-icon"),this.theaterModeIcon.id="theater-mode-icon",this.theaterModeIcon.title=B.Ru.theaterModeLabel,this.theaterModeIcon.onclick=()=>{let e="split";"split"===u.L.getVideoMode()&&(e="theater"),u.L.setFireVideoMode(e),this.updateIcons()}}createTheaterModeButton(){this.theaterModeButton=H(B.Ru.theaterModeLabel),this.theaterModeButton.onclick=()=>{let e="split";"split"===u.L.getVideoMode()&&(e="theater"),u.L.setFireVideoMode(e),this.updateIcons()}}createFullscreenIcon(){this.isFullscreenAvailable=(0,a.T1)()||(0,s.OF)(),document[(0,a.tA)()]=()=>{(0,a.aS)()||(this.isFullscreenAvailable=!1,this.updateFullScreenButton(),(0,C.Q$)("Full screen is unavailable."))},this.fullscreenIcon=document.createElement("img"),this.fullscreenIcon.src=`${STATIC_URL}full-screen.svg`,this.fullscreenIcon.classList.add("video-mode-icon"),this.fullscreenIcon.id="full-screen-icon",this.fullscreenIcon.title=B.Ru.fullScreenLabel,this.updateFullScreenButton(),this.fullscreenIcon.onclick=()=>{this.toggleFullscreen()}}createFullScreenButton(){this.isFullscreenAvailable=(0,a.T1)()||(0,s.OF)(),document[(0,a.tA)()]=()=>{(0,a.aS)()||(this.isFullscreenAvailable=!1,this.updateFullScreenButton(),(0,C.Q$)("Full screen is unavailable."))},this.fullscreenButton=H(B.Ru.fullScreenLabel),this.fullscreenButton.id="full-screen",this.updateFullScreenButton(),this.fullscreenButton.onclick=()=>{this.toggleFullscreen()}}createFullscreenEllipsis(){this.fullscreenEllipsis=document.createElement("img"),this.fullscreenEllipsis.src=`${STATIC_URL}ellipsis-vertical.svg`,this.fullscreenEllipsis.id="fullscreen-dropdown",this.fullscreenEllipsis.title=B.Ru.switchFullscreenModeLabel,(0,o.ZM)(this.fullscreenEllipsis,{height:"13px",width:"3px",padding:"7px",cursor:"pointer"}),this.createFullscreenDropdown()}createFullscreenDropdown(){this.fullscreenDropdown=new D.n({toggleElement:this.fullscreenEllipsis,enterNativeFn:()=>this.requestNativeFullscreen(),enterInteractiveFn:()=>{}})}showHidePrivateButton(e){if(this.privateAllowed||-1!==["privaterequesting","privatespying","privatewatching"].indexOf(e))switch(e){case"unknown":case"offline":case"notconnected":case"away":case"hidden":case"hiddenwatching":case"passwordprotected":case"privatenotwatching":this.privateButton.style.display="none";break;default:"split"===u.L.getVideoMode()?this.privateButton.style.display="none":this.privateButton.style.display="inline-block"}else this.privateButton.style.display="none"}updateIcons(){this.sendTipButton.style.display=this.isAgeVerified?"inline-block":"none",this.moreRoomsButton.style.display="none",this.userListButton.style.display="inline-block",this.theaterModeButton.innerText=B.Ru.theaterModeLabel,this.theaterModeButton.style.display="inline-block",(0,T.c5)()&&(this.theaterModeIcon.style.display="inline-block",this.fullscreenEllipsis.style.display="inline-block",this.videoQualityButton.style.display="inline-block",this.videoQualityIcon.style.display="inline-block"),this.fullscreenButton.innerText=B.Ru.fullScreenLabel,this.chatButton.style.display="inline",this.showMyCamButton.style.display="block",void 0!==this.currentRoomContext&&this.showHidePrivateButton(this.currentRoomContext.chatConnection.status),(0,T.c5)()?(this.updateIconsByModeNewVideoControls(),((0,s.J0)()||this.playerIsJPEG)&&(this.videoQualityIcon.style.display="none",this.videoQualityButton.style.display="none")):this.updateIconsByMode(),this.updateFullScreenButton(),this.isOffline&&(this.showMyCamButton.style.display="none",this.userListButton.style.display="none"),this.showControls()}updateIconsByMode(){switch(u.L.getVideoMode()){case"split":this.sendTipButton.style.display="none",this.userListButton.style.display="none",this.chatButton.style.display="none",this.privateButton.style.display="none",this.showMyCamButton.style.display="none",this.isEmbed&&(this.theaterModeButton.style.display="none");break;case"videoonly":this.sendTipButton.style.display="none",this.userListButton.style.display="none",this.chatButton.style.display="none",this.privateButton.style.display="none",this.showMyCamButton.style.display="none",this.theaterModeButton.style.display="none";break;case"theater":this.theaterModeButton.innerText=B.Ru.splitModeLabel,this.theaterModeButton.id="default-view",this.moreRoomsButton.style.display="inline-block";break;case"fullscreen":this.moreRoomsButton.style.display="inline-block",this.theaterModeButton.style.display="none",this.fullscreenButton.innerText=B.Ru.exitFullScreenLabel;break;case"noninteractive-fullscreen":break;default:error(`Unexpected VideoMode: ${u.L.getVideoMode()}`,{},"VIDEO_")}}updateIconsByModeNewVideoControls(){switch(this.fullscreenDropdown.hideElement(),(0,p.SA)(this.fullscreenDropdown.interactiveOption,"active"),(0,p.SA)(this.fullscreenDropdown.nativeOption,"active"),u.L.getVideoMode()){case"split":this.videoQualityButton.style.display="none",this.sendTipButton.style.display="none",this.userListButton.style.display="none",this.chatButton.style.display="none",this.privateButton.style.display="none",this.showMyCamButton.style.display="none",this.theaterModeButton.style.display="none",this.fullscreenButton.style.display="none",this.fullscreenEllipsis.style.display="none",this.isEmbed&&(this.theaterModeIcon.style.display="none");break;case"videoonly":this.videoQualityButton.style.display="none",this.videoQualityIcon.style.display="none",this.sendTipButton.style.display="none",this.userListButton.style.display="none",this.chatButton.style.display="none",this.privateButton.style.display="none",this.showMyCamButton.style.display="none",this.theaterModeButton.style.display="none",this.theaterModeIcon.style.display="none",this.fullscreenEllipsis.style.display="none";break;case"theater":this.videoQualityIcon.style.display="none",this.theaterModeButton.innerText=B.Ru.splitModeLabel,this.theaterModeButton.id="default-view",this.moreRoomsButton.style.display="inline-block",this.theaterModeIcon.style.display="none",this.fullscreenIcon.style.display="none",this.fullscreenEllipsis.style.display="none";break;case"fullscreen":this.videoQualityIcon.style.display="none",this.moreRoomsButton.style.display="inline-block",this.theaterModeButton.style.display="none",this.fullscreenButton.innerText=B.Ru.exitLabel,this.theaterModeIcon.style.display="none",this.fullscreenIcon.style.display="none",(0,p.fZ)(this.fullscreenDropdown.interactiveOption,"active");break;case"noninteractive-fullscreen":(0,p.fZ)(this.fullscreenDropdown.nativeOption,"active");break;default:error(`Unexpected VideoMode: ${u.L.getVideoMode()}`,{},"VIDEO_")}}updateVolumeImage(){const e=this.volumeSlider.getValue();0===e||this.state.isMuted?(this.volumeImg.src=`${STATIC_URL}volume-mute.svg`,this.volumeImg.id="volume-mute",this.volumeImg.title=B.Ru.unmuteCapitalized):e<33?(this.volumeImg.src=`${STATIC_URL}volume-low.svg`,this.volumeImg.id="volume-low",this.volumeImg.title=B.Ru.muteLabel):e<66?(this.volumeImg.src=`${STATIC_URL}volume-medium.svg`,this.volumeImg.id="volume-medium",this.volumeImg.title=B.Ru.muteLabel):(this.volumeImg.src=`${STATIC_URL}volume-high.svg`,this.volumeImg.id="volume-high",this.volumeImg.title=B.Ru.muteLabel)}updatePlayerVolume(){this.setPlayerComponentVolumeMutedEvents.fire({...this.state})}saveSettings(){if((0,s.Pf)()){const e={volume:this.state.volume,isMuted:this.state.isMuted};window.localStorage.setItem(W,JSON.stringify(e))}(0,S.yC)(this.state.volume,this.state.isMuted)}update(){this.updateVolumeInternal(),this.saveSettings()}updateVolumeInternal(){this.volumeSlider.setValue(this.state.isMuted?0:this.state.volume),this.updatePlayerVolume(),this.updateVolumeImage()}mute(){this.updateIsMuted(!0),this.update()}unmute(){this.updateIsMuted(!1),0===this.state.volume&&(this.state.volume=60),this.update()}toggleMuted(){this.state.isMuted?this.unmute():this.mute()}toggle(){this.visible?this.hideControls():this.showControls()}showControls(){if((0,T.c5)()){if(this.isOffline&&"fullscreen"!==u.L.getVideoMode())return void this.hideControls()}else if(this.isOffline)return void this.hideControls();this.visible=!0,this.fixVerticalOrHorizontalPositioning(),(0,L.Ve)(this.element,"100ms"),(0,T.c5)()?(this.element.style.opacity="1",this.element.style.visibility=""):this.element.style.display="block",void 0!==this.hideDebounceTimer&&clearTimeout(this.hideDebounceTimer),void 0!==this.opacityTimer&&clearTimeout(this.opacityTimer),this.locked||this.startHideTimeout()}startHideTimeout(){const e=this.hideControlsCalled?2e3:5e3;this.hideDebounceTimer=window.setTimeout((()=>{this.hideDebounceTimer=void 0,this.opacityTimer=window.setTimeout((()=>{this.opacityTimer=void 0,this.hideControls()}),e-100)}),100)}lockShowingControls(){this.locked=!0,this.showControls()}unlockShowingControls(){this.locked=!1,this.startHideTimeout()}showVertical(){const e=(0,T.c5)()?780:750;return"theater"===u.L.getVideoMode()&&(0,x.DK)()<e}fixVerticalOrHorizontalPositioning(){const e=this.showVertical();e?(this.controlButtons.element.style.width="100px",this.controlButtons.element.style.marginBottom="15px",(0,T.c5)()&&(this.controlButtons.element.style.display="block",this.controlButtons.element.style.marginRight="",(0,p.SA)(this.element,"solid-bg"),(0,p.fZ)(this.element,"gradient-bg"))):(this.controlButtons.element.style.width="",this.controlButtons.element.style.marginBottom="",(0,T.c5)()&&(this.controlButtons.element.style.display="flex",this.controlButtons.element.style.marginRight="14px",(0,p.SA)(this.element,"gradient-bg"),(0,p.fZ)(this.element,"solid-bg")));for(const t of this.controlButtons.element.children)t instanceof HTMLElement&&"none"!==t.style.display&&(t.style.display=e?"block":"inline-block")}hideControls(){this.hlsWaitingForInteraction||void 0!==this.hideDebounceTimer||this.locked||(this.visible=!1,this.hideControlsCalled=!0,(0,L.Ve)(this.element,"500ms"),(0,T.c5)()?(this.requestQualityModalVisibilityChange.fire(!1),this.element.style.opacity="0",this.element.style.visibility="hidden"):this.element.style.display="none")}show(){(0,T.c5)()?this.element.style.display="block":this.element.style.visibility="",this.showControls(),(0,T.c5)()?this.element.style.zIndex="14":this.element.style.zIndex=this.hlsWaitingForInteraction?"10":"2"}hide(){this.locked||((0,T.c5)()?this.element.style.display="none":this.element.style.visibility="hidden")}updateVolume(e){this.state.volume=e,this.volumeSlider.setValue(this.state.isMuted?0:this.state.volume),this.updateVolumeImage()}updateIsMuted(e){this.state.isMuted=e,this.volumeSlider.setValue(this.state.isMuted?0:this.state.volume),this.updateVolumeImage()}updateAndSaveVolume(e){this.updateVolume(e),this.saveSettings()}updateAndSaveIsMuted(e){this.updateIsMuted(e),this.saveSettings()}getControlBarHeight(){return 0}isFullVideo(){return!1}toggleFullscreen(){this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(),(0,a.aS)()?(0,a.Eh)():!(0,T.c5)()||(0,s.J0)()||this.isEmbed?this.isFullscreenAvailable&&((0,s.OF)()?window.setTimeout((()=>{this.playerComponentEnterFullScreenModeEvent.fire(void 0)}),250):this.playerComponentEnterFullScreenModeEvent.fire(void 0)):this.toggleInteractiveFullScreen(),this.updateIcons()}requestNativeFullscreen(){this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(),this.isFullscreenAvailable&&((0,s.OF)()?window.setTimeout((()=>{this.playerComponentEnterFullScreenModeEvent.fire(void 0)}),250):(this.hide(),this.playerComponentEnterFullScreenModeEvent.fire(void 0))),(0,T.c5)()||this.updateIcons()}toggleInteractiveFullScreen(){"fullscreen"===u.L.getVideoMode()?(0,a.Eh)():(0,a.lh)(this.fullscreenDiv)}updateFullScreenButton(){var e;if((0,T.c5)())return void this.updateFullScreenButtonNewVideoControls();const t=u.L.getVideoMode(),i="videoonly"===t,s="fullscreen"===t,n=this.player.roomStatusNotifier.isShown(),o=this.isFullscreenAvailable&&(!i&&!n||s),l="chat-player"===(null===(e=(0,a.Gy)())||void 0===e?void 0:e.id);o?this.fullscreenButton.style.display="inline-block":(this.fullscreenButton.style.display="none",(0,a.aS)()&&l&&(0,a.Eh)())}updateFullScreenButtonNewVideoControls(){var e;const t=u.L.getVideoMode(),i="videoonly"===t,s="fullscreen"===t,n="theater"===t,o=this.player.roomStatusNotifier.isShown(),l=this.isFullscreenAvailable&&(!i&&!o||s),r="chat-player"===(null===(e=(0,a.Gy)())||void 0===e?void 0:e.id);l?s||n?(this.fullscreenButton.style.display="inline-block",void 0!==this.fullscreenEllipsis&&s&&(this.fullscreenEllipsis.style.display=o?"none":"inline-block")):void 0!==this.fullscreenIcon&&(this.fullscreenIcon.style.display="inline-block"):(this.fullscreenButton.style.display="none",void 0!==this.fullscreenIcon&&(this.fullscreenIcon.style.display="none"),(0,a.aS)()&&r&&(0,a.Eh)())}forceHlsOverlayFunc(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.hlsWaitingForInteraction&&void 0!==this.currentRoomContext&&(void 0!==this.forceHlsOverlay&&null!==this.forceHlsOverlay.parentElement&&(this.forceHlsOverlay.parentElement.removeChild(this.forceHlsOverlay),this.forceHlsOverlay=void 0),void 0!==this.playButtonContainer&&null!==this.playButtonContainer.parentElement&&(this.playButtonContainer.parentElement.removeChild(this.playButtonContainer),this.playButtonContainer=void 0),this.hlsWaitingForInteraction=!1,this.hideControls(),this.hide(),this.videoQualityButton.innerText="",this.videoQualityButton.style.display="none",(0,T.c5)()&&(this.videoQualityIcon.style.display="none"),!this.forceHlsTriggered&&e&&(this.forceHlsTriggered=!0,(0,S.bT)("ForceHLS"),this.forceHlsPlayerEvent.fire({roomContext:this.currentRoomContext,unmute:!1}),A.Io.fire(void 0)),(0,T.c5)()?this.element.style.zIndex="14":this.element.style.zIndex="2")}maybeForceHls(){this.playerIsJPEG&&this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc()}createHlsPlayOverlay(){this.forceHlsOverlay=document.createElement("div"),this.forceHlsOverlay.style.width="100%",this.forceHlsOverlay.style.height="100%",this.forceHlsOverlay.style.position="absolute",this.forceHlsOverlay.style.top="0",this.forceHlsOverlay.style.left="0",this.forceHlsOverlay.style.cursor="pointer",(0,g.wu)("click",this.forceHlsOverlay,(()=>{this.forceHlsOverlayFunc()})),(0,g.wu)("click",this.element,(()=>{this.forceHlsOverlayFunc()})),this.playerComponentReadjustForceHlsOverlayOrderEvent.fire(this.forceHlsOverlay)}showHideHlsPlayButton(e){void 0!==this.playButtonContainer&&void 0!==this.forceHlsOverlay&&((0,I.x_)(e)?(this.playButtonContainer.style.display="",this.forceHlsOverlay.style.display=""):(this.playButtonContainer.style.display="none",this.forceHlsOverlay.style.display="none"))}createForceHlsPlayButton(){if(this.playerIsJPEG){this.hlsWaitingForInteraction=!0,this.playButtonContainer=document.createElement("div");const e=this.playerElement.getBoundingClientRect(),t=document.createElement("img");t.src=`${STATIC_URL}play-inactive.svg`,t.style.width="60px",t.style.height="60px",t.style.position="relative",t.style.top="40px",t.style.left="45px",t.style.cursor="pointer",(0,g.wu)("click",t,(()=>{this.forceHlsOverlayFunc()})),this.playButtonContainer.style.position="absolute",this.playButtonContainer.style.top=e.height/2-70+"px",this.playButtonContainer.style.left=e.width/2-70+"px",this.playButtonContainer.style.cursor="pointer",this.playButtonContainer.style.width="140px",this.playButtonContainer.style.height="140px",this.playButtonContainer.style.borderRadius="50%",this.playButtonContainer.style.backgroundColor="rgba(0,0,0,0.25)",this.playButtonContainer.appendChild(t),this.playerComponentReadjustPlayButtonContainerEvent.fire(this.playButtonContainer),this.showJpegPlayerComponentImage.fire(void 0),this.createHlsPlayOverlay(),this.repositionChildren()}}onForceJPEG(){(0,T.c5)()&&(this.videoQualityIcon.style.display="none","noninteractive-fullscreen"===u.L.getVideoMode()&&(0,a.aS)()&&((0,a.Eh)(),a._c.fire())),this.updateIcons(),this.show()}repositionChildren(){if(void 0!==this.playButtonContainer){const e=this.playerElement.getBoundingClientRect();this.playButtonContainer.style.top=e.height/2-70+"px",this.playButtonContainer.style.left=e.width/2-70+"px"}}notifySupportsAutoplayWithAudio(e){this.playerSupportsAutoplayWithAudio=e}notifyIsJPEG(e){this.playerIsJPEG=e,(0,T.c5)()&&e&&(this.videoQualityIcon.style.display="none")}notifyIsHlsPlaceholder(e){this.playerIsHlsPlaceholder=e}notifyVideoOfflineChange(e){this.videoOfflineChange.fire(e)}notifyQualityLevelChanged(e){this.videoQualityButton.innerText=e,(0,T.c5)()&&this.updateVideoQualityIcon(e)}updateVideoQualityIcon(e){var t;if(this.isAutoQuality="auto"===e,this.isAutoQuality)this.videoQualityIcon.src=`${STATIC_URL}quality-gear-auto.svg`;else switch((null!==(t=e.match(/\d+p/))&&void 0!==t?t:[""])[0]){case"240p":this.videoQualityIcon.src=`${STATIC_URL}quality-gear-240p.svg`;break;case"360p":this.videoQualityIcon.src=`${STATIC_URL}quality-gear-360p.svg`;break;case"480p":this.videoQualityIcon.src=`${STATIC_URL}quality-gear-480p.svg`;break;case"540p":this.videoQualityIcon.src=`${STATIC_URL}quality-gear-540p.svg`;break;case"720p":this.videoQualityIcon.src=`${STATIC_URL}quality-gear-720p.svg`;break;case"1080p":this.videoQualityIcon.src=`${STATIC_URL}quality-gear-hd.svg`;break;case"1440p":this.videoQualityIcon.src=`${STATIC_URL}quality-gear-1440p.svg`;break;case"2160p":this.videoQualityIcon.src=`${STATIC_URL}quality-gear-4k.svg`}}setVideoQualityButtonVisibility(e){this.videoQualityButton.style.display=e?"":"none",(0,T.c5)()&&("split"===u.L.getVideoMode()?(this.videoQualityIcon.style.display=e?"":"none",this.videoQualityButton.style.display="none"):(this.videoQualityIcon.style.display="none",this.videoQualityButton.style.display=e?"":"none"))}setVideoQualityButtonTopToMatch(e){}getQualityButtonLeft(){return(0,T.c5)()&&"none"!==this.videoQualityIcon.style.display?this.videoQualityIcon.offsetLeft:this.videoQualityButton.offsetLeft}checkIfElementIsInVolumeControls(e){for(const t of this.volumeSlider.element.children)if(e===t)return!0;return e===this.volumeImg||e===this.volumeSlider.element||e===this.volumeSlider.handle}notifyChatVisibilityChanged(e){}getRoomContext(){return this.currentRoomContext}requestHLS(e){this.hlsWaitingForInteraction&&this.forceHlsOverlayFunc(!1),(0,S.bT)("ForceHLS"),this.forceHlsPlayerEvent.fire({roomContext:e}),this.unmute(),A.Io.fire(void 0)}}function H(e){const t=document.createElement("span");return t.innerText=e,t.style.color="#ffffff",t.style.fontSize="13px",t.style.padding="5px",t.style.marginRight="4px",t.style.cursor="pointer",t.style.display="inline-block",t}var F=i(29937),U=i(25173),V=i(33933);class N extends U.Q{constructor(e){if(super(),this.player=e,this.notifyQualityLevelLabelChanged=new l.c_("notifyQualityLevelLabelChanged"),this.notifyQualityLevelChanged=new l.c_("notifyQualityLevelChanged"),this.requestVideoQualityButtonVisibilityChange=new l.c_("requestVideoQualityButtonVisibilityChange"),this.requestVideoQualityModalReposition=new l.c_("requestVideoQualityModalReposition"),this.notifyVisibilityChanged=new l.c_("notifyVisibilityChanged"),this.qualityMap=new Map,this.element.style.visibility="hidden",(0,T.c5)()&&(this.element.style.opacity="0"),this.element.style.width="auto",this.element.style.minWidth="100px",this.element.style.height="auto",this.element.style.backgroundColor="black",this.element.style.position="absolute",this.element.style.borderRadius="2px",this.element.style.backgroundColor="rgba(50, 50, 50, 0.7)",this.player.playerComponent instanceof V.y&&((0,g.wu)("visibilitychange",document,(()=>{this.player.videoDisabled||("visible"===document.visibilityState?this.stopQualityTimer():"hidden"===document.visibilityState&&this.restartQualityTimer(0))})),(0,T.c5)())){const e=this.player.playerComponent.getVideoElement();void 0!==e&&(0,g.wu)("resize",e,(()=>{this.updateAutoQualityOptionLabel()}))}this.element.onmouseenter=()=>{this.show()},this.element.onmouseleave=()=>{this.hide()}}repositionChildren(){this.requestVideoQualityModalReposition.fire(void 0)}alignToLeftBottom(e,t){this.element.style.left=`${e}px`,this.element.style.bottom=t-1+"px"}notifyAvailableQualityLevelsChanged(e){this.qualityMap.clear(),this.autoOptionDOM=void 0,this.removeAllDOMChildren();for(const t of e){this.qualityMap.set(t.label,t.value),1===e.length&&(t.toggled=!0);const i=this.createQualityOption(t);-1===t.value&&(this.autoOptionDOM=i),this.element.appendChild(i),t.toggled&&(this.notifyQualityLevelLabelChanged.fire(t.label),this.currentQualityLevel=t.value)}0===e.length?this.requestVideoQualityButtonVisibilityChange.fire(!1):this.requestVideoQualityButtonVisibilityChange.fire(!0),this.addLLHLSToggle(),this.updateAutoQualityOptionLabel()}updateAutoQualityOptionLabel(){if(!(0,T.c5)()||0===this.qualityMap.size||void 0===this.autoOptionDOM)return;if(this.autoOptionDOM.innerText="auto",-1!==this.currentQualityLevel)return;let e;if(this.player.playerComponent instanceof V.y){const t=this.player.playerComponent.getVideoJs();void 0!==t&&(e=t.videoHeight())}var t;if(void 0===e&&(e=null===(t=this.player.playerComponent.getVideoElement())||void 0===t?void 0:t.videoHeight),void 0!==e){this.autoOptionDOM.innerText=`auto (${e.toString()}p)`;for(const t of this.qualityMap.keys()){var i;if(t.startsWith(null===(i=e)||void 0===i?void 0:i.toString())){this.autoOptionDOM.innerText=`auto (${t})`;break}}}}createQualityOption(e){const t=document.createElement("div");return t.innerText=e.label,t.style.color="#ffffff",t.style.fontSize="13px",t.style.padding="5px",t.style.marginRight="6px",t.style.cursor="pointer",t.style.width="100%",e.toggled?(t.style.backgroundColor="#ffffff",t.style.color="#333333"):(t.onclick=()=>{this.setQualityLevel(e.label),this.notifyQualityLevelLabelChanged.fire(e.label)},t.onmouseenter=()=>{t.style.backgroundColor="rgba(150, 150, 150, 0.3)"},t.onmouseleave=()=>{t.style.backgroundColor=""}),t}setQualityLevel(e){const t=this.qualityMap.get(e);void 0!==t?(this.notifyQualityLevelChanged.fire(t),this.currentQualityLevel=t,this.updateAutoQualityOptionLabel()):error("Undefined quality level key",{},"VIDEO_")}restartQualityTimer(e){this.visibilityTimeoutFunc=window.setTimeout((()=>{this.previousQualityLevel=this.currentQualityLevel,this.notifyQualityLevelChanged.fire(e),this.currentQualityLevel=e}),3e5)}stopQualityTimer(){void 0!==this.previousQualityLevel&&(this.notifyQualityLevelChanged.fire(this.previousQualityLevel),this.previousQualityLevel=void 0),clearTimeout(this.visibilityTimeoutFunc)}show(){this.notifyVisibilityChanged.fire(!0),(0,T.c5)()?((0,L.Ve)(this.element,"100ms"),this.element.style.visibility="",this.element.style.opacity="1",this.player.videoControls.show()):(this.showElement(),this.element.style.visibility=""),this.repositionChildren()}hide(){this.notifyVisibilityChanged.fire(!1),(0,T.c5)()?((0,L.Ve)(this.element,"500ms"),this.element.style.opacity="0",this.element.style.visibility="hidden"):(this.hideElement(),this.element.style.visibility="hidden")}addLLHLSToggle(){const e=document.createElement("div"),t=document.createElement("label");t.innerText="Low-Latency HLS",t.style.color="#ffffff",t.style.fontSize="13px",t.style.marginRight="5px",e.style.padding="5px",e.style.cursor="pointer",e.style.width="100%",e.onmouseenter=()=>{e.style.backgroundColor="rgba(150, 150, 150, 0.3)"},e.onmouseleave=()=>{e.style.backgroundColor=""},e.appendChild(t);const i=new F.l(!1,(()=>{this.player.playerComponent.forceStream(i.isChecked())}),{height:12,width:25});i.element.style.marginBottom="2px",e.appendChild(i.element),e.style.display="none";const s=document.createElement("hr");s.style.borderTop="1px solid #bbb",s.style.margin="0",s.style.opacity="0.3",s.style.display="none",this.element.appendChild(s),this.element.appendChild(e),this.player.playerComponent.updateLLHLSButton.listen((t=>{let{allowed:n,enabled:o}=t;n?(e.style.display="block",s.style.display="block"):(e.style.display="none",s.style.display="none"),i.setCheckedDirectly(o)}))}}const Q=new l.c_("scrollToTheaterModePlayer");class $ extends r.N{constructor(e){super(e,new c.k(!1),{noHook:!0}),this.isWidescreen=!0,this.videoDisabled=!1;const t=document.createElement("div");t.style.paddingBottom=100*(this.isWidescreen?d.qL:d.Bu)+"%",this.element.prepend(t),(0,o.ZM)(this.element,{position:"relative",backgroundColor:"#000000",overflow:"hidden"}),this.playerComponent.element.style.position="relative",this.adjustWatermarkStyle({width:"88px",height:"26px",top:"6px",right:"6px",visibility:this.shouldHideWatermark()?"hidden":"initial",opacity:(0,s.J0)()?"0.5":void 0}),this.roomStatusNotifier.moreRoomsLink.style.visibility="hidden",this.videoQualityModal=new N(this),this.videoControls=new O(this,this.videoQualityModal),this.bindQualityModal(),this.bindControlsEvents(),this.afterPlayerCreated(),this.prependChild(this.roomStatusNotifier),this.element.id="TheaterModePlayer",this.addChild(this.videoQualityModal),this.addChild(this.videoControls),this.videoControls.show(),this.videoControls.element.dataset.paction="VideoControl",this.element.onmousemove=()=>{"split"===u.L.getVideoMode()&&this.playerComponent.showControls()},Q.listen((()=>{this.element.scrollIntoView(!1),window.scrollBy(0,32)})),a._c.listen((()=>{this.ensureLabelsAppended()}))}ensureLabelsAppended(){if((0,a.aS)()){var e,t;const i=null!==(e=null===(t=this.playerComponent.getVideoElement())||void 0===t?void 0:t.parentElement)&&void 0!==e?e:this.playerComponent.element;null==i||i.appendChild(this.watermark)}else this.element.appendChild(this.watermark)}addDraggableCanvas(e){this.addChild(e),e.element.style.zIndex="2"}isProtocolJPEG(){return this.playerComponent instanceof h.O}bindControlsEvents(){this.videoControls.forceHlsPlayerEvent.listen((e=>{let{roomContext:t,unmute:i}=e;this.forceHlsPlayer(t,null==i||i)})),this.videoControls.setPlayerComponentMutedEvents.listen((e=>{this.playerComponent.setMuted(e)})),this.videoControls.playerComponentEnterFullScreenModeEvent.listen((()=>{this.playerComponent.enterFullScreenMode()})),this.videoControls.setPlayerComponentVolumeMutedEvents.listen((e=>{this.playerComponent.setVolumeMuted(e.volume,e.isMuted)})),this.videoControls.playerComponentReadjustForceHlsOverlayOrderEvent.listen((e=>{this.playerComponent.element.insertBefore(e,this.playerComponent.element.firstChild)})),this.videoControls.playerComponentReadjustPlayButtonContainerEvent.listen((e=>{this.element.insertBefore(e,this.videoControls.element)})),this.videoControls.showJpegPlayerComponentImage.listen((()=>{this.playerComponent instanceof h.O&&this.playerComponent.showPlayerImage()})),this.videoControls.requestQualityModalVisibilityChange.listen((e=>{e?this.videoQualityModal.show():this.videoQualityModal.hide()}))}bindQualityModal(){this.videoQualityModal.notifyQualityLevelChanged.listen((e=>{this.playerComponent.setQualityLevel(e)})),this.videoQualityModal.notifyQualityLevelLabelChanged.listen((e=>{this.videoControls.notifyQualityLevelChanged(e)})),this.videoQualityModal.requestVideoQualityButtonVisibilityChange.listen((e=>{this.videoControls.setVideoQualityButtonVisibility(e)})),this.videoQualityModal.requestVideoQualityModalReposition.listen((()=>{const e=this.playerComponent.element.offsetLeft,t=this.videoControls.getQualityButtonLeft(),i=this.videoControls.element.offsetHeight;this.videoQualityModal.alignToLeftBottom(e+t,i)})),this.videoQualityModal.notifyVisibilityChanged.listen((e=>{this.videoControls.setVideoQualityButtonTopToMatch(e)}))}bindVideoEvents(){var e,t;super.bindVideoEvents(),this.playerComponent.requestControlVisibility.listen((e=>{e?this.videoControls.show():this.videoControls.hide()})),null===(e=this.playerComponent.setControlVolume)||void 0===e||e.listen((e=>{let{volume:t,save:i}=e;i?this.videoControls.updateAndSaveVolume(t):this.videoControls.updateVolume(t)})),null===(t=this.playerComponent.setControlIsMuted)||void 0===t||t.listen((e=>{let{isMuted:t,save:i}=e;i?this.videoControls.updateAndSaveIsMuted(t):this.videoControls.updateIsMuted(t)})),this.playerComponent.videoOfflineChange.listen((e=>{this.videoControls.notifyVideoOfflineChange(e)})),this.playerComponent.possibleQualityLevelsChanged.listen((e=>{this.videoQualityModal.notifyAvailableQualityLevelsChanged(e)}))}stylePlayerComponent(){this.playerComponent.element.style.position="absolute";const e=document.getElementById("VideoPanel");e instanceof HTMLElement&&(e.style.height="100%")}repositionChildren(){const e=u.L.getVideoMode(),t=()=>{"theater"===e||("videoonly"===e?this.videoOnlyResize():this.defaultResize()),this.playerComponent.element.style.left="0",this.playerComponent.element.style.top="0",this.adjustWatermarkStyle({visibility:this.shouldHideWatermark()?"hidden":"initial"})};switch(e){case"split":case"videoonly":t(),this.playerComponent.showControls();break;case"theater":t(),(0,a.aS)()||this.playerComponent.showControls();break;case"fullscreen":this.playerComponent.showControls();break;case"noninteractive-fullscreen":break;default:error(`Unexpected VideoMode: ${e}`)}}videoOnlyResize(){const e=document.documentElement.clientHeight,t=document.documentElement.clientWidth;this.element.style.height=`${this.isWidescreen?e:t*d.Bu}px`,this.element.style.width=`${this.isWidescreen?e/d.qL:t}px`,this.playerComponent.element.style.height="100%",this.playerComponent.element.style.width="100%"}defaultResize(){this.element.style.height="auto",this.element.style.width="100%",this.playerComponent.element.style.height="100%",this.playerComponent.element.style.width="100%"}shouldHideWatermark(){return n.m.shouldHideWaterMark}setIsWidescreen(e){this.isWidescreen=e,this.repositionChildrenRecursive()}getIsWidescreen(){return this.isWidescreen}setPlayerComponentDimensions(e,t){this.playerComponent.element.style.width=`${e}px`,this.playerComponent.element.style.height=`${t}px`}forceJPEGPushPlayer(e){super.forceJPEGPushPlayer(e),this.videoControls.element.style.display="block",this.videoControls.onForceJPEG()}afterPlayerCreated(){super.afterPlayerCreated(),this.videoControls.notifySupportsAutoplayWithAudio(this.playerComponent.supportsAutoplayWithAudio),this.playerComponent instanceof h.O?(this.videoControls.notifyIsJPEG(!0),this.videoControls.notifyIsHlsPlaceholder(this.playerComponent.getIsHlsPlaceholder())):(this.videoControls.notifyIsJPEG(!1),this.videoControls.notifyIsHlsPlaceholder(!1)),this.ensureLabelsAppended()}notifyChatVisibilityChanged(e){this.videoControls.notifyChatVisibilityChanged(e)}toggleMute(){if(this.playerComponent instanceof h.O){const e=this.videoControls.getRoomContext();void 0!==e&&this.forceHlsPlayer(e)}else this.videoControls.toggleMuted();this.videoControls.show()}isEmbed(){return!1}}},43058:(e,t,i)=>{i.d(t,{K:()=>b,R:()=>T});var s=i(99447),n=i(69757),o=i(68039),l=i(19505),a=i(62331),r=i(6784),h=i(50213),d=i(32939),c=i(63955),u=i(78423),p=i(76440),m=i(27407),y=i(61452),v=i(7176),g=i(44947),C=i(79681),f=i(62091);const b=new u.c_("userCountUpdate");class T extends a.YI{constructor(){super(),this.userCount=0,this.userList=[],this.settingInput=!1,this.handleSpan=document.createElement("span"),this.baseTabHandleText=`${g.Ru.usersCAPS} `,this.element.id="UserListTab",this.element.style.overflow="visible",this.element.style.fontFamily="Tahoma, Helvetica, Arial, sans-serif",this.element.style.boxSizing="border-box",this.element.style.position="relative",this.element.dataset.pactionName="Users";const e=document.createElement("div");(0,c.ZM)(e,{display:"flex",flexDirection:"column",width:"100%",height:"100%"}),this.element.appendChild(e),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.overflow="auto",this.wrapper.style.padding="6px",this.wrapper.style.boxSizing="border-box",this.wrapper.style.flex="1",e.appendChild(this.wrapper),this.anonUsersDiv=this.createAnonUsersDiv(),this.inputDiv=(0,f.gI)();const t=(0,f.zh)();this.inputField=(0,f.Zw)((()=>!1),Math.max(f.hk,f.mU));const i=()=>{void 0===this.parent||this.settingInput||this.parent.changeToFirstTab()};(0,r.wu)("click",this.inputField.element,i),(0,r.wu)("focus",this.inputField.element,i),this.buttonHolder=new l.J;const s=document.createElement("span");new(n.c.get("SendButton"))({onClick:i,isPm:!1,variant:"SplitMode"},s),this.buttonHolder.addButton(s,l.z.Text),t.appendChild(this.inputField.element),this.inputDiv.appendChild(t),this.inputDiv.appendChild(this.buttonHolder.element),e.appendChild(this.inputDiv),this.createLoadingDiv(),d.X0.listen((e=>{this.chatConn=e.chatConnection,this.chatConn.event.statusChange.listen((e=>{("privatewatching"===e.previousStatus||"privatewatching"===e.currentStatus)&&window.setTimeout((()=>{this.refresh()}),2e3)})),this.chatConn.event.roomCountUpdate.listen((e=>{this.userCount=e,b.fire(this.userCount)})),this.clear(e.dossier.numViewers)})),(0,o.It)()&&o.tb.listen((e=>{this.isCurrentTab()||this.displayList(e),this.updateUserCount(e.anonCount,e.totalCount)}))}initSplitTestHandle(){void 0===this.tabHandleIcon&&(this.tabHandleIcon=(0,v.DU)(),this.tabHandleIcon.style.height="1em",this.tabHandleIcon.style.paddingTop="1px"),this.handle.element.textContent="",this.handle.element.style.fill="currentColor",this.handleSpan.appendChild(this.tabHandleIcon),this.handleSpan.appendChild(document.createTextNode("Â ")),this.handleSpan.style.verticalAlign="top",this.handle.element.appendChild(this.handleSpan),this.baseTabHandleText=""}hideUserList(){this.listDiv.style.display="none",this.refreshDiv.style.display="none",this.anonUsersDiv.style.display="none"}removeUserListChildren(){for(;null!==this.wrapper.firstChild;)this.wrapper.removeChild(this.wrapper.firstChild)}createAnonUsersDiv(){const e=document.createElement("div");return(0,s.fZ)(e,s.aG.defaultTooltipColor),(0,c.ZM)(e,{width:"100%",margin:"2px 0",whiteSpace:"nowrap",cssFloat:"left",padding:"4px 0"}),e}createLoadingDiv(){this.loadingDiv=document.createElement("div"),(0,s.fZ)(this.loadingDiv,s.aG.defaultColor),this.loadingDiv.innerText=`${g.Ru.loadingUserListText}...`,this.loadingDiv.style.margin="8px 0",this.wrapper.style.fontSize="12px",this.wrapper.appendChild(this.loadingDiv)}showLoadingDiv(){this.loadingDiv.style.display="block"}createRefreshUsersLink(){this.refreshDiv=document.createElement("div"),this.refreshDiv.style.margin="6px",this.refreshDiv.style.cssFloat="right";const e=document.createElement("span");e.innerText=g.Ru.refreshUserListText,e.style.cursor="pointer",(0,s.fZ)(e,"refreshUsersLink"),e.onmouseenter=()=>{e.style.textDecoration="underline"},e.onmouseleave=()=>{e.style.textDecoration="none"},(0,r.wu)("click",e,(e=>{this.refreshUserList(),e.preventDefault()})),this.refreshDiv.appendChild(e),this.wrapper.appendChild(this.refreshDiv)}refreshUserList(){(0,p.f)("ReactUserList2")?(this.hideUserList(),this.showLoadingDiv()):(this.removeUserListChildren(),this.createLoadingDiv()),this.refresh()}clear(e){this.userCount=e,b.fire(this.userCount),(0,p.f)("ReactUserList2")?(this.hideUserList(),this.showLoadingDiv()):(this.removeUserListChildren(),this.createLoadingDiv()),this.repositionChildren()}refresh(){if(void 0===this.chatConn)return;const e=o.SJ.getInstance();(0,o.It)()?(e.refetch().catch(y.yZ),this.displayList(e.getRoomUsersInfo())):e.fetchRoomUsers().then((e=>{this.latestRoomUsersInfo=e,this.displayList(e)})).catch((e=>{error("Error retrieving user list",e),(0,h.Q$)(g.Ru.errorRefreshingUserList),void 0!==this.latestRoomUsersInfo&&this.displayList(this.latestRoomUsersInfo)}))}displayList(e){if((0,p.f)("ReactUserList2"))if(this.loadingDiv.style.display="none",this.userList=e.roomUsers,void 0===this.userListComponent){this.createRefreshUsersLink(),this.listDiv=document.createElement("div"),this.listDiv.style.display="inline-block",this.wrapper.appendChild(this.listDiv);const e=n.c.get("UserList");this.userListComponent=new e({roomUsers:this.userList,createContextMenu:(e,t)=>{(0,m.bT)("OpenUserContextMenu",{username:e.username}),C.L.createUserContextMenu(e,t)}},this.listDiv),this.wrapper.appendChild(this.anonUsersDiv)}else this.listDiv.style.display="inline-block",this.refreshDiv.style.display="unset",this.anonUsersDiv.style.display="unset",this.userListComponent.update({roomUsers:this.userList});else{this.removeUserListChildren(),this.createRefreshUsersLink(),this.userList=e.roomUsers;for(const e of this.userList){const t=document.createElement("div");(0,c.ZM)(t,{width:"auto",maxWidth:"100%",margin:"2px 0"}),t.appendChild(this.createUsernameLabel(e).element),this.wrapper.appendChild(t)}this.wrapper.appendChild(this.anonUsersDiv)}this.updateUserCount(e.anonCount,e.totalCount),this.repositionChildren()}updateUserCount(e,t){this.userCount=t,b.fire(t),this.anonUsersDiv.innerText=g.Ru.anonUsersCount(e)}createUsernameLabel(e){return new C.L(e,void 0,!0)}getTabHandleContent(){void 0===this.tabHandleIcon&&(this.tabHandleIcon=(0,v.DU)(),this.tabHandleIcon.style.height="1em",this.tabHandleIcon.style.paddingTop="1px");const e=document.createTextNode(`${this.baseTabHandleText}(${this.userCount})`),t=document.createElement("span");return t.dataset.pactionName="USERS",t.style.verticalAlign="top",t.appendChild(e),[t]}getTabId(){return"users-tab-default"}focusCurrentChatInput(){this.inputField.focus()}blurCurrentChatInput(){this.inputField.blur()}isInputFocused(){return document.activeElement===this.inputField.element}scrollToBottom(){this.wrapper.scrollTop=this.wrapper.scrollHeight-this.wrapper.offsetHeight}getInputText(){return this.inputField.getText()}setInputText(e){this.settingInput=!0,this.inputField.setText(e),this.inputField.blur(),window.setTimeout((()=>{this.settingInput=!1}),100)}getChatInputField(){}tabHandleClicked(e){super.tabHandleClicked(e),(0,m.bT)("FocusTab",{location:"userlist"}),this.refresh()}}}}]);
//# sourceMappingURL=648-prod-c0755751a16459dc81b5.js.map